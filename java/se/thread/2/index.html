<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å¤šçº¿ç¨‹è¿›é˜¶-JUC | DK&#39;s Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/my-notes/img/logo.jpg">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334691_b03dsaqrwck.css">
    <meta name="description" content="æ—¶ä¸æˆ‘å¾…ï¼Œèˆæˆ‘å…¶è°">
    <meta name="keywords" content="Java">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/my-notes/assets/css/0.styles.565c6041.css" as="style"><link rel="preload" href="/my-notes/assets/js/app.7f931ee0.js" as="script"><link rel="preload" href="/my-notes/assets/js/2.e52a17f8.js" as="script"><link rel="preload" href="/my-notes/assets/js/29.208cdce3.js" as="script"><link rel="preload" href="/my-notes/assets/js/6.bcc16901.js" as="script"><link rel="prefetch" href="/my-notes/assets/js/10.fee8f7ec.js"><link rel="prefetch" href="/my-notes/assets/js/100.9be19fac.js"><link rel="prefetch" href="/my-notes/assets/js/101.9aaae740.js"><link rel="prefetch" href="/my-notes/assets/js/102.a72c0165.js"><link rel="prefetch" href="/my-notes/assets/js/103.d47527c3.js"><link rel="prefetch" href="/my-notes/assets/js/104.d5bae560.js"><link rel="prefetch" href="/my-notes/assets/js/105.fdb07f67.js"><link rel="prefetch" href="/my-notes/assets/js/106.b89b7d37.js"><link rel="prefetch" href="/my-notes/assets/js/107.a9d142eb.js"><link rel="prefetch" href="/my-notes/assets/js/108.1b8c8817.js"><link rel="prefetch" href="/my-notes/assets/js/109.0cd465a0.js"><link rel="prefetch" href="/my-notes/assets/js/11.75b40e53.js"><link rel="prefetch" href="/my-notes/assets/js/110.4c56723c.js"><link rel="prefetch" href="/my-notes/assets/js/111.12b9cb85.js"><link rel="prefetch" href="/my-notes/assets/js/112.3f791546.js"><link rel="prefetch" href="/my-notes/assets/js/113.d9998b70.js"><link rel="prefetch" href="/my-notes/assets/js/114.faf0da70.js"><link rel="prefetch" href="/my-notes/assets/js/115.35d9b5f6.js"><link rel="prefetch" href="/my-notes/assets/js/116.13fbe1ab.js"><link rel="prefetch" href="/my-notes/assets/js/117.bffe4459.js"><link rel="prefetch" href="/my-notes/assets/js/118.eabefad3.js"><link rel="prefetch" href="/my-notes/assets/js/119.8593c8a5.js"><link rel="prefetch" href="/my-notes/assets/js/12.34db197a.js"><link rel="prefetch" href="/my-notes/assets/js/120.f5b73620.js"><link rel="prefetch" href="/my-notes/assets/js/121.d3137f51.js"><link rel="prefetch" href="/my-notes/assets/js/122.f47bca90.js"><link rel="prefetch" href="/my-notes/assets/js/123.6d846b88.js"><link rel="prefetch" href="/my-notes/assets/js/124.49825ebc.js"><link rel="prefetch" href="/my-notes/assets/js/125.6d3a9ce5.js"><link rel="prefetch" href="/my-notes/assets/js/126.eeef761b.js"><link rel="prefetch" href="/my-notes/assets/js/127.0f7e28c1.js"><link rel="prefetch" href="/my-notes/assets/js/128.4a35f42a.js"><link rel="prefetch" href="/my-notes/assets/js/129.e364bc33.js"><link rel="prefetch" href="/my-notes/assets/js/13.ab02aa59.js"><link rel="prefetch" href="/my-notes/assets/js/130.1299fc06.js"><link rel="prefetch" href="/my-notes/assets/js/131.61faa498.js"><link rel="prefetch" href="/my-notes/assets/js/132.9e46a3c4.js"><link rel="prefetch" href="/my-notes/assets/js/133.0b6e6f7f.js"><link rel="prefetch" href="/my-notes/assets/js/134.6724b7a7.js"><link rel="prefetch" href="/my-notes/assets/js/135.1d3daca0.js"><link rel="prefetch" href="/my-notes/assets/js/136.190f2a28.js"><link rel="prefetch" href="/my-notes/assets/js/137.5ce96397.js"><link rel="prefetch" href="/my-notes/assets/js/138.c0b55b02.js"><link rel="prefetch" href="/my-notes/assets/js/139.068ed7d7.js"><link rel="prefetch" href="/my-notes/assets/js/14.721e1994.js"><link rel="prefetch" href="/my-notes/assets/js/140.5226be4f.js"><link rel="prefetch" href="/my-notes/assets/js/141.196d1aa6.js"><link rel="prefetch" href="/my-notes/assets/js/142.11cbb52f.js"><link rel="prefetch" href="/my-notes/assets/js/143.509f8300.js"><link rel="prefetch" href="/my-notes/assets/js/144.436415bf.js"><link rel="prefetch" href="/my-notes/assets/js/145.a25cd8bc.js"><link rel="prefetch" href="/my-notes/assets/js/146.a2d1d780.js"><link rel="prefetch" href="/my-notes/assets/js/147.1cac4e0a.js"><link rel="prefetch" href="/my-notes/assets/js/148.5c361eba.js"><link rel="prefetch" href="/my-notes/assets/js/149.f62eacfa.js"><link rel="prefetch" href="/my-notes/assets/js/15.35ef567c.js"><link rel="prefetch" href="/my-notes/assets/js/150.80b0aa20.js"><link rel="prefetch" href="/my-notes/assets/js/151.6f0e31d8.js"><link rel="prefetch" href="/my-notes/assets/js/152.86efa86d.js"><link rel="prefetch" href="/my-notes/assets/js/153.d6605e26.js"><link rel="prefetch" href="/my-notes/assets/js/154.e5b33cc7.js"><link rel="prefetch" href="/my-notes/assets/js/155.5d3cf278.js"><link rel="prefetch" href="/my-notes/assets/js/156.bcb9784f.js"><link rel="prefetch" href="/my-notes/assets/js/157.ca3b8e8c.js"><link rel="prefetch" href="/my-notes/assets/js/158.eb0116b8.js"><link rel="prefetch" href="/my-notes/assets/js/159.309a26da.js"><link rel="prefetch" href="/my-notes/assets/js/16.ca698d39.js"><link rel="prefetch" href="/my-notes/assets/js/160.ce6e9321.js"><link rel="prefetch" href="/my-notes/assets/js/161.ac24f13a.js"><link rel="prefetch" href="/my-notes/assets/js/162.c3390211.js"><link rel="prefetch" href="/my-notes/assets/js/163.8267154f.js"><link rel="prefetch" href="/my-notes/assets/js/164.3ce822f9.js"><link rel="prefetch" href="/my-notes/assets/js/165.80836bd1.js"><link rel="prefetch" href="/my-notes/assets/js/166.7346e59a.js"><link rel="prefetch" href="/my-notes/assets/js/167.5577b6af.js"><link rel="prefetch" href="/my-notes/assets/js/168.23aca72c.js"><link rel="prefetch" href="/my-notes/assets/js/169.ce891665.js"><link rel="prefetch" href="/my-notes/assets/js/17.549cfc80.js"><link rel="prefetch" href="/my-notes/assets/js/170.b4aebdaf.js"><link rel="prefetch" href="/my-notes/assets/js/171.39cdd90b.js"><link rel="prefetch" href="/my-notes/assets/js/172.06cd5671.js"><link rel="prefetch" href="/my-notes/assets/js/173.44c7c161.js"><link rel="prefetch" href="/my-notes/assets/js/174.62d8a34f.js"><link rel="prefetch" href="/my-notes/assets/js/175.baa645ac.js"><link rel="prefetch" href="/my-notes/assets/js/176.8361f852.js"><link rel="prefetch" href="/my-notes/assets/js/177.4a8f2fec.js"><link rel="prefetch" href="/my-notes/assets/js/178.f594def6.js"><link rel="prefetch" href="/my-notes/assets/js/179.2338f129.js"><link rel="prefetch" href="/my-notes/assets/js/18.a8b4f826.js"><link rel="prefetch" href="/my-notes/assets/js/180.1b2f62df.js"><link rel="prefetch" href="/my-notes/assets/js/181.10759f41.js"><link rel="prefetch" href="/my-notes/assets/js/182.c0e1c3c5.js"><link rel="prefetch" href="/my-notes/assets/js/183.bdc8283f.js"><link rel="prefetch" href="/my-notes/assets/js/184.30a6f685.js"><link rel="prefetch" href="/my-notes/assets/js/185.1949079b.js"><link rel="prefetch" href="/my-notes/assets/js/186.bb7c7093.js"><link rel="prefetch" href="/my-notes/assets/js/187.1d02d132.js"><link rel="prefetch" href="/my-notes/assets/js/188.5230fbeb.js"><link rel="prefetch" href="/my-notes/assets/js/189.2931d469.js"><link rel="prefetch" href="/my-notes/assets/js/19.16e1a44c.js"><link rel="prefetch" href="/my-notes/assets/js/190.9bd3b616.js"><link rel="prefetch" href="/my-notes/assets/js/191.d75de9d3.js"><link rel="prefetch" href="/my-notes/assets/js/192.dacb160e.js"><link rel="prefetch" href="/my-notes/assets/js/193.660b4fce.js"><link rel="prefetch" href="/my-notes/assets/js/194.45f8499e.js"><link rel="prefetch" href="/my-notes/assets/js/195.e91d4663.js"><link rel="prefetch" href="/my-notes/assets/js/196.e94176ac.js"><link rel="prefetch" href="/my-notes/assets/js/197.5acbb43f.js"><link rel="prefetch" href="/my-notes/assets/js/198.dc1a1207.js"><link rel="prefetch" href="/my-notes/assets/js/199.288adcec.js"><link rel="prefetch" href="/my-notes/assets/js/20.b19ef4b2.js"><link rel="prefetch" href="/my-notes/assets/js/200.3d318d2e.js"><link rel="prefetch" href="/my-notes/assets/js/21.e3682738.js"><link rel="prefetch" href="/my-notes/assets/js/22.fafa8b54.js"><link rel="prefetch" href="/my-notes/assets/js/23.9d683b40.js"><link rel="prefetch" href="/my-notes/assets/js/24.02c0c08c.js"><link rel="prefetch" href="/my-notes/assets/js/25.af427f02.js"><link rel="prefetch" href="/my-notes/assets/js/26.50a41828.js"><link rel="prefetch" href="/my-notes/assets/js/27.8f1d2fe6.js"><link rel="prefetch" href="/my-notes/assets/js/28.7f820229.js"><link rel="prefetch" href="/my-notes/assets/js/3.32ea0d41.js"><link rel="prefetch" href="/my-notes/assets/js/30.e7a171d3.js"><link rel="prefetch" href="/my-notes/assets/js/31.8ee9f363.js"><link rel="prefetch" href="/my-notes/assets/js/32.b33ae00e.js"><link rel="prefetch" href="/my-notes/assets/js/33.3a961845.js"><link rel="prefetch" href="/my-notes/assets/js/34.46f30eb6.js"><link rel="prefetch" href="/my-notes/assets/js/35.dedda1f7.js"><link rel="prefetch" href="/my-notes/assets/js/36.fb63ded5.js"><link rel="prefetch" href="/my-notes/assets/js/37.321340a9.js"><link rel="prefetch" href="/my-notes/assets/js/38.c21281dd.js"><link rel="prefetch" href="/my-notes/assets/js/39.01776b7e.js"><link rel="prefetch" href="/my-notes/assets/js/4.2466bf2a.js"><link rel="prefetch" href="/my-notes/assets/js/40.c6763f18.js"><link rel="prefetch" href="/my-notes/assets/js/41.afa4c2f3.js"><link rel="prefetch" href="/my-notes/assets/js/42.187357b5.js"><link rel="prefetch" href="/my-notes/assets/js/43.90030eae.js"><link rel="prefetch" href="/my-notes/assets/js/44.e11eff59.js"><link rel="prefetch" href="/my-notes/assets/js/45.760e3e3f.js"><link rel="prefetch" href="/my-notes/assets/js/46.0eccc1a4.js"><link rel="prefetch" href="/my-notes/assets/js/47.30e063f8.js"><link rel="prefetch" href="/my-notes/assets/js/48.5ab681d2.js"><link rel="prefetch" href="/my-notes/assets/js/49.5921c987.js"><link rel="prefetch" href="/my-notes/assets/js/5.56264475.js"><link rel="prefetch" href="/my-notes/assets/js/50.a53fa873.js"><link rel="prefetch" href="/my-notes/assets/js/51.5cded08c.js"><link rel="prefetch" href="/my-notes/assets/js/52.8960c473.js"><link rel="prefetch" href="/my-notes/assets/js/53.2ac21c0e.js"><link rel="prefetch" href="/my-notes/assets/js/54.361bc2f3.js"><link rel="prefetch" href="/my-notes/assets/js/55.3853b7f3.js"><link rel="prefetch" href="/my-notes/assets/js/56.754a3b4c.js"><link rel="prefetch" href="/my-notes/assets/js/57.1d9684e7.js"><link rel="prefetch" href="/my-notes/assets/js/58.0e7f2b60.js"><link rel="prefetch" href="/my-notes/assets/js/59.b37ab2f4.js"><link rel="prefetch" href="/my-notes/assets/js/60.f31d0aea.js"><link rel="prefetch" href="/my-notes/assets/js/61.5aebeb50.js"><link rel="prefetch" href="/my-notes/assets/js/62.cebf26d6.js"><link rel="prefetch" href="/my-notes/assets/js/63.6c7932ca.js"><link rel="prefetch" href="/my-notes/assets/js/64.cad8a013.js"><link rel="prefetch" href="/my-notes/assets/js/65.25e4c14e.js"><link rel="prefetch" href="/my-notes/assets/js/66.e9c81af6.js"><link rel="prefetch" href="/my-notes/assets/js/67.31cbef00.js"><link rel="prefetch" href="/my-notes/assets/js/68.edc93332.js"><link rel="prefetch" href="/my-notes/assets/js/69.5eaf1e4f.js"><link rel="prefetch" href="/my-notes/assets/js/7.5a6eeb6c.js"><link rel="prefetch" href="/my-notes/assets/js/70.7114cd64.js"><link rel="prefetch" href="/my-notes/assets/js/71.2066867c.js"><link rel="prefetch" href="/my-notes/assets/js/72.0f93cb73.js"><link rel="prefetch" href="/my-notes/assets/js/73.6c4d69ec.js"><link rel="prefetch" href="/my-notes/assets/js/74.0a91fc3c.js"><link rel="prefetch" href="/my-notes/assets/js/75.47e45f38.js"><link rel="prefetch" href="/my-notes/assets/js/76.99886a8d.js"><link rel="prefetch" href="/my-notes/assets/js/77.61eb4f51.js"><link rel="prefetch" href="/my-notes/assets/js/78.eff53df7.js"><link rel="prefetch" href="/my-notes/assets/js/79.e5d77573.js"><link rel="prefetch" href="/my-notes/assets/js/8.c2fa6f68.js"><link rel="prefetch" href="/my-notes/assets/js/80.8ac4e931.js"><link rel="prefetch" href="/my-notes/assets/js/81.82416621.js"><link rel="prefetch" href="/my-notes/assets/js/82.b7cea701.js"><link rel="prefetch" href="/my-notes/assets/js/83.eb0065f7.js"><link rel="prefetch" href="/my-notes/assets/js/84.45596ac9.js"><link rel="prefetch" href="/my-notes/assets/js/85.73902eef.js"><link rel="prefetch" href="/my-notes/assets/js/86.05a157f2.js"><link rel="prefetch" href="/my-notes/assets/js/87.83218f21.js"><link rel="prefetch" href="/my-notes/assets/js/88.bf05ee49.js"><link rel="prefetch" href="/my-notes/assets/js/89.089b5c96.js"><link rel="prefetch" href="/my-notes/assets/js/9.4a5b4024.js"><link rel="prefetch" href="/my-notes/assets/js/90.dc0b55a6.js"><link rel="prefetch" href="/my-notes/assets/js/91.ddc7da4f.js"><link rel="prefetch" href="/my-notes/assets/js/92.2b5c7d5f.js"><link rel="prefetch" href="/my-notes/assets/js/93.934a02e9.js"><link rel="prefetch" href="/my-notes/assets/js/94.3a6ede23.js"><link rel="prefetch" href="/my-notes/assets/js/95.0e946220.js"><link rel="prefetch" href="/my-notes/assets/js/96.3861fb05.js"><link rel="prefetch" href="/my-notes/assets/js/97.8627cefa.js"><link rel="prefetch" href="/my-notes/assets/js/98.6e0ee750.js"><link rel="prefetch" href="/my-notes/assets/js/99.5df99b25.js">
    <link rel="stylesheet" href="/my-notes/assets/css/0.styles.565c6041.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notes/" class="home-link router-link-active"><img src="/my-notes/img/logo.jpg" alt="DK's Notes" class="logo"> <span class="site-name can-hide">DK's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notes/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">å¯¼èˆªç«™</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title router-link-active">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">JavaåŸºç¡€</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-å¤šçº¿ç¨‹</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link router-link-active">å¤šçº¿ç¨‹</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-java8æ–°ç‰¹æ€§</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8æ–°ç‰¹æ€§</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Javaè™šæ‹Ÿæœº</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ•°æ®åº“" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">æ•°æ®åº“</a> <span class="title" style="display:none;">æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¡†æ¶" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">æ¡†æ¶</a> <span class="title" style="display:none;">æ¡†æ¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>ä¸­é—´ä»¶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¡¹ç›®" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">é¡¹ç›®</a> <span class="title" style="display:none;">é¡¹ç›®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">ç§’æ€é¡¹ç›®</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·|éƒ¨ç½²" class="dropdown-title"><a href="/my-notes/git/" class="link-title">å·¥å…·|éƒ¨ç½²</a> <span class="title" style="display:none;">å·¥å…·|éƒ¨ç½²</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•|åˆ·é¢˜" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">é¢è¯•|åˆ·é¢˜</a> <span class="title" style="display:none;">é¢è¯•|åˆ·é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">åˆ·é¢˜</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">å¼€å‘é—®é¢˜ğŸ˜ˆ</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">å…³äºğŸ’•</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">å½’æ¡£ğŸ•›</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.jpg"> <div class="blogger-info"><h3>é£</h3> <span>æ‘¸é±¼</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/my-notes/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">å¯¼èˆªç«™</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title router-link-active">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">JavaåŸºç¡€</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-å¤šçº¿ç¨‹</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link router-link-active">å¤šçº¿ç¨‹</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-java8æ–°ç‰¹æ€§</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8æ–°ç‰¹æ€§</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Javaè™šæ‹Ÿæœº</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ•°æ®åº“" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">æ•°æ®åº“</a> <span class="title" style="display:none;">æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¡†æ¶" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">æ¡†æ¶</a> <span class="title" style="display:none;">æ¡†æ¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>ä¸­é—´ä»¶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¡¹ç›®" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">é¡¹ç›®</a> <span class="title" style="display:none;">é¡¹ç›®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">ç§’æ€é¡¹ç›®</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·|éƒ¨ç½²" class="dropdown-title"><a href="/my-notes/git/" class="link-title">å·¥å…·|éƒ¨ç½²</a> <span class="title" style="display:none;">å·¥å…·|éƒ¨ç½²</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•|åˆ·é¢˜" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">é¢è¯•|åˆ·é¢˜</a> <span class="title" style="display:none;">é¢è¯•|åˆ·é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">åˆ·é¢˜</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">å¼€å‘é—®é¢˜ğŸ˜ˆ</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">å…³äºğŸ’•</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">å½’æ¡£ğŸ•›</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java-åŸºç¡€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java-å¤šçº¿ç¨‹</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-notes/java/se/thread/" aria-current="page" class="sidebar-link">å¤šçº¿ç¨‹</a></li><li><a href="/my-notes/java/se/thread/1/" class="sidebar-link">å¤šçº¿ç¨‹åŸºç¡€</a></li><li><a href="/my-notes/java/se/thread/2/" aria-current="page" class="active sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-JUC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/my-notes/java/se/thread/2/#_2ã€juc-java-util-concurrent" class="sidebar-link">2ã€JUC(java.util.concurrent)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#lockç›¸å…³" class="sidebar-link">Lockç›¸å…³</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#javaé”çš„ç§ç±»" class="sidebar-link">javaé”çš„ç§ç±»</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_1-å…¬å¹³é”-éå…¬å¹³é”" class="sidebar-link">1.å…¬å¹³é”/éå…¬å¹³é”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_2-å¯é‡å…¥é”" class="sidebar-link">2.å¯é‡å…¥é”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_3-ç‹¬äº«é”-å…±äº«é”" class="sidebar-link">3.ç‹¬äº«é”/å…±äº«é”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_4-äº’æ–¥é”-è¯»å†™é”" class="sidebar-link">4.äº’æ–¥é”/è¯»å†™é”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_5-ä¹è§‚é”-æ‚²è§‚é”" class="sidebar-link">5.ä¹è§‚é”/æ‚²è§‚é”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_6-åˆ†æ®µé”" class="sidebar-link">6.åˆ†æ®µé”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_7-åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”" class="sidebar-link">7.åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_8-è‡ªæ—‹é”" class="sidebar-link">8.è‡ªæ—‹é”</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#é”çš„ä½¿ç”¨" class="sidebar-link">é”çš„ä½¿ç”¨</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_1-aqs" class="sidebar-link">1.AQS</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_2-cas" class="sidebar-link">2.CAS</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#_3-ç¤ºä¾‹" class="sidebar-link">3.ç¤ºä¾‹</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#reentrantlockç±»" class="sidebar-link">ReentrantLockç±»</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#synchronizedä¸lockçš„å¼‚åŒ" class="sidebar-link">synchronizedä¸Lockçš„å¼‚åŒï¼Ÿ</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤ä¹ " class="sidebar-link">ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤ä¹ </a></li><li class="sidebar-sub-header level6"><a href="/my-notes/java/se/thread/2/#è™šå‡å”¤é†’é—®é¢˜" class="sidebar-link">è™šå‡å”¤é†’é—®é¢˜</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#ä½¿ç”¨lockåŠå…¶ç›¸å…³çš„await-ã€signal-ã€signalall-æ–¹æ³•æ›¿ä»£synchronizedåŠwait-ã€notify-ã€æ­¤æ–¹æ³•ç›¸å½“äºnotifyall" class="sidebar-link">ä½¿ç”¨LockåŠå…¶ç›¸å…³çš„await()ã€signal()ã€signalAll()æ–¹æ³•æ›¿ä»£synchronizedåŠwait()ã€notify()ã€æ­¤æ–¹æ³•ç›¸å½“äºnotifyAll()</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#é›†åˆçš„çº¿ç¨‹å®‰å…¨" class="sidebar-link">é›†åˆçš„çº¿ç¨‹å®‰å…¨</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#callable" class="sidebar-link">Callable</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#å¸¸ç”¨çš„è¾…åŠ©ç±»" class="sidebar-link">å¸¸ç”¨çš„è¾…åŠ©ç±»</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#countdownlatch" class="sidebar-link">CountDownLatch</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#cyclicbarrier-ç¯±æ …" class="sidebar-link">CyclicBarrier(ç¯±æ …)</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#semaphore-ä¿¡å·é‡" class="sidebar-link">Semaphore(ä¿¡å·é‡)</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#è¯»å†™é”-readwritelockæ¥å£" class="sidebar-link">è¯»å†™é”(ReadWriteLockæ¥å£)</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/java/se/thread/2/#åŠ ä¸Šlocké”å’Œsynchronizedæƒ…å†µ" class="sidebar-link">åŠ ä¸ŠLocké”å’Œsynchronizedæƒ…å†µ:</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#é˜»å¡é˜Ÿåˆ—-blockingqueue" class="sidebar-link">é˜»å¡é˜Ÿåˆ—(BlockingQueue)</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#å››ç»„api" class="sidebar-link">å››ç»„API</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#é˜»å¡é˜Ÿåˆ—åˆ†ç±»" class="sidebar-link">é˜»å¡é˜Ÿåˆ—åˆ†ç±»</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_1-arrayblockingqueue" class="sidebar-link">1.ArrayBlockingQueue</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_2-linkedblockingqueue" class="sidebar-link">2.LinkedBlockingQueue</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_3-delayqueue" class="sidebar-link">3.DelayQueue</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_4-priorityblockingqueue" class="sidebar-link">4.PriorityBlockingQueue</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_5-synchronousqueue" class="sidebar-link">5.SynchronousQueue</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_6-linkedtransferqueue" class="sidebar-link">6.LinkedTransferQueue</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#_7-linkedblockingdeque" class="sidebar-link">7.LinkedBlockingDeque</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#çº¿ç¨‹æ± " class="sidebar-link">çº¿ç¨‹æ± </a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#ä¸ƒå¤§å‚æ•°æºç " class="sidebar-link">ä¸ƒå¤§å‚æ•°æºç </a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#å››ç§æ‹’ç»ç­–ç•¥ç±»" class="sidebar-link">å››ç§æ‹’ç»ç­–ç•¥ç±»ï¼š</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#cpuå¯†é›†å‹å’Œioå¯†é›†å‹" class="sidebar-link">CPUå¯†é›†å‹å’ŒIOå¯†é›†å‹</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#forkjoin-åˆ†æ”¯åˆå¹¶" class="sidebar-link">ForkJoin(åˆ†æ”¯åˆå¹¶)</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/java/se/thread/2/#å¼‚æ­¥å›è°ƒ" class="sidebar-link">å¼‚æ­¥å›è°ƒ</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/java/se/thread/2/#futureå’Œcompletablefuture" class="sidebar-link">Futureå’ŒCompletableFuture</a></li></ul></li></ul></li><li><a href="/my-notes/java/se/thread/3/" class="sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-JMM</a></li><li><a href="/my-notes/java/se/thread/4/" class="sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-volatile</a></li><li><a href="/my-notes/java/se/thread/5/" class="sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-å•ä¾‹æ¨¡å¼å‡çº§</a></li><li><a href="/my-notes/java/se/thread/6/" class="sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-æ·±å…¥ç†è§£CAS</a></li><li><a href="/my-notes/java/se/thread/7/" class="sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-parkå’Œunpark</a></li><li><a href="/my-notes/java/se/thread/8/" class="sidebar-link">å¤šçº¿ç¨‹è¿›é˜¶-æ·±å…¥ç†è§£AQS</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java8æ–°ç‰¹æ€§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaWeb</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/my-notes/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/my-notes/categories/?category=Java" title="åˆ†ç±»" data-v-06225672>Java</a></li><li data-v-06225672><a href="/my-notes/categories/?category=Java-%E5%A4%9A%E7%BA%BF%E7%A8%8B" title="åˆ†ç±»" data-v-06225672>Java-å¤šçº¿ç¨‹</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.zaiolos.top/" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>zdk</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-01-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">å¤šçº¿ç¨‹è¿›é˜¶-JUC<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><strong>Table of Contents</strong> <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener noreferrer">DocToc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></p> <ul><li><a href="#2jucjavautilconcurrent">2ã€JUC(java.util.concurrent)</a> <ul><li><a href="#lock%E7%9B%B8%E5%85%B3">Lockç›¸å…³</a> <ul><li><a href="#java%E9%94%81%E7%9A%84%E7%A7%8D%E7%B1%BB">javaé”çš„ç§ç±»</a> <ul><li><a href="#1%E5%85%AC%E5%B9%B3%E9%94%81%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81">1.å…¬å¹³é”/éå…¬å¹³é”</a></li> <li><a href="#2%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81">2.å¯é‡å…¥é”</a></li> <li><a href="#3%E7%8B%AC%E4%BA%AB%E9%94%81%E5%85%B1%E4%BA%AB%E9%94%81">3.<strong>ç‹¬äº«é”/å…±äº«é”</strong></a></li> <li><a href="#4%E4%BA%92%E6%96%A5%E9%94%81%E8%AF%BB%E5%86%99%E9%94%81"><strong>4.äº’æ–¥é”/è¯»å†™é”</strong></a></li> <li><a href="#5%E4%B9%90%E8%A7%82%E9%94%81%E6%82%B2%E8%A7%82%E9%94%81">5.<strong>ä¹è§‚é”/æ‚²è§‚é”</strong></a></li> <li><a href="#6%E5%88%86%E6%AE%B5%E9%94%81">6.<strong>åˆ†æ®µé”</strong></a></li> <li><a href="#7%E5%81%8F%E5%90%91%E9%94%81%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81">7.<strong>åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”</strong></a></li> <li><a href="#8%E8%87%AA%E6%97%8B%E9%94%81">8.è‡ªæ—‹é”</a></li></ul></li> <li><a href="#%E9%94%81%E7%9A%84%E4%BD%BF%E7%94%A8">é”çš„ä½¿ç”¨</a> <ul><li><a href="#1aqs">1.AQS</a></li> <li><a href="#2cas">2.CAS</a></li> <li><a href="#3%E7%A4%BA%E4%BE%8B">3.ç¤ºä¾‹</a></li></ul></li> <li><a href="#reentrantlock%E7%B1%BB">ReentrantLockç±»</a> <ul><li><a href="#synchronized%E4%B8%8Elock%E7%9A%84%E5%BC%82%E5%90%8C">synchronizedä¸Lockçš„å¼‚åŒï¼Ÿ</a></li> <li><a href="#%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98%E5%A4%8D%E4%B9%A0">ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤ä¹ </a> <ul><li><a href="#%E8%99%9A%E5%81%87%E5%94%A4%E9%86%92%E9%97%AE%E9%A2%98">è™šå‡å”¤é†’é—®é¢˜</a></li></ul></li> <li><a href="#%E4%BD%BF%E7%94%A8lock%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E7%9A%84awaitsignalsignalall%E6%96%B9%E6%B3%95%E6%9B%BF%E4%BB%A3synchronized%E5%8F%8Awaitnotify%E6%AD%A4%E6%96%B9%E6%B3%95%E7%9B%B8%E5%BD%93%E4%BA%8Enotifyall">ä½¿ç”¨LockåŠå…¶ç›¸å…³çš„await()ã€signal()ã€signalAll()æ–¹æ³•æ›¿ä»£synchronizedåŠwait()ã€notify()ã€æ­¤æ–¹æ³•ç›¸å½“äºnotifyAll()</a></li></ul></li> <li><a href="#%E9%9B%86%E5%90%88%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">é›†åˆçš„çº¿ç¨‹å®‰å…¨</a></li> <li><a href="#callable">Callable</a></li></ul></li> <li><a href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB">å¸¸ç”¨çš„è¾…åŠ©ç±»</a> <ul><li><a href="#countdownlatch"><strong>CountDownLatch</strong></a></li> <li><a href="#cyclicbarrier%E7%AF%B1%E6%A0%85"><strong>CyclicBarrier(ç¯±æ …)</strong></a></li> <li><a href="#semaphore%E4%BF%A1%E5%8F%B7%E9%87%8F"><strong>Semaphore(ä¿¡å·é‡)</strong></a></li></ul></li> <li><a href="#%E8%AF%BB%E5%86%99%E9%94%81readwritelock%E6%8E%A5%E5%8F%A3">è¯»å†™é”(ReadWriteLockæ¥å£)</a></li> <li><a href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97blockingqueue">é˜»å¡é˜Ÿåˆ—(BlockingQueue)</a></li> <li><a href="#%E5%9B%9B%E7%BB%84api">å››ç»„API</a></li> <li><a href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E5%88%86%E7%B1%BB">é˜»å¡é˜Ÿåˆ—åˆ†ç±»</a> <ul><li><a href="#1arrayblockingqueue">1.ArrayBlockingQueue</a></li> <li><a href="#2linkedblockingqueue">2.LinkedBlockingQueue</a></li> <li><a href="#3delayqueue">3.DelayQueue</a></li> <li><a href="#4priorityblockingqueue">4.PriorityBlockingQueue</a></li> <li><a href="#5synchronousqueue">5.SynchronousQueue</a></li> <li><a href="#6linkedtransferqueue">6.LinkedTransferQueue</a></li> <li><a href="#7linkedblockingdeque">7.LinkedBlockingDeque</a></li></ul></li> <li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0">çº¿ç¨‹æ± </a> <ul><li><a href="#%E4%B8%83%E5%A4%A7%E5%8F%82%E6%95%B0%E6%BA%90%E7%A0%81">ä¸ƒå¤§å‚æ•°æºç </a></li> <li><a href="#%E5%9B%9B%E7%A7%8D%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E7%B1%BB">å››ç§æ‹’ç»ç­–ç•¥ç±»ï¼š</a></li> <li><a href="#cpu%E5%AF%86%E9%9B%86%E5%9E%8B%E5%92%8Cio%E5%AF%86%E9%9B%86%E5%9E%8B">CPUå¯†é›†å‹å’ŒIOå¯†é›†å‹</a></li></ul></li> <li><a href="#forkjoin%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6">ForkJoin(åˆ†æ”¯åˆå¹¶)</a></li> <li><a href="#%E5%BC%82%E6%AD%A5%E5%9B%9E%E8%B0%83">å¼‚æ­¥å›è°ƒ</a> <ul><li><a href="#future%E5%92%8Ccompletablefuture">Futureå’ŒCompletableFuture</a></li></ul></li></ul></li></ul> <hr> <h2 id="_2ã€juc-java-util-concurrent"><a href="#_2ã€juc-java-util-concurrent" class="header-anchor">#</a> 2ã€JUC(java.util.concurrent)</h2> <blockquote><p>javaé»˜è®¤æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼šmainå’Œgc</p> <p>å¹¶å‘ï¼šå¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æºç±»ï¼Œå°†èµ„æºç±»ä¸¢å…¥çº¿ç¨‹ã€‚ç¼–å†™ä»£ç æ—¶ï¼Œå½“èµ„æºç±»å°±æ˜¯ä¸€ä¸ªçº¯ç²¹çš„å¯¹è±¡ï¼ŒåŒ…å«å±æ€§å’Œæ“ä½œæ–¹æ³•ï¼Œç„¶ånewçº¿ç¨‹å»è°ƒç”¨èµ„æºç±»çš„æ–¹æ³•</p> <ul><li>è§£è€¦</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Ticket</span> ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              ticket<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              ticket<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              ticket<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//ç‹¬ç«‹çš„èµ„æºç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;å–å‡ºäº†ç¥¨:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ï¼Œå‰©ä½™:&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></blockquote> <h3 id="lockç›¸å…³"><a href="#lockç›¸å…³" class="header-anchor">#</a> Lockç›¸å…³</h3> <h4 id="javaé”çš„ç§ç±»"><a href="#javaé”çš„ç§ç±»" class="header-anchor">#</a> javaé”çš„ç§ç±»</h4> <ul><li>å…¬å¹³é”/éå…¬å¹³é”</li> <li>å¯é‡å…¥é”</li> <li>ç‹¬äº«é”/å…±äº«é”</li> <li>äº’æ–¥é”/è¯»å†™é”</li> <li>ä¹è§‚é”/æ‚²è§‚é”</li> <li>åˆ†æ®µé”</li> <li>åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”</li> <li>è‡ªæ—‹é”</li></ul> <h5 id="_1-å…¬å¹³é”-éå…¬å¹³é”"><a href="#_1-å…¬å¹³é”-éå…¬å¹³é”" class="header-anchor">#</a> 1.å…¬å¹³é”/éå…¬å¹³é”</h5> <blockquote><p>1.å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚
2.éå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚
å¯¹äºJava ReentrantLockè€Œè¨€ï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºååé‡æ¯”å…¬å¹³é”å¤§ã€‚
å¯¹äºsynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚ç”±äºå…¶å¹¶ä¸åƒReentrantLockæ˜¯é€šè¿‡AQSçš„æ¥å®ç°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•åŠæ³•ä½¿å…¶å˜æˆå…¬å¹³é”ã€‚</p></blockquote> <h5 id="_2-å¯é‡å…¥é”"><a href="#_2-å¯é‡å…¥é”" class="header-anchor">#</a> 2.å¯é‡å…¥é”</h5> <blockquote><p>å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚å¯¹äºJava ReentrantLockè€Œè¨€, å…¶åå­—æ˜¯Reentrant Lockå³æ˜¯é‡æ–°è¿›å…¥é”ã€‚å¯¹äºsynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚å¯é‡å…¥é”çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªå¯é‡å…¥é”çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå¦‚æœä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼ŒsetBå¯èƒ½ä¸ä¼šè¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œå¯èƒ½é€ æˆæ­»é”ã€‚</p></blockquote> <h5 id="_3-ç‹¬äº«é”-å…±äº«é”"><a href="#_3-ç‹¬äº«é”-å…±äº«é”" class="header-anchor">#</a> 3.<strong>ç‹¬äº«é”/å…±äº«é”</strong></h5> <blockquote><p>ç‹¬äº«é”æ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ï¼›å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚</p> <p>å¯¹äºJava ReentrantLockè€Œè¨€ï¼Œå…¶æ˜¯ç‹¬äº«é”ã€‚ä½†æ˜¯å¯¹äºLockçš„å¦ä¸€ä¸ªå®ç°ç±»ReadWriteLockï¼Œå…¶è¯»é”æ˜¯å…±äº«é”ï¼Œå…¶å†™é”æ˜¯ç‹¬äº«é”ã€‚è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ã€å†™è¯» ã€å†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚å¯¹äºsynchronizedè€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬äº«é”ã€‚</p></blockquote> <h5 id="_4-äº’æ–¥é”-è¯»å†™é”"><a href="#_4-äº’æ–¥é”-è¯»å†™é”" class="header-anchor">#</a> <strong>4.äº’æ–¥é”/è¯»å†™é”</strong></h5> <blockquote><p>ä¸Šé¢è¯´åˆ°çš„ç‹¬äº«é”/å…±äº«é”å°±æ˜¯ä¸€ç§å¹¿ä¹‰çš„è¯´æ³•ï¼Œäº’æ–¥é”/è¯»å†™é”å°±æ˜¯å…·ä½“çš„å®ç°ã€‚äº’æ–¥é”åœ¨Javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯ReentrantLockï¼›è¯»å†™é”åœ¨Javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯ReadWriteLockã€‚</p></blockquote> <h5 id="_5-ä¹è§‚é”-æ‚²è§‚é”"><a href="#_5-ä¹è§‚é”-æ‚²è§‚é”" class="header-anchor">#</a> 5.<strong>ä¹è§‚é”/æ‚²è§‚é”</strong></h5> <blockquote><p>ä¹è§‚é”ä¸æ‚²è§‚é”ä¸æ˜¯æŒ‡å…·ä½“çš„ä»€ä¹ˆç±»å‹çš„é”ï¼Œè€Œæ˜¯æŒ‡çœ‹å¾…å¹¶å‘åŒæ­¥çš„è§’åº¦ã€‚</p> <p>æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚æ¯”å¦‚Javaé‡Œé¢çš„åŒæ­¥åŸè¯­synchronizedå…³é”®å­—çš„å®ç°å°±æ˜¯æ‚²è§‚é”ã€‚</p> <p>ä¹è§‚é”ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CAS(Compare and Swap æ¯”è¾ƒå¹¶äº¤æ¢)å®ç°çš„ã€‚</p></blockquote> <h5 id="_6-åˆ†æ®µé”"><a href="#_6-åˆ†æ®µé”" class="header-anchor">#</a> 6.<strong>åˆ†æ®µé”</strong></h5> <blockquote><p>åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äºConcurrentHashMapè€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œï¼ŒConcurrentHashMapä¸­çš„åˆ†æ®µé”ç§°ä¸ºSegmentï¼Œå®ƒå³ç±»ä¼¼äºHashMapï¼ˆJDK7ä¸JDK8ä¸­HashMapçš„å®ç°ï¼‰çš„ç»“æ„ï¼Œå³å†…éƒ¨æ‹¥æœ‰ä¸€ä¸ªEntryæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼›åŒæ—¶åˆæ˜¯ä¸€ä¸ªReentrantLockï¼ˆSegmentç»§æ‰¿äº†ReentrantLock)ã€‚å½“éœ€è¦putå…ƒç´ çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å¯¹æ•´ä¸ªHashMapè¿›è¡ŒåŠ é”ï¼Œè€Œæ˜¯å…ˆé€šè¿‡hashcodeæ¥çŸ¥é“ä»–è¦æ”¾åœ¨é‚£ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªåˆ†æ®µè¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥å½“å¤šçº¿ç¨‹putçš„æ—¶å€™ï¼Œåªè¦ä¸æ˜¯æ”¾åœ¨ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œå°±å®ç°äº†çœŸæ­£çš„å¹¶è¡Œçš„æ’å…¥ã€‚ä½†æ˜¯ï¼Œåœ¨ç»Ÿè®¡sizeçš„æ—¶å€™ï¼Œå¯å°±æ˜¯è·å–HashMapå…¨å±€ä¿¡æ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦è·å–æ‰€æœ‰çš„åˆ†æ®µé”æ‰èƒ½ç»Ÿè®¡ã€‚</p> <p>åˆ†æ®µé”çš„è®¾è®¡ç›®çš„æ˜¯ç»†åŒ–é”çš„ç²’åº¦ï¼Œå½“æ“ä½œä¸éœ€è¦æ›´æ–°æ•´ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œå°±ä»…ä»…é’ˆå¯¹æ•°ç»„ä¸­çš„ä¸€é¡¹è¿›è¡ŒåŠ é”æ“ä½œã€‚</p></blockquote> <h5 id="_7-åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”"><a href="#_7-åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”" class="header-anchor">#</a> 7.<strong>åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”</strong></h5> <blockquote><p>è¿™ä¸‰ç§é”æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œå¹¶ä¸”æ˜¯é’ˆå¯¹synchronizedã€‚åœ¨Java 5é€šè¿‡å¼•å…¥é”å‡çº§çš„æœºåˆ¶æ¥å®ç°é«˜æ•ˆsynchronizedã€‚è¿™ä¸‰ç§é”çš„çŠ¶æ€æ˜¯é€šè¿‡å¯¹è±¡ç›‘è§†å™¨åœ¨å¯¹è±¡å¤´ä¸­çš„å­—æ®µæ¥è¡¨æ˜çš„ã€‚</p> <p>åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚</p> <p>è½»é‡çº§é”æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚</p> <p>é‡é‡çº§é”æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚</p></blockquote> <h5 id="_8-è‡ªæ—‹é”"><a href="#_8-è‡ªæ—‹é”" class="header-anchor">#</a> 8.è‡ªæ—‹é”</h5> <blockquote><p>åœ¨Javaä¸­ï¼Œè‡ªæ—‹é”æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚<code>CASä¸­å¸¸ç”¨è‡ªæ—‹é”</code></p></blockquote> <h4 id="é”çš„ä½¿ç”¨"><a href="#é”çš„ä½¿ç”¨" class="header-anchor">#</a> é”çš„ä½¿ç”¨</h4> <h5 id="_1-aqs"><a href="#_1-aqs" class="header-anchor">#</a> 1.AQS</h5> <blockquote><p>AbstractQueuedSynchronized æŠ½è±¡çš„é˜Ÿåˆ—å¼çš„åŒæ­¥å™¨ï¼ŒAQSå®šä¹‰äº†ä¸€å¥—å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„åŒæ­¥å™¨æ¡†æ¶ï¼Œè®¸å¤šåŒæ­¥ç±»å®ç°éƒ½ä¾èµ–äºå®ƒï¼Œå¦‚å¸¸ç”¨çš„ReentrantLock/Semaphore/CountDownLatchâ€¦</p></blockquote> <p><img src="https://images.zaiolos.top/images/image-20211107174811798.png" alt="image-20211107174811798"></p> <blockquote><p>AQSç»´æŠ¤äº†ä¸€ä¸ªvolatile int stateï¼ˆä»£è¡¨å…±äº«èµ„æºï¼‰å’Œä¸€ä¸ªFIFOçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¤šçº¿ç¨‹äº‰ç”¨èµ„æºè¢«é˜»å¡æ—¶ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—ï¼‰ã€‚stateçš„è®¿é—®æ–¹å¼æœ‰ä¸‰ç§:</p> <ul><li>getState()</li> <li>setState()</li> <li>compareAndSetState()</li></ul></blockquote> <blockquote><p>AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰ã€‚</p></blockquote> <blockquote><p>ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯ï¼Œè‡³äºå…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚è·å–èµ„æºå¤±è´¥å…¥é˜Ÿ/å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ï¼ŒAQSå·²ç»åœ¨é¡¶å±‚å®ç°å¥½äº†ã€‚è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°æ—¶ä¸»è¦å®ç°ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p> <ul><li>isHeldExclusively()ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚</li> <li>tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li> <li>tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li> <li>tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</li> <li>tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li></ul></blockquote> <blockquote><p>ä»¥ReentrantLockä¸ºä¾‹ï¼Œstateåˆå§‹åŒ–ä¸º0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚Açº¿ç¨‹lock()æ—¶ï¼Œä¼šè°ƒç”¨tryAcquire()ç‹¬å è¯¥é”å¹¶å°†state+1ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å†tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ°Açº¿ç¨‹unlock()åˆ°state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒAçº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstateä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šä¹ˆæ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯stateæ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚</p> <p>å†ä»¥CountDownLatchä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸ºNä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstateä¹Ÿåˆå§‹åŒ–ä¸ºNï¼ˆæ³¨æ„Nè¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™Nä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown()ä¸€æ¬¡ï¼Œstateä¼šCASå‡1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³state=0)ï¼Œä¼šunpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä»await()å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚</p> <p>ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨è¦ä¹ˆæ˜¯ç‹¬å æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯å…±äº«æ–¹å¼ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®ç°tryAcquire-tryReleaseã€tryAcquireShared-tryReleaseSharedä¸­çš„ä¸€ç§å³å¯ã€‚ä½†AQSä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ReentrantReadWriteLockã€‚</p></blockquote> <h5 id="_2-cas"><a href="#_2-cas" class="header-anchor">#</a> 2.CAS</h5> <blockquote><p>CAS(Compare and Swap æ¯”è¾ƒå¹¶äº¤æ¢)æ˜¯ä¹è§‚é”æŠ€æœ¯ï¼Œå½“å¤šä¸ªçº¿ç¨‹å°è¯•ä½¿ç”¨CASåŒæ—¶æ›´æ–°åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°å˜é‡çš„å€¼ï¼Œè€Œå…¶å®ƒçº¿ç¨‹éƒ½å¤±è´¥ï¼Œå¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ˜¯è¢«å‘ŠçŸ¥è¿™æ¬¡ç«äº‰ä¸­å¤±è´¥ï¼Œå¹¶å¯ä»¥å†æ¬¡å°è¯•ã€‚</p> <p>CASæ“ä½œä¸­åŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”éœ€è¦è¯»å†™çš„å†…å­˜ä½ç½®(V)ã€è¿›è¡Œæ¯”è¾ƒçš„é¢„æœŸåŸå€¼(A)å’Œæ‹Ÿå†™å…¥çš„æ–°å€¼(B)ã€‚å¦‚æœå†…å­˜ä½ç½®Vçš„å€¼ä¸é¢„æœŸåŸå€¼Aç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼Bï¼Œå¦åˆ™å¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå®ƒéƒ½ä¼šåœ¨CAS æŒ‡ä»¤ä¹‹å‰è¿”å›è¯¥ä½ç½®çš„å€¼ï¼ˆåœ¨CASçš„ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹å°†ä»…è¿”å›CASæ˜¯å¦æˆåŠŸï¼Œè€Œä¸æå–å½“å‰å€¼ï¼‰ã€‚CASæœ‰æ•ˆåœ°è¯´æ˜äº†â€œ æˆ‘è®¤ä¸ºä½ç½®Våº”è¯¥åŒ…å«å€¼Aï¼›å¦‚æœåŒ…å«è¯¥å€¼ï¼Œåˆ™å°† Bæ”¾åˆ°è¿™ä¸ªä½ç½®ï¼›å¦åˆ™ï¼Œä¸è¦æ›´æ”¹è¯¥ä½ç½®ï¼Œåªå‘Šè¯‰æˆ‘è¿™ä¸ªä½ç½®ç°åœ¨çš„å€¼å³å¯â€ã€‚è¿™å…¶å®å’Œä¹è§‚é”çš„å†²çªæ£€æŸ¥ + æ•°æ®æ›´æ–°çš„åŸç†æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote> <blockquote><p>JAVAå¯¹CASçš„æ”¯æŒï¼š</p> <p>åœ¨JDK1.5ä¸­æ–°å¢java.util.concurrentåŒ…å°±æ˜¯å»ºç«‹åœ¨CASä¹‹ä¸Šçš„ã€‚ç›¸å¯¹äºå¯¹äºsynchronized è¿™ç§é˜»å¡ç®—æ³•ï¼ŒCASæ˜¯éé˜»å¡ç®—æ³•çš„ä¸€ç§å¸¸è§å®ç°ã€‚æ‰€ä»¥java.util.concurrentåœ¨æ€§èƒ½ä¸Šæœ‰äº†å¾ˆå¤§çš„æå‡ã€‚</p> <p>ä»¥java.util.concurrentåŒ…ä¸­çš„AtomicIntegerä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹åœ¨ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹æ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸»è¦ç†è§£ getAndIncrementæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨ç›¸å½“äº ++i æ“ä½œã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicInteger</span> <span class="token keyword">extends</span> <span class="token class-name">Number</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span>  
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span> 

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">int</span> current <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">int</span> next <span class="token operator">=</span> current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span>  
          <span class="token keyword">return</span> current<span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> unsafe<span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> valueOffset<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></blockquote> <h5 id="_3-ç¤ºä¾‹"><a href="#_3-ç¤ºä¾‹" class="header-anchor">#</a> 3.ç¤ºä¾‹</h5> <ol><li><p><strong>synchronizedéªŒè¯å¯é‡å…¥é”</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//import java.util.concurrent.locks.ReentrantLock;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token comment">//private ReentrantLock reentrantLock = new ReentrantLock();</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2 enter thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//reentrantLock.lock();</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3 get thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//reentrantLock.unlock();</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;5 leave run thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//reentrantLock.lock();</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;4 set thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//reentrantLock.unlock();</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1 run thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> <span class="token string">&quot;thread-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>è¿è¡Œç»“æœï¼š</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-0
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-3
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-2
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-1
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-0
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-0
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-4
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-0
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-0
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-4
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-4
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-7
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-4
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-6
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-5
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-4
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-8
<span class="token number">1</span> run thread name--<span class="token operator">&gt;</span>thread-9
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-1
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-1
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-1
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-1
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-2
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-2
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-2
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-2
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-3
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-3
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-3
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-3
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-9
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-9
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-9
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-9
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-8
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-8
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-8
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-8
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-5
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-5
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-5
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-5
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-6
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-6
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-6
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-6
<span class="token number">2</span> enter thread name--<span class="token operator">&gt;</span>thread-7
<span class="token number">3</span> get thread name--<span class="token operator">&gt;</span>thread-7
<span class="token number">4</span> <span class="token builtin class-name">set</span> thread name--<span class="token operator">&gt;</span>thread-7
<span class="token number">5</span> leave run thread name--<span class="token operator">&gt;</span>thread-7

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li> <li><p><strong>ReentrantLock</strong></p> <blockquote><p>ReentrantLockæ—¢å¯ä»¥æ„é€ å…¬å¹³é”åˆå¯ä»¥æ„é€ éå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”ï¼Œå°†ä¸Šé¢çš„ä»£ç æ”¹ä¸ºç”¨ReentrantLockå®ç°ï¼Œå†æ¬¡è¿è¡Œã€‚</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token comment">//é»˜è®¤ä¸ºéå…¬å¹³é”</span>
    <span class="token keyword">private</span> <span class="token class-name">ReentrantLock</span> reentrantLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å…¬å¹³é”</span>
    <span class="token keyword">private</span> <span class="token class-name">ReentrantLock</span> reentrantLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2 enter thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reentrantLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3 get thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reentrantLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;5 leave run thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        reentrantLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;4 set thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reentrantLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1 run thread name--&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> <span class="token string">&quot;thread-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><blockquote><p>å…¬å¹³é”åœ¨å¤šä¸ªçº¿ç¨‹æƒ³è¦åŒæ—¶è·å–é”çš„æ—¶å€™ï¼Œä¼šå‘ç°å†æ’é˜Ÿï¼ŒæŒ‰ç…§å…ˆæ¥ååˆ°çš„é¡ºåºè¿›è¡Œã€‚</p></blockquote></li> <li><p><strong>ReentrantReadWriteLock</strong></p> <blockquote><p>è¯»å†™é”çš„æ€§èƒ½éƒ½ä¼šæ¯”æ’å®ƒé”è¦å¥½ï¼Œå› ä¸ºå¤§å¤šæ•°åœºæ™¯è¯»æ˜¯å¤šäºå†™çš„ã€‚åœ¨è¯»å¤šäºå†™çš„æƒ…å†µä¸‹ï¼Œè¯»å†™é”èƒ½å¤Ÿæä¾›æ¯”æ’å®ƒé”æ›´å¥½çš„å¹¶å‘æ€§å’Œååé‡ã€‚Javaå¹¶å‘åŒ…æä¾›è¯»å†™é”çš„å®ç°æ˜¯ReentrantReadWriteLock</p></blockquote> <table><thead><tr><th>ç‰¹æ€§</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td>å…¬å¹³æ€§é€‰æ‹©</td> <td>æ”¯æŒéå…¬å¹³(é»˜è®¤)å’Œå…¬å¹³çš„é”è·å–æ–¹å¼ï¼Œååé‡è¿˜æ˜¯éå…¬å¹³ä¼˜äºå…¬å¹³</td></tr> <tr><td>é‡è¿›å…¥</td> <td>è¯¥é”æ”¯æŒé‡è¿›å…¥ï¼Œä»¥è¯»å†™çº¿ç¨‹ä¸ºä¾‹ï¼šè¯»çº¿ç¨‹åœ¨è·å–äº†è¯»é”ä¹‹åï¼Œèƒ½å¤Ÿå†æ¬¡è·å–è¯»é”ã€‚è€Œå†™çº¿ç¨‹åœ¨è·å–äº†å†™é”ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–å†™é”ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è·å–è¯»é”</td></tr> <tr><td>é”é™çº§</td> <td>éµå¾ªè·å–å†™é”ã€è·å–è¯»é”å†é‡Šæ”¾å†™é”çš„æ¬¡åºï¼Œå†™é”èƒ½å¤Ÿé™çº§æˆä¸ºè¯»é”</td></tr></tbody></table> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantReadWriteLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; joke&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;threadW-&quot;</span><span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;threadR-&quot;</span><span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;threadC-&quot;</span><span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantReadWriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Lock</span> r <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Lock</span> w <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–ä¸€ä¸ªkeyå¯¹åº”çš„value</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¾ç½®keyå¯¹åº”çš„valueï¼Œå¹¶è¿”å›æ—§æœ‰çš„value</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;put &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ¸…ç©ºæ‰€æœ‰çš„å†…å®¹</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;clear &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>è¿è¡Œç»“æœï¼š</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">clear</span> threadC-0
get threadR-2
null
put threadW-2
get threadR-0
threadW-2 joke
get threadR-3
threadW-2 joke
<span class="token function">clear</span> threadC-1
put threadW-3
<span class="token function">clear</span> threadC-3
<span class="token function">clear</span> threadC-2
get threadR-1
null
put threadW-1
put threadW-0
put threadW-4
get threadR-4
threadW-4 joke
<span class="token function">clear</span> threadC-4
get threadR-5
null
put threadW-5
put threadW-6
get threadR-6
threadW-6 joke
get threadR-7
threadW-6 joke
put threadW-7
<span class="token function">clear</span> threadC-6
put threadW-8
get threadR-8
threadW-8 joke
<span class="token function">clear</span> threadC-8
get threadR-9
null
<span class="token function">clear</span> threadC-5
<span class="token function">clear</span> threadC-9
<span class="token function">clear</span> threadC-7
put threadW-9

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div></li></ol> <p><strong>Lockæ¥å£çš„å®ç°ç±»</strong></p> <p><img src="https://images.zaiolos.top/images/202201061137742.png" alt="image-20211107172603900"></p> <h4 id="reentrantlockç±»"><a href="#reentrantlockç±»" class="header-anchor">#</a> ReentrantLockç±»</h4> <p><img src="https://images.zaiolos.top/images/image-20211107172836649.png" alt="image-20211107172836649"></p> <ul><li>å…¬å¹³é”ï¼šå¯ä»¥æŒ‰ç…§çº¿ç¨‹åˆ°æ¥çš„é¡ºåºæ‰§è¡Œ</li> <li><strong>éå…¬å¹³é”ï¼šçº¿ç¨‹å¯ä»¥æ’é˜Ÿ(é»˜è®¤)</strong></li></ul> <p>ä¸Šè¿°Ticketç±»ä½¿ç”¨Lockå®ç°</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;å–å‡ºäº†ç¥¨:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ï¼Œå‰©ä½™:&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="synchronizedä¸lockçš„å¼‚åŒ"><a href="#synchronizedä¸lockçš„å¼‚åŒ" class="header-anchor">#</a> synchronizedä¸Lockçš„å¼‚åŒï¼Ÿ</h5> <ol><li>synchronizedæ˜¯å†…ç½®çš„javaå…³é”®å­—ï¼Œè€ŒLockæ˜¯ä¸€ä¸ªjavaç±»(æ¥å£)</li> <li>synchronizedæ— æ³•åˆ¤æ–­è·å–é”çš„çŠ¶æ€ï¼ŒLockå¯ä»¥åˆ¤æ–­æ˜¯å¦è·å–åˆ°äº†é”</li> <li>å½“çº¿ç¨‹2æ‰€éœ€çš„é”è¢«çº¿ç¨‹1è·å–æ—¶ï¼Œä½¿ç”¨Locké”å°±ä¸ä¼šè®©çº¿ç¨‹2ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼štryLock()å’ŒtryLock(long time,TimeUnit timeUnit)å¯ä»¥å°è¯•è·å–é”</li> <li>synchronizedæ˜¯å¯é‡å…¥é”ï¼Œæ˜¯ä¸å¯ä»¥ä¸­æ–­çš„ï¼Œéå…¬å¹³çš„ï¼›</li> <li>synchronizedé€‚åˆé”å°‘é‡çš„ä»£ç ï¼ŒLocké€‚åˆé”å¤§é‡çš„ä»£ç </li> <li>Lockæ˜¯æ˜¾å¼é”ï¼ˆæ‰‹åŠ¨å¼€å¯å’Œå…³é—­é”ï¼Œåˆ«å¿˜è®°å…³é—­é”)ï¼Œsynchronizedæ˜¯éšå¼é”ï¼Œå‡ºäº†ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾</li> <li>Lockåªæœ‰ä»£ç å—é”ï¼Œsynchronizedæœ‰ä»£ç å—é”å’Œæ–¹æ³•é”</li> <li>ä½¿ç”¨Locké”ï¼ŒJVMå°†èŠ±è´¹è¾ƒå°‘çš„æ—¶é—´æ¥è°ƒåº¦çº¿ç¨‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚å¹¶ä¸”å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼ˆæä¾›æ›´å¤šçš„å­ç±»)</li> <li>ä¼˜å…ˆä½¿ç”¨é¡ºåº:Lockâ†’åŒæ­¥ä»£ç å—ï¼ˆå·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æº)â†’åŒæ­¥æ–¹æ³•(åœ¨æ–¹æ³•ä½“ä¹‹å¤–ï¼‰</li></ol> <h5 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤ä¹ "><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤ä¹ " class="header-anchor">#</a> ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤ä¹ </h5> <ol><li>synchronizedå®ç°</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WaitNotify</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number</span> number <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                number<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                number<span class="token punctuation">.</span><span class="token function">decr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Number</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ä¸è¯¥Aæ“ä½œ ç­‰å¾…</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt;&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ“ä½œå®Œå é€šçŸ¥å…¶ä»–çº¿ç¨‹</span>
        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ä¸è¯¥Bæ“ä½œ ç­‰å¾…</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        number<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt;&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ“ä½œå®Œå é€šçŸ¥å…¶ä»–çº¿ç¨‹</span>
        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h6 id="è™šå‡å”¤é†’é—®é¢˜"><a href="#è™šå‡å”¤é†’é—®é¢˜" class="header-anchor">#</a> è™šå‡å”¤é†’é—®é¢˜</h6> <p><strong>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå½“å­˜åœ¨å¤§äº2ä¸ªçº¿ç¨‹æ—¶ï¼Œä½¿ç”¨ifå»åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¯¥ç­‰å¾…è¿™ä¸ªæ¡ä»¶æ—¶ï¼Œä¼šé€ æˆè™šå‡å”¤é†’</strong></p> <blockquote><p>è™šå‡å”¤é†’çš„ç†è§£ï¼šåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œäº†wait()æ–¹æ³•åï¼Œéœ€è¦å…¶å®ƒçº¿ç¨‹æ‰§è¡Œnotify()æˆ–è€…notifyAll()æ–¹æ³•å»å”¤é†’ï¼Œå‡å¦‚è¢«é˜»å¡çš„å¤šä¸ªçº¿ç¨‹éƒ½è¢«å”¤é†’ï¼Œä½†å®é™…æƒ…å†µæ˜¯è¢«å”¤é†’çš„çº¿ç¨‹ä¸­æœ‰ä¸€éƒ¨åˆ†çº¿ç¨‹æ˜¯ä¸åº”è¯¥è¢«å”¤é†’çš„ï¼Œé‚£ä¹ˆå¯¹äºè¿™äº›ä¸åº”è¯¥è¢«å”¤é†’çš„çº¿ç¨‹è€Œè¨€å°±æ˜¯è™šå‡å”¤é†’ã€‚</p> <p>è¯´æ˜ï¼šåœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå‡å¦‚çº¿ç¨‹ACæ‰§è¡Œ+1ï¼Œçº¿ç¨‹BDæ‰§è¡Œ-1ï¼Œå½“Aæ‰§è¡Œ+1å‰ï¼ŒCå’ŒBDå‡é˜»å¡åœ¨ifæ–¹æ³•ä½“çš„æœ€å¼€å§‹éƒ¨åˆ†(å·²ç»è¿›å…¥äº†ifæ–¹æ³•ä½“ä¸­)ï¼ŒAæ‰§è¡Œå®Œ+1æ“ä½œåï¼Œnumberå˜ä¸º1ï¼Œå”¤é†’å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹Cã€BDå‡è¢«å”¤é†’ï¼Œæ­¤æ—¶B(-1)å¾—åˆ°æ“ä½œæƒï¼ŒB(-1)å›åˆ°å°±ç»ªçŠ¶æ€ï¼Œnumberå˜æˆ0ï¼Œç„¶åæ­¤æ—¶å¯èƒ½D(-1)æ¯”C(+1)å…ˆå¾—åˆ°æ“ä½œæƒï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰åˆ¤æ–­æ­¤æ—¶çš„numberæ˜¯ä¸æ˜¯1(å› ä¸ºifä¸­çš„è¯­å¥åªæ‰§è¡Œä¸€æ¬¡)ï¼Œ</p> <p><img src="https://images.zaiolos.top/images/202201061137701.png" alt="image-20211107190557984"></p> <p>å®ƒåˆå¯¹number-1ï¼Œnumberå°±å˜æˆäº†-1ã€‚</p></blockquote> <blockquote><p>æ€»ç»“ï¼š<strong>å‡ºç°è™šå‡å”¤é†’çš„åŸå› æ˜¯ä»é˜»å¡æ€åˆ°å°±ç»ªæ€å†åˆ°è¿è¡Œæ€æ²¡æœ‰è¿›è¡Œåˆ¤æ–­ï¼Œæˆ‘ä»¬åªéœ€è¦è®©å…¶æ¯æ¬¡å¾—åˆ°æ“ä½œæƒæ—¶éƒ½è¿›è¡Œåˆ¤æ–­å°±å¯ä»¥äº†</strong></p></blockquote> <blockquote><p>å®˜æ–¹å»ºè®®ï¼šwait()åº”è¯¥æ€»æ˜¯å‡ºç°åœ¨å¾ªç¯ä¸­(ä½¿ç”¨while()æ¥åˆ¤æ–­)</p> <p><img src="https://images.zaiolos.top/images/image-20211107190752154.png" alt="image-20211107190752154"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Number</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//ä½¿ç”¨while é˜²æ­¢è™šå‡å”¤é†’é—®é¢˜</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  number<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt;&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//æ“ä½œå®Œå é€šçŸ¥å…¶ä»–çº¿ç¨‹</span>
  <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//ä½¿ç”¨while é˜²æ­¢è™šå‡å”¤é†’é—®é¢˜</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  number<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt;&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//æ“ä½œå®Œå é€šçŸ¥å…¶ä»–çº¿ç¨‹</span>
  <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></blockquote> <h5 id="ä½¿ç”¨lockåŠå…¶ç›¸å…³çš„await-ã€signal-ã€signalall-æ–¹æ³•æ›¿ä»£synchronizedåŠwait-ã€notify-ã€æ­¤æ–¹æ³•ç›¸å½“äºnotifyall"><a href="#ä½¿ç”¨lockåŠå…¶ç›¸å…³çš„await-ã€signal-ã€signalall-æ–¹æ³•æ›¿ä»£synchronizedåŠwait-ã€notify-ã€æ­¤æ–¹æ³•ç›¸å½“äºnotifyall" class="header-anchor">#</a> ä½¿ç”¨LockåŠå…¶ç›¸å…³çš„await()ã€signal()ã€signalAll()æ–¹æ³•æ›¿ä»£synchronizedåŠwait()ã€notify()ã€æ­¤æ–¹æ³•ç›¸å½“äºnotifyAll()</h5> <blockquote><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//é€šè¿‡Lockæ¥å£çš„å®ä¾‹å¯ä»¥è·å–Conditionå¯¹è±¡</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ­¤æ–¹æ³•ç›¸å½“äºwait()</span>
condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ­¤æ–¹æ³•ç›¸å½“äºnotifyAll()</span>
condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></blockquote> <p>é€šè¿‡ä¸€ä¸ªLockè·å–å¤šä¸ªConditionå¯¹è±¡å®ç°ç²¾å‡†å”¤é†’çº¿ç¨‹ï¼š</p> <blockquote><p>æ€è·¯ï¼šç»™æ‰§è¡Œä¸åŒä»»åŠ¡çš„çº¿ç¨‹åˆ†åˆ«æŒ‡å®šä¸€ä¸ªConditionå¯¹è±¡ï¼Œçº¿ç¨‹åœ¨ä½¿ç”¨await()æ—¶ï¼Œä½¿ç”¨è‡ªå·±çš„Conditionå¯¹è±¡è°ƒç”¨ï¼›åœ¨signal()æ—¶ï¼Œå¯ä»¥ç”¨åˆ«çš„çº¿ç¨‹çš„Conditionå¯¹è±¡è°ƒç”¨ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªçº¿ç¨‹ç²¾å‡†å”¤é†’å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p></blockquote> <p>ä»£ç ç¤ºä¾‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author zdk
 * @date 2021/11/7 19:41
 * Aæ‰§è¡Œå®Œè°ƒç”¨B Bæ‰§è¡Œå®Œè°ƒç”¨C Cæ‰§è¡Œå®Œè°ƒç”¨A,å³ABCä¸‰çº¿ç¨‹é¡ºåºå¾ªç¯æ‰§è¡Œ
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockCondition</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number</span> number <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                number<span class="token punctuation">.</span><span class="token function">printA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                number<span class="token punctuation">.</span><span class="token function">printB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                number<span class="token punctuation">.</span><span class="token function">printC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Number</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> condition1 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> condition2 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> condition3 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ä¸šåŠ¡ï¼Œåˆ¤æ–­-&gt;æ‰§è¡Œ-&gt;é€šçŸ¥</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//ç­‰å¾…</span>
                condition1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//Aæ‰§è¡Œ</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:AAAA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å”¤é†’æŒ‡å®šçš„  B</span>
            number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            condition2<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ä¸šåŠ¡ï¼Œåˆ¤æ–­-&gt;æ‰§è¡Œ-&gt;é€šçŸ¥</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//ç­‰å¾…</span>
                condition2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//Aæ‰§è¡Œ</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:BBBB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å”¤é†’æŒ‡å®šçš„  C</span>
            number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            condition3<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ä¸šåŠ¡ï¼Œåˆ¤æ–­-&gt;æ‰§è¡Œ-&gt;é€šçŸ¥</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//ç­‰å¾…</span>
                condition3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//Aæ‰§è¡Œ</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:CCCC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å”¤é†’æŒ‡å®šçš„  A</span>
            number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            condition1<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><h4 id="é›†åˆçš„çº¿ç¨‹å®‰å…¨"><a href="#é›†åˆçš„çº¿ç¨‹å®‰å…¨" class="header-anchor">#</a> é›†åˆçš„çº¿ç¨‹å®‰å…¨</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//åˆ›å»ºArrayListé›†åˆ</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CollectionThread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;list = &quot;</span> <span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//ä¼šå‡ºç°ConcurrentModificationException å¹¶å‘ä¿®æ”¹å¼‚å¸¸</span>
<span class="token comment">//æ­¤æ–¹æ³•æ²¡æœ‰synchronizedå£°æ˜ æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</span>
<span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>å‡ºç°ConcurrentModificationExceptionçš„åŸå› ï¼šè¾“å‡ºlistæ—¶ï¼Œè°ƒç”¨äº†ArrayListçš„toString()æ–¹æ³•ï¼Œè€ŒArrayListä¸­çš„toStringæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªAbstractCollectionçš„ï¼Œé‡Œé¢æ˜¯è°ƒç”¨äº†Iteratorè¿­ä»£å™¨å°±è¡Œè¾“å‡ºçš„ï¼Œè€ŒListçš„è¿­ä»£å™¨æ˜¯æœ‰fail-fastæœºåˆ¶çš„ï¼ˆé˜²æ­¢å¹¶å‘æ“ä½œå‡ºç°é”™è¯¯ï¼‰ï¼ŒConcurrentModificationExceptionæ˜¯ç”±è¿­ä»£å™¨æŠ›å‡ºçš„ã€‚è¿­ä»£å™¨éå†è°ƒç”¨nextæ–¹æ³•ï¼Œnextæ–¹æ³•è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•æ¥åˆ¤æ–­â€œé¢„æœŸä¿®æ”¹æ¬¡æ•°â€å’Œâ€œå®é™…ä¿®æ”¹æ¬¡æ•°â€ï¼Œè¿­ä»£å™¨éå†Listçš„åŒæ—¶addæ•°æ®çš„è¯â€œå®é™…ä¿®æ”¹æ¬¡æ•°â€ä¼šè‡ªå¢åŠ ä¸€ï¼Œè¿™æ ·çš„è¯â€œé¢„æœŸä¿®æ”¹æ¬¡æ•°â€å’Œâ€œå®é™…ä¿®æ”¹æ¬¡æ•°â€å°±ä¸æƒ³ç­‰ï¼Œæ‰€ä»¥æŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸ã€‚</p></blockquote> <p><img src="https://images.zaiolos.top/images/image-20211108140443118.png" alt="image-20211108140443118"></p> <p>è¦ä¿®æ”¹ä¸ºçº¿ç¨‹å®‰å…¨çš„åšæ³•ï¼š</p> <ol><li><p>Vector</p> <blockquote><p>Vectorä¸‹çš„addæ™®ééƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  modCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> elementCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åœ¨æ”¹å˜ä»£ç æ—¶ï¼Œåªéœ€è¦å°†å…¶ä¿®æ”¹ä¸º<code>List&lt;String&gt; list = new Vector&lt;&gt;();</code>
ä½†æ­¤æ–¹æ³•ç”¨çš„æ¯”è¾ƒå°‘ï¼Œå› ä¸ºåœ¨jdk 1.0çš„ç‰ˆæœ¬é€‚ç”¨</p></blockquote></li> <li><p>Collections</p> <blockquote><p>Collectionsç±»ä¸­çš„å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯staticé™æ€
å…¶ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯è¿”å›æŒ‡å®šåˆ—è¡¨æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰åˆ—è¡¨ä¸º<code>synchronizedList(List &lt;T&gt; list)</code>
å…·ä½“ä»£ç ä¸º</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Collectionsçš„å‡ ä¸ªstaticæ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬å¾—åˆ°çº¿ç¨‹å®‰å…¨çš„Litsã€Setã€Map</p> <p><img src="https://images.zaiolos.top/images/image-20211108140718552.png" alt="image-20211108140718552"></p> <p>ä¸è¿‡æ­¤æ–¹æ³•ä¹Ÿæ¯”è¾ƒå¤è€ï¼Œå¾ˆå°‘ä½¿ç”¨</p></blockquote></li></ol> <p><strong>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼šCopyOnWriteArrayListã€CopyOnWriteArraySetã€ConcurrentHashMapæ¥å®ç°é›†åˆçš„çº¿ç¨‹å®‰å…¨</strong></p> <ol><li><p>CopyOnWriteArrayList</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>æ¶‰åŠçš„åº•å±‚åŸç†ä¸º<strong>å†™æ—¶å¤åˆ¶æŠ€æœ¯</strong></p> <ul><li><p>è¯»çš„æ—¶å€™å¹¶å‘ï¼ˆå¤šä¸ªçº¿ç¨‹æ“ä½œï¼‰</p></li> <li><p>å†™çš„æ—¶å€™ç‹¬ç«‹ï¼Œå…ˆå¤åˆ¶ç›¸åŒçš„ç©ºé—´åˆ°æŸä¸ªåŒºåŸŸï¼Œå°†å…¶å†™åˆ°æ–°åŒºåŸŸï¼Œæ—§æ–°åˆå¹¶ï¼Œå¹¶ä¸”è¯»æ–°åŒºåŸŸï¼ˆæ¯æ¬¡åŠ æ–°å†…å®¹éƒ½å†™åˆ°æ–°åŒºåŸŸï¼Œè¦†ç›–åˆå¹¶ä¹‹å‰æ—§åŒºåŸŸï¼Œè¯»å–æ–°åŒºåŸŸæ·»åŠ çš„å†…å®¹ï¼‰</p></li> <li><p>æºç ï¼š</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
       lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
           <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
           <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
           lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></blockquote></li> <li><p>CopyOnWriteArraySet</p> <p><strong>ä½¿ç”¨æ–¹æ³•åŒä¸Šçš„CopyOnWriteArrayList</strong></p></li> <li><p>ConcurrentHashMap</p> <p>ConcurrentHashMapå®ç°çº¿ç¨‹å®‰å…¨äºŒé˜ŸåŸç†ä¸1ã€2ä¸¤ä¸ªç±»ä¸åŒ</p> <blockquote><p>åœ¨ConcurrentHashMapæ²¡æœ‰å‡ºç°ä»¥å‰ï¼Œjdkä½¿ç”¨hashtableæ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯hashtableæ˜¯å°†æ•´ä¸ªhashè¡¨é”ä½ï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆä½ä¸‹ã€‚</p> <p>ConcurrentHashMapå°†æ•°æ®åˆ†åˆ«æ”¾åˆ°å¤šä¸ªSegmentä¸­ï¼Œé»˜è®¤16ä¸ªï¼Œæ¯ä¸€ä¸ªSegmentä¸­åˆåŒ…å«äº†å¤šä¸ªHashEntryåˆ—è¡¨æ•°ç»„ã€‚</p> <p>å‘ ConcurrentHashMap ä¸­æ’å…¥æ•°æ®æˆ–è€…è¯»å–æ•°æ®ï¼Œé¦–å…ˆéƒ½è¦å°†ç›¸åº”çš„ Key æ˜ å°„åˆ°å¯¹åº”çš„ Segmentï¼Œå› æ­¤ä¸ç”¨é”å®šæ•´ä¸ªç±»ï¼Œ åªè¦å¯¹å•ä¸ªçš„ Segment æ“ä½œè¿›è¡Œä¸Šé”æ“ä½œå°±å¯ä»¥äº†ã€‚ç†è®ºä¸Šå¦‚æœæœ‰ n ä¸ª Segmentï¼Œé‚£ä¹ˆæœ€å¤šå¯ä»¥åŒæ—¶æ”¯æŒ n ä¸ªçº¿ç¨‹çš„å¹¶å‘è®¿é—®ï¼Œä»è€Œå¤§å¤§æé«˜äº†å¹¶å‘è®¿é—®çš„æ•ˆç‡ã€‚</p> <p>å¯¹äºä¸€ä¸ªkeyï¼Œéœ€è¦ç»è¿‡ä¸‰æ¬¡hashæ“ä½œï¼Œæ‰èƒ½æœ€ç»ˆå®šä½è¿™ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œè¿™ä¸‰æ¬¡hashåˆ†åˆ«ä¸ºï¼š</p> <ol><li>å¯¹äºä¸€ä¸ªkeyï¼Œå…ˆè¿›è¡Œä¸€æ¬¡hashæ“ä½œï¼Œå¾—åˆ°hashå€¼h1ï¼Œä¹Ÿå³h1 = hash1(key)ï¼›</li> <li>å°†å¾—åˆ°çš„h1çš„é«˜å‡ ä½è¿›è¡Œç¬¬äºŒæ¬¡hashï¼Œå¾—åˆ°hashå€¼h2ï¼Œä¹Ÿå³h2 = hash2(h1é«˜å‡ ä½)ï¼Œé€šè¿‡h2èƒ½å¤Ÿç¡®å®šè¯¥å…ƒç´ çš„æ”¾åœ¨å“ªä¸ªSegmentï¼›</li> <li>å°†å¾—åˆ°çš„h1è¿›è¡Œç¬¬ä¸‰æ¬¡hashï¼Œå¾—åˆ°hashå€¼h3ï¼Œä¹Ÿå³h3 = hash3(h1)ï¼Œé€šè¿‡h3èƒ½å¤Ÿç¡®å®šè¯¥å…ƒç´ æ”¾ç½®åœ¨å“ªä¸ªHashEntryã€‚</li></ol> <p>æ¯ä¸€ä¸ªSegmentéƒ½æ‹¥æœ‰ä¸€ä¸ªé”ï¼Œå½“è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œåªéœ€è¦é”å®šä¸€ä¸ªSegmentï¼Œè€Œå…¶å®ƒSegmentä¸­çš„æ•°æ®æ˜¯å¯ä»¥è®¿é—®çš„ã€‚</p></blockquote> <p>https://blog.csdn.net/dianzijinglin/article/details/80997935 hashtableè§£æ</p> <p>https://www.cnblogs.com/dolphin0520/p/3932905.html 1.6ç‰ˆæœ¬concurrentHashMapå®ç°</p> <p>https://blog.csdn.net/jianghuxiaojin/article/details/52006118</p> <p>https://www.jianshu.com/p/d10256f0ebea  1.8ç‰ˆæœ¬concurrentHashMapå®ç°</p></li></ol> <h4 id="callable"><a href="#callable" class="header-anchor">#</a> Callable</h4> <blockquote><p>ä¸Runnableæ¥å£ç›¸æ¯”ï¼ŒCallableåŠŸèƒ½æ›´å¼ºå¤§</p> <ul><li>ç›¸æ¯”run()æ–¹æ³•ï¼Œcall()å¯ä»¥æœ‰è¿”å›å€¼</li> <li>call()æ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸</li> <li>Callableæ”¯æŒæ³›å‹çš„è¿”å›å€¼</li> <li>éœ€è¦å€ŸåŠ©FutureTaskç±»ï¼Œæ¯”å¦‚è·å–è¿”å›ç»“æœ</li> <li>Futureæ¥å£
<ul><li>å¯ä»¥å¯¹å…·ä½“Runnableã€Callableä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœç­‰</li> <li>FutureTaskæ˜¯Futrueæ¥å£çš„å”¯ä¸€çš„å®ç°ç±»</li> <li>FutureTaskåŒæ—¶å®ç°äº†Runnable,Futureæ¥å£ã€‚å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼</li></ul></li></ul></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>å…³ç³»è¯´æ˜ï¼š
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å› ä¸ºFutureTaskä¹Ÿæ˜¯Runnableæ¥å£çš„ä¸€ä¸ªå®ç°ç±»</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>newFutureTask<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//FutureTask&lt;V&gt;çš„æ„é€ æ–¹æ³•å¯ä»¥ä¼ å…¥Callableæ¥å£</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä»£ç ç¤ºä¾‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//1.åˆ›å»ºä¸€ä¸ªå®ç°äº†Callableæ¥å£çš„å®ç°ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">NumberCallable</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">//2.å®ç°call()æ–¹æ³•ï¼Œå°†çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨call()ä¸­</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @author zdk
 * @date 2021/11/6 17:25
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//3.åˆ›å»ºCallableæ¥å£å®ç°ç±»çš„å¯¹è±¡</span>
        <span class="token class-name">NumberCallable</span> numberCallable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumberCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.å°†æ­¤Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°FutureTaskçš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºFutureTaskå¯¹è±¡</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>numberCallable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.å°†FutureTaskçš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadçš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadå¯¹è±¡ï¼Œè°ƒç”¨å…¶start()</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//6.å¯ä»¥é€šè¿‡FutureTaskå¯¹è±¡çš„get()æ–¹æ³•è·å–call()æ–¹æ³•çš„è¿”å›å€¼</span>
            <span class="token comment">//get()è¿”å›å€¼å³ä¸ºFutureTaskæ„é€ å™¨å‚æ•°Callableå®ç°ç±»é‡å†™çš„call()çš„è¿”å›å€¼</span>
            <span class="token comment">//get()ä¼šäº§ç”Ÿé˜»å¡</span>
            <span class="token class-name">Integer</span> sum <span class="token operator">=</span> futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><blockquote><p>new Thread(futureTask,&quot;A&quot;).start();
new Thread(futureTask,&quot;B&quot;).start();</p> <ul><li>å¯åŠ¨ä¸¤ä¸ªä¸€æ ·çš„çº¿ç¨‹ï¼Œå®é™…åªä¼šè¾“å‡ºä¸€ä¸ªsumï¼Œæ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹ä½¿ç”¨Callableï¼Œè¿è¡Œç»“æœä¼šåšç¼“å­˜å¤„ç†ï¼Œæé«˜æ•ˆç‡</li> <li>ä½¿ç”¨get()è·å–è¿”å›å€¼æ—¶å¯èƒ½ä¼šé˜»å¡ï¼Œæ‰€ä»¥ä¸€èˆ¬æ”¾åœ¨ç¨‹åºæœ€åæ‰§è¡Œï¼Œæˆ–è€…é‡‡ç”¨å¼‚æ­¥è°ƒç”¨è·å–æ–¹å¼</li></ul></blockquote> <h3 id="å¸¸ç”¨çš„è¾…åŠ©ç±»"><a href="#å¸¸ç”¨çš„è¾…åŠ©ç±»" class="header-anchor">#</a> å¸¸ç”¨çš„è¾…åŠ©ç±»</h3> <h4 id="countdownlatch"><a href="#countdownlatch" class="header-anchor">#</a> <strong>CountDownLatch</strong></h4> <p>ä¸¤ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼š</p> <ul><li>await()ï¼šä½¿å¾—å½“å‰çº¿ç¨‹åœ¨é”å­˜å™¨è®¡æ•°è‡³0ä¹‹å‰ä¸€ç›´ç­‰å¾…(é™¤éçº¿ç¨‹è¢«ä¸­æ–­)</li> <li>coutDown()ï¼šé€’å‡é”å­˜å™¨çš„è®¡æ•°ï¼Œå¦‚æœè®¡æ•°å‡ä¸º0ï¼Œå°†é‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</li></ul> <blockquote><p>CountDownLatch ç±»å¯ä»¥è®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åé€šè¿‡ countDown æ–¹æ³•æ¥è¿›è¡Œå‡ 1 çš„æ“ä½œï¼Œä½¿ç”¨ await() æ–¹æ³•ç­‰å¾…è®¡æ•°å™¨ä¸å¤§äº 0ï¼Œç„¶åç»§ç»­æ‰§è¡Œ await æ–¹æ³•ä¹‹åçš„è¯­å¥</p> <p>å…·ä½“æ­¥éª¤å¯ä»¥æ¼”åŒ–ä¸ºå®šä¹‰ä¸€ä¸ªç±»ï¼Œå‡1æ“ä½œï¼Œå¹¶ç­‰å¾…åˆ°0ï¼Œä¸º0æ‰§è¡Œç»“æœ</p></blockquote> <p>ä»£ç ç¤ºä¾‹:</p> <p>å¦‚æœä¸åŠ  CountDownLatchç±»ï¼Œä¼šå‡ºç°çº¿ç¨‹æ··ä¹±æ‰§è¡Œï¼Œå°å¼ ä»¬è¿˜æœªèµ°å®Œ å°±å·²ç»é”é—¨äº†</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; èµ°äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å¼ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç­‰å¾…è®¡æ•°å™¨å½’é›¶ ç„¶åå†å‘ä¸‹æ‰§è¡Œ</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰€æœ‰äººéƒ½èµ°å®Œäº† å…³é—¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="cyclicbarrier-ç¯±æ …"><a href="#cyclicbarrier-ç¯±æ …" class="header-anchor">#</a> <strong>CyclicBarrier(ç¯±æ …)</strong></h4> <blockquote><p>è¯¥ç±»æ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œå…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹ï¼Œåœ¨è®¾è®¡ä¸€ç»„å›ºå®šå¤§å°çš„çº¿ç¨‹çš„ç¨‹åºä¸­ï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»äº’ç›¸ç­‰å¾…ï¼Œè¿™ä¸ªç±»å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºbarrieråœ¨é‡Šæ”¾ç­‰å¾…çº¿ç¨‹åå¯ä»¥é‡ç”¨ï¼Œæ‰€ä»¥ç§°ä¸ºå¾ªç¯barrier</p></blockquote> <p>ä»£ç ç¤ºä¾‹ï¼šä¸ƒä¸ªè‘«èŠ¦å¨ƒæ•‘yeye</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é›†é½äº†7ä¸ªè‘«èŠ¦å¨ƒ,å¯ä»¥æ•‘yeyeäº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é›†é½&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;è‘«èŠ¦å¨ƒ&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>æ³¨æ„ï¼šå¦‚æœå°†forå¾ªç¯çš„æ¬¡æ•°æ”¹ä¸º15ï¼Œä¼šæœ‰ä¸¤æ¬¡é›†é½è¾“å‡ºï¼Œç„¶åä¼šä¸€ç›´é˜»å¡</p> <p><img src="https://images.zaiolos.top/images/202201061137951.png" alt="image-20211108160207178"></p> <p>å› ä¸ºåé¢åªæœ‰1ä¸ªçº¿ç¨‹æœªæ‰§è¡Œäº†ï¼Œè€ŒcyclicBarrier.await()ä»ç„¶éœ€è¦ç­‰åˆ°æœ‰7ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œã€‚</p> <p>é˜…è¯»æºç å‘ç°ï¼ŒCyclicBarrierå†…éƒ¨æ‰§è¡Œawait()æ—¶è°ƒç”¨dowait()æ–¹æ³•ï¼Œä»æ˜¯å‡æ“ä½œ</p> <p><img src="https://images.zaiolos.top/images/image-20211108160621965.png" alt="image-20211108160621965"></p></blockquote> <h4 id="semaphore-ä¿¡å·é‡"><a href="#semaphore-ä¿¡å·é‡" class="header-anchor">#</a> <strong>Semaphore(ä¿¡å·é‡)</strong></h4> <blockquote><p>Semaphoreæ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œä»æ¦‚å¿µä¸Šè®²ï¼Œä¿¡å·é‡ç»´æŠ¤äº†ä¸€ä¸ªè®¸å¯é›†ï¼Œå¦‚æœ‰å¿…è¦ï¼Œåœ¨è®¸å¯å¯ç”¨å‰ä¼šé˜»å¡æ¯ä¸€ä¸ªacquire()ï¼Œç„¶åå†è·å–è¯¥è®¸å¯ã€‚æ¯ä¸ªrelease()æ·»åŠ ä¸€ä¸ªè®¸å¯ï¼Œä»è€Œå¯èƒ½é‡Šæ”¾ä¸€ä¸ªæ­£åœ¨é˜»å¡çš„è·å–è€…ã€‚ä½†æ˜¯ï¼Œä¸ä½¿ç”¨å®é™…çš„è®¸å¯å¯¹è±¡ï¼ŒSemaphoreåªå¯¹å¯ç”¨è®¸å¯çš„å·ç è¿›è¡Œè®¡æ•°ï¼Œå¹¶é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨</p></blockquote> <ol><li>æ„é€ æ–¹æ³•ï¼š</li></ol> <ul><li><p><code>Semaphore(int permits)</code>åˆ›å»ºå…·æœ‰ç»™å®šçš„è®¸å¯æ•°å’Œéå…¬å¹³çš„å…¬å¹³è®¾ç½®çš„Semapore</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token keyword">permits</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>public Semaphore(int permits, boolean fair)</code>åˆ›å»ºå…·æœ‰ç»™å®šçš„è®¸å¯æ•°å’Œå¯é€‰æ‹©çš„å…¬å¹³è®¾ç½®çš„Semapore</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token keyword">permits</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token keyword">permits</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <ol start="2"><li>å¸¸ç”¨çš„æ–¹æ³•ï¼š</li></ol> <ul><li><code>acquire()</code>ä»æ­¤ä¿¡å·é‡è·å–ä¸€ä¸ªè®¸å¯ï¼Œåœ¨æä¾›ä¸€ä¸ªè®¸å¯å‰ä¸€ç›´å°†çº¿ç¨‹é˜»å¡ï¼Œå¦åˆ™çº¿ç¨‹è¢«ä¸­æ–­</li> <li><code>release()</code>é‡Šæ”¾ä¸€ä¸ªè®¸å¯ï¼Œå°†å…¶è¿”å›ç»™ä¿¡å·é‡</li> <li>ä¸€èˆ¬<code>acquire(ï¼‰</code>éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ<code>release</code>åœ¨<code>finally</code>ä¸­æ‰§è¡Œ</li></ul> <ol start="3"><li><p>ä»£ç ç¤ºä¾‹</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å®šä¹‰ä¿¡å·é‡åŠå…è®¸çš„å¤§å°</span>
        <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//å½“å‰çº¿ç¨‹è·å–ä¿¡å·é‡,å¦‚æœæ²¡è·å–åˆ°,ç­‰å¾…</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;è¿›å…¥é¥­åº—åƒé¥­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;åƒå®Œç¦»å¼€äº†é¥­åº—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">//å½“å‰çº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æ‹¿åˆ°çš„ä¿¡å·é‡</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;é¡¾å®¢&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="https://images.zaiolos.top/images/image-20211108162741451.png" alt="image-20211108162741451"></p></li> <li><p>Semaphoreçš„ç”¨å¤„</p> <p>ä¸»è¦ç”¨äº<strong>å¤šä¸ªå…±äº«èµ„æºäº’æ–¥çš„ä½¿ç”¨çš„åœºæ™¯</strong>ï¼Œå¦‚å¹¶å‘é™æµï¼Œæ§åˆ¶æœ€å¤§çº¿ç¨‹æ•°</p></li></ol> <h3 id="è¯»å†™é”-readwritelockæ¥å£"><a href="#è¯»å†™é”-readwritelockæ¥å£" class="header-anchor">#</a> è¯»å†™é”(ReadWriteLockæ¥å£)</h3> <p>æ¦‚å¿µï¼š</p> <blockquote><ul><li>ReadWriteLockç»´æŠ¤ä¸€å¯¹å…³è”çš„locksï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œä¸€ä¸ªç”¨äºå†™å…¥ã€‚</li> <li>è¯»æ“ä½œå¯ä»¥ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œè€Œå†™æ“ä½œåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</li> <li>ReadWriteLockæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ç°ç±» ReentrantReadWriteLockï¼šå¯é‡å…¥è¯»å†™é”</li> <li>åŸåˆ™ä¸Šè¯»å†™é—®é¢˜ä½¿ç”¨synchronizedå’ŒLockå¯ä»¥è§£å†³ï¼Œä½†æ˜¯ç²’åº¦è¾ƒè¯»å†™é”å¤§ã€‚</li> <li>å†™é”ç›¸å½“äºç‹¬å é”ï¼Œè¯»é”ç›¸å½“äºå…±äº«é”</li></ul></blockquote> <p>ç›¸æ¯”äºæ™®é€šäº’æ–¥é”ï¼š</p> <ul><li>ç›¸æ¯”äº’æ–¥é”ï¼Œæ›´åŠ ç»†ç²’åº¦</li> <li>åœ¨ç†è®ºä¸Šï¼Œé€šè¿‡ä½¿ç”¨è¯»å†™é”å…è®¸çš„å¹¶å‘æ€§å¢åŠ å°†å¯¼è‡´æ€§èƒ½æ”¹è¿›è¶…è¿‡ä½¿ç”¨äº’æ–¥é”</li> <li>è¯»å†™é”æ˜¯å¦ä¼šæé«˜ä½¿ç”¨äº’æ–¥é”çš„æ€§èƒ½ï¼Œå–å†³äºæ•°æ®è¢«è¯»å–çš„é¢‘ç‡ä¸è¢«ä¿®æ”¹çš„é¢‘ç‡ç›¸æ¯”ï¼Œè¯»å–å’Œå†™å…¥æ“ä½œçš„æŒç»­æ—¶é—´ä»¥åŠæ•°æ®çš„äº‰ç”¨ã€‚å³æ˜¯ï¼Œå°†å°è¯•åŒæ—¶è¯»å–æˆ–å†™å…¥æ•°æ®çš„çº¿ç¨‹æ•°ã€‚ä¾‹å¦‚ï¼Œæœ€åˆå¡«å……æ•°æ®çš„é›†åˆï¼Œç„¶åç»å¸¸è¢«ä¿®æ”¹çš„é¢‘ç¹æœç´¢ï¼ˆä¾‹å¦‚æŸç§ç›®å½•ï¼‰æ˜¯ä½¿ç”¨è¯»å†™é”çš„ç†æƒ³å€™é€‰ã€‚ ç„¶è€Œï¼Œå¦‚æœæ›´æ–°å˜å¾—é¢‘ç¹ï¼Œé‚£ä¹ˆæ•°æ®çš„å¤§éƒ¨åˆ†æ—¶é—´å°†è¢«ä¸“é—¨é”å®šï¼Œå¹¶ä¸”å¹¶å‘æ€§å¢åŠ å¾ˆå°‘ã€‚ä¸å»ºè®®ä½¿ç”¨è¯»å†™é”ã€‚<strong>ç®€å•ç†è§£å°±æ˜¯ ç»å¸¸è¢«ä¿®æ”¹çš„è¯»å–çš„æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨è¯»å†™é”ï¼Œå¯¹äºä¸é•¿å˜åŠ¨è€Œä¸” å¹¶å‘å¾ˆå°‘çš„æƒ…å†µï¼Œä¸å»ºè®®ä½¿ç”¨è¯»å†™é”ã€‚</strong></li></ul> <blockquote><p>ç‹¬å é”(å†™é”)ï¼šä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰</p> <p>å…±äº«é”(è¯»é”)ï¼šå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰</p> <p>ReadWriteLockä¸­ï¼š</p> <p>è¯»-è¯»ï¼šå¯ä»¥å…±å­˜</p> <p>è¯»-å†™ï¼šä¸èƒ½å…±å­˜</p> <p>å†™-å†™ï¼šä¸èƒ½å…±å­˜</p></blockquote> <ol><li><p><strong>è‡ªå®šä¹‰ç¼“å­˜ä¸åŠ é”æƒ…å†µï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadWriteLockDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyCache</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        MyCacheWriteReadLock cache = new MyCacheWriteReadLock();</span>
<span class="token comment">//        MyCacheSynchronized cache = new MyCacheSynchronized();</span>
<span class="token comment">//        MyCacheLock cache = new MyCacheLock();</span>

        <span class="token comment">// æ¨¡æ‹Ÿ4ä¸ªçº¿ç¨‹å†™å…¥ç¼“å­˜</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                cache<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>temp <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>temp<span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token comment">// æ¨¡æ‹Ÿ4ä¸ªçº¿ç¨‹è¯»å–ç¼“å­˜</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>temp <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * æ¨¡æ‹Ÿç¼“å­˜ å†™å…¥ã€è¯»å– ä¸åŠ ä»»ä½•é”
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyCache</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>  cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹å†™å…¥æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å†™å…¥æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹è·å–æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹è·å–æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
è¾“å‡º<span class="token operator">:</span>
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ® <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span> æ­£ç¡®çš„é€»è¾‘åº”è¯¥æ˜¯å†™å…¥ç„¶åè¯»å–ï¼Œä½†æ˜¯ä¸åŠ é”çš„æ—¶å€™ï¼Œè¯»å–ä¹‹å‰è¢« å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°äº†ç¼“å­˜
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">4</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">4</span>
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">2</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2</span>
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">3</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">3</span>
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">1</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">2</span>
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">3</span>
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">1</span>
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">4</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div></li> <li><p><strong>åŠ ä¸Šè¯»å†™é”ï¼š</strong></p> <ul><li>// è¯»å†™é”å¯¹è±¡
ReentrantReadWriteLock reentrantReadWriteLock = new ReentrantReadWriteLock();</li> <li>// åŠ å…¥å†™é”,ä¿è¯åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å†™,// é‡Šæ”¾å†™é”
reentrantReadWriteLock.writeLock().lock(); reentrantReadWriteLock.writeLock().unlock();</li> <li>// åŠ ä¸Šè¯»é”ï¼Œä¿è¯è¯»çš„æ—¶å€™ä¸èƒ½æœ‰å…¶ä»–çº¿ç¨‹å†™ // é‡Šæ”¾è¯»é”
reentrantReadWriteLock.readLock().lock(); reentrantReadWriteLock.readLock().unlock();</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 2. æ¨¡æ‹Ÿç¼“å­˜ åŠ è¯»å†™é” å†™å…¥ã€è¯»å–
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyCacheWriteReadLock</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>  cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * è¯»å†™é”
     */</span>
    <span class="token class-name">ReentrantReadWriteLock</span> reentrantReadWriteLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// åŠ å…¥å†™é”,ä¿è¯åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å†™</span>
        reentrantReadWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹å†™å…¥æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å†™å…¥æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// é‡Šæ”¾å†™é”</span>
            reentrantReadWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// åŠ ä¸Šè¯»é”ï¼Œä¿è¯è¯»çš„æ—¶å€™ä¸èƒ½æœ‰å…¶ä»–çº¿ç¨‹å†™</span>
        reentrantReadWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹è·å–æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹è·å–æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// é‡Šæ”¾è¯»é”</span>
            reentrantReadWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
è¾“å‡º<span class="token operator">:</span>
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">2</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">2</span>
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">3</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">3</span>
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">1</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">1</span>
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹å†™å…¥æ•°æ®
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å†™å…¥æˆåŠŸäº† <span class="token number">4</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">4</span>
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">1</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">1</span>
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">3</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">3</span>
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹å¼€å§‹è·å–æ•°æ®
<span class="token number">2</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">2</span>
<span class="token number">4</span><span class="token operator">==</span><span class="token operator">=</span>ã€‹è·å–æˆåŠŸäº† <span class="token number">4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div></li> <li><h5 id="åŠ ä¸Šlocké”å’Œsynchronizedæƒ…å†µ"><a href="#åŠ ä¸Šlocké”å’Œsynchronizedæƒ…å†µ" class="header-anchor">#</a> åŠ ä¸ŠLocké”å’Œsynchronizedæƒ…å†µ:</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 3. æ¨¡æ‹Ÿç¼“å­˜ åŠ synchronized å†™å…¥ã€è¯»å–
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyCacheSynchronized</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>  cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span>  <span class="token keyword">synchronized</span> <span class="token keyword">void</span>  <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹å†™å…¥æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å†™å…¥æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span>  <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹è·å–æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹è·å–æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 4. æ¨¡æ‹Ÿç¼“å­˜ åŠ Locké” å†™å…¥ã€è¯»å–
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyCacheLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>  cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹å†™å…¥æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å†™å…¥æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹å¼€å§‹è·å–æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===ã€‹è·å–æˆåŠŸäº† &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></li></ol> <h3 id="é˜»å¡é˜Ÿåˆ—-blockingqueue"><a href="#é˜»å¡é˜Ÿåˆ—-blockingqueue" class="header-anchor">#</a> é˜»å¡é˜Ÿåˆ—(BlockingQueue)</h3> <blockquote><ul><li>é˜»å¡é˜Ÿåˆ—æ˜¯å…±äº«é˜Ÿåˆ—(å¤šçº¿ç¨‹æ“ä½œ)ï¼Œä¸€ç«¯è¾“å…¥ï¼Œä¸€ç«¯è¾“å‡º</li> <li>é˜Ÿåˆ—çš„å®¹é‡ä¸æ˜¯æ— é™çš„ï¼Œæ»¡äº†ä¹‹åå°±ä¼šè¿›å…¥é˜»å¡ï¼Œå–å‡ºä¹ŸåŒç†</li> <li>å½“é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œå°†ä¼šåˆ«é˜»å¡</li> <li>å½“é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œä»é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li> <li>è¯•å›¾ä»ç©ºçš„é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼ŒçŸ¥é“å…¶ä»–çº¿ç¨‹å¾€ç©ºçš„é˜Ÿåˆ—ä¸­æ’å…¥æ–°çš„å…ƒç´ </li> <li>è¯•å›¾å‘å·²æ»¡çš„é˜Ÿåˆ—ä¸­æ·»åŠ æ–°å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æˆ–è€…å®Œå…¨æ¸…ç©ºï¼Œä½¿é˜Ÿåˆ—å˜å¾—ç©ºé—²èµ·æ¥å¹¶åç»­æ–°å¢</li></ul></blockquote> <h3 id="å››ç»„api"><a href="#å››ç»„api" class="header-anchor">#</a> å››ç»„API</h3> <table><thead><tr><th>æ–¹å¼</th> <th>æŠ›å‡ºå¼‚å¸¸</th> <th>ä¸æŠ›å‡ºå¼‚å¸¸ã€æœ‰è¿”å›å€¼</th> <th>ä¸€ç›´é˜»å¡ç­‰å¾…</th> <th>è¶…æ—¶ç­‰å¾…(è®¾ç½®ç­‰å¾…çš„æ—¶é—´,è¶…æ—¶åˆ™ä¸å†ç­‰å¾…)</th></tr></thead> <tbody><tr><td>æ·»åŠ </td> <td>add(E e)</td> <td>offer()</td> <td>put(E e)</td> <td>offer(E e,long time,TimeUnit timeUnit)</td></tr> <tr><td>ç§»é™¤</td> <td>remove()</td> <td>poll()</td> <td>take()</td> <td>poll(long time,TimeUnit timeUnit)</td></tr> <tr><td>åˆ¤æ–­é˜Ÿåˆ—é¦–éƒ¨å…ƒç´ </td> <td>element()</td> <td>peek()</td> <td></td> <td></td></tr></tbody></table> <p>ä»£ç ç¤ºä¾‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlockingQueueDemo01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
<span class="token comment">//        test1();</span>
<span class="token comment">//        test2();</span>
<span class="token comment">//        test3();</span>
        <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//elementæŸ¥çœ‹é˜Ÿé¦–å…ƒç´  å¤±è´¥æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//peekæŸ¥çœ‹é˜Ÿé¦–å…ƒç´  å¤±è´¥ä¸æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//IllegalStateException: Queue full</span>
<span class="token comment">//        System.out.println(blockingQueue.add(&quot;d&quot;));</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//removeç§»é™¤é˜Ÿåˆ—é¦–å…ƒç´  è¿”å›ç§»é™¤çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒæŠ›å‡ºå¼‚å¸¸NoSuchElementException</span>
<span class="token comment">//        System.out.println(blockingQueue.remove());</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//offeråŠ å…¥å…ƒç´  å¤±è´¥è¿”å›false ä¸æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//pollç§»é™¤é˜Ÿåˆ—é¦–å…ƒç´  å¤±è´¥è¿”å›null ä¸æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åŠ å…¥å…ƒç´  æŠ›å‡ºå¼‚å¸¸ é˜Ÿåˆ—æ»¡åä¸€ç›´é˜»å¡ç­‰å¾…</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        blockingQueue.put(&quot;d&quot;);</span>

        <span class="token comment">//è·å–é˜Ÿåˆ—é¦–å…ƒç´  ä¸æŠ›å‡ºå¼‚å¸¸ é˜Ÿåˆ—ç©ºæ—¶ä¸€ç›´ç­‰å¾…é˜»å¡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//offeråŠ å…¥å…ƒç´ (è¶…æ—¶ç­‰å¾…),ç­‰å¾…ä¸¤ç§’,å¦‚æœä»ä¸èƒ½åŠ å…¥,åˆ™è¿”å›false ä¸æŠ›å‡ºå¼‚å¸¸ é€€å‡º</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//pollç§»é™¤é˜Ÿåˆ—é¦–å…ƒç´ (è¶…æ—¶ç­‰å¾…) è¶…æ—¶å¤±è´¥è¿”å›null ä¸æŠ›å‡ºå¼‚å¸¸ é€€å‡º</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><h3 id="é˜»å¡é˜Ÿåˆ—åˆ†ç±»"><a href="#é˜»å¡é˜Ÿåˆ—åˆ†ç±»" class="header-anchor">#</a> é˜»å¡é˜Ÿåˆ—åˆ†ç±»</h3> <h4 id="_1-arrayblockingqueue"><a href="#_1-arrayblockingqueue" class="header-anchor">#</a> 1.ArrayBlockingQueue</h4> <blockquote><ul><li>ç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</li> <li>ArrayBlockingQueueåœ¨ç”Ÿäº§è€…æ”¾å…¥æ•°æ®å’Œæ¶ˆè´¹è€…è·å–æ•°æ®ï¼Œéƒ½æ˜¯å…±ç”¨ä¸€ä¸ªé”å¯¹è±¡ï¼Œæ— æ³•å¹¶è¡Œ</li></ul></blockquote> <h4 id="_2-linkedblockingqueue"><a href="#_2-linkedblockingqueue" class="header-anchor">#</a> 2.LinkedBlockingQueue</h4> <blockquote><p>ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œï¼ˆä½†å¤§å°é»˜è®¤å€¼ä¸ºInteger.MAX_VALUEï¼‰é˜»å¡é˜Ÿåˆ—</p> <ul><li>ä¹‹æ‰€ä»¥èƒ½å¤Ÿé«˜æ•ˆçš„å¤„ç†å¹¶å‘æ•°æ®ï¼Œè¿˜å› ä¸ºå…¶å¯¹äºç”Ÿäº§è€…ç«¯å’Œæ¶ˆè´¹è€…ç«¯åˆ†åˆ«é‡‡ç”¨äº†ç‹¬ç«‹çš„é”æ¥æ§åˆ¶æ•°æ®åŒæ­¥ï¼Œè¿™ä¹Ÿæ„å‘³ç€åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œåœ°æ“ä½œé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œä»¥æ­¤æ¥æé«˜æ•´ä¸ªé˜Ÿåˆ—çš„å¹¶å‘æ€§èƒ½</li></ul></blockquote> <h4 id="_3-delayqueue"><a href="#_3-delayqueue" class="header-anchor">#</a> 3.DelayQueue</h4> <blockquote><p>ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—</p> <ul><li>DelayQueue ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´ ã€‚DelayQueue æ˜¯ä¸€ä¸ªæ²¡æœ‰å¤§å°é™åˆ¶çš„é˜Ÿåˆ—ï¼Œ<code>å› æ­¤å¾€é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®çš„æ“ä½œï¼ˆç”Ÿäº§è€…ï¼‰æ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œåªæœ‰è·å–æ•°æ®çš„æ“ä½œï¼ˆæ¶ˆè´¹è€…ï¼‰æ‰ä¼šè¢«é˜»å¡</code></li></ul></blockquote> <h4 id="_4-priorityblockingqueue"><a href="#_4-priorityblockingqueue" class="header-anchor">#</a> 4.PriorityBlockingQueue</h4> <blockquote><p>åŸºäºä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—
æ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</p> <p><code>ä¸ä¼šé˜»å¡æ•°æ®ç”Ÿäº§è€…ï¼Œè€Œåªä¼šåœ¨æ²¡æœ‰å¯æ¶ˆè´¹çš„æ•°æ®æ—¶ï¼Œé˜»å¡æ•°æ®çš„æ¶ˆè´¹è€…</code></p></blockquote> <h4 id="_5-synchronousqueue"><a href="#_5-synchronousqueue" class="header-anchor">#</a> 5.SynchronousQueue</h4> <blockquote><p>ä¸€ç§æ— ç¼“å†²çš„ç­‰å¾…é˜Ÿåˆ—
ç›¸å¯¹äºæœ‰ç¼“å†²çš„ BlockingQueue æ¥è¯´ï¼Œå°‘äº†ä¸€ä¸ªä¸­é—´ç»é”€å•†çš„ç¯èŠ‚ï¼ˆç¼“å†²åŒºï¼‰
ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå³å•ä¸ªå…ƒç´ çš„é˜Ÿåˆ—</p> <p>åŒæ­¥é˜Ÿåˆ—ï¼šåŠ å…¥ä¸€ä¸ªå…ƒç´ å¿…é¡»ç­‰å¾…å–å‡ºä¹‹åï¼Œæ‰èƒ½å†å¾€é‡Œé¢æ”¾å…¥ä¸€ä¸ªå…ƒç´ </p> <p>å­˜ï¼šput()  å–ï¼štake()</p> <p>å£°æ˜ä¸€ä¸ª SynchronousQueue æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ç€ä¸å¤ªä¸€æ ·çš„è¡Œä¸ºã€‚
å…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼çš„åŒºåˆ«:
â€¢ å…¬å¹³æ¨¡å¼ï¼šSynchronousQueue ä¼šé‡‡ç”¨å…¬å¹³é”ï¼Œå¹¶é…åˆä¸€ä¸ª FIFO é˜Ÿåˆ—æ¥é˜»å¡å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä»è€Œä½“ç³»æ•´ä½“çš„å…¬å¹³ç­–ç•¥ï¼›</p> <p>â€¢ éå…¬å¹³æ¨¡å¼ï¼ˆSynchronousQueue é»˜è®¤ï¼‰ï¼šSynchronousQueue é‡‡ç”¨éå…¬å¹³é”ï¼ŒåŒæ—¶é…åˆä¸€ä¸ª LIFO é˜Ÿåˆ—æ¥ç®¡ç†å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</p> <p>è€Œåä¸€ç§æ¨¡å¼ï¼Œå¦‚æœç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦æœ‰å·®è·ï¼Œåˆ™å¾ˆå®¹æ˜“å‡ºç°é¥¥æ¸´çš„æƒ…å†µï¼Œå³å¯èƒ½æœ‰æŸäº›ç”Ÿäº§è€…æˆ–è€…æ˜¯æ¶ˆè´¹è€…çš„æ•°æ®æ°¸è¿œéƒ½å¾—ä¸åˆ°å¤„ç†</p></blockquote> <h4 id="_6-linkedtransferqueue"><a href="#_6-linkedtransferqueue" class="header-anchor">#</a> 6.LinkedTransferQueue</h4> <blockquote><p>ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡ TransferQueue é˜Ÿåˆ—
ç”±é“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</p> <ul><li>é¢„å æ¨¡å¼ã€‚æ„æ€å°±æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹å–å…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥å–èµ°æ•°æ®ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹å…ƒç´ ä¸º nullï¼‰å…¥é˜Ÿï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¢«ç­‰å¾…åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”Ÿäº§è€…çº¿ç¨‹å…¥é˜Ÿæ—¶å‘ç°æœ‰ä¸€ä¸ªå…ƒç´ ä¸º null çš„èŠ‚ç‚¹ï¼Œç”Ÿäº§è€…çº¿ç¨‹å°±ä¸å…¥é˜Ÿäº†ï¼Œç›´æ¥å°±å°†å…ƒç´ å¡«å……åˆ°è¯¥èŠ‚ç‚¹ï¼Œå¹¶å”¤é†’è¯¥èŠ‚ç‚¹ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„æ¶ˆè´¹è€…çº¿ç¨‹å–èµ°å…ƒç´ ï¼Œä»è°ƒç”¨çš„æ–¹æ³•è¿”å›</li></ul></blockquote> <h4 id="_7-linkedblockingdeque"><a href="#_7-linkedblockingdeque" class="header-anchor">#</a> 7.LinkedBlockingDeque</h4> <blockquote><p>ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—
é˜»å¡æœ‰ä¸¤ç§æƒ…å†µ</p> <ul><li>æ’å…¥å…ƒç´ æ—¶: å¦‚æœå½“å‰é˜Ÿåˆ—å·²æ»¡å°†ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€ç›´ç­‰åˆ°é˜Ÿåˆ—æœ‰ç©ºçš„ä½ç½®æ—¶å†è¯¥å…ƒç´ æ’å…¥ï¼Œè¯¥æ“ä½œå¯ä»¥é€šè¿‡è®¾ç½®è¶…æ—¶å‚æ•°ï¼Œè¶…æ—¶åè¿”å› false è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®è¶…æ—¶å‚æ•°ä¸€ç›´é˜»å¡ï¼Œä¸­æ–­åæŠ›å‡º InterruptedExceptionå¼‚å¸¸</li> <li>è¯»å–å…ƒç´ æ—¶: å¦‚æœå½“å‰é˜Ÿåˆ—ä¸ºç©ºä¼šé˜»å¡ä½ç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©ºç„¶åè¿”å›å…ƒç´ ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡è®¾ç½®è¶…æ—¶å‚æ•°</li></ul></blockquote> <h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="header-anchor">#</a> çº¿ç¨‹æ± </h3> <blockquote><p><strong>è¿æ¥æ± </strong>ï¼š<strong>è¿æ¥æ± </strong>æ˜¯åˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªè¿æ¥çš„ç¼“å†²æ± çš„æŠ€æœ¯ï¼Œè¿™äº›è¿æ¥å‡†å¤‡å¥½è¢«ä»»ä½•éœ€è¦å®ƒä»¬çš„çº¿ç¨‹ä½¿ç”¨</p></blockquote> <blockquote><p><strong>çº¿ç¨‹æ± ï¼ˆthread poolï¼‰</strong>ï¼šä¸€ç§çº¿ç¨‹ä½¿ç”¨æ¨¡å¼ã€‚çº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥è°ƒåº¦å¼€é”€ï¼Œè¿›è€Œå½±å“ç¼“å­˜å±€éƒ¨æ€§å’Œæ•´ä½“æ€§èƒ½ã€‚è€Œçº¿ç¨‹æ± ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…ç€ç›‘ç£ç®¡ç†è€…åˆ†é…å¯å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™é¿å…äº†åœ¨å¤„ç†çŸ­æ—¶é—´ä»»åŠ¡æ—¶åˆ›å»ºä¸é”€æ¯çº¿ç¨‹çš„ä»£ä»·ã€‚çº¿ç¨‹æ± ä¸ä»…èƒ½å¤Ÿä¿è¯å†…æ ¸çš„å……åˆ†åˆ©ç”¨ï¼Œè¿˜èƒ½é˜²æ­¢è¿‡åˆ†è°ƒåº¦</p> <p><strong>ç‰¹ç‚¹</strong>:</p> <ul><li>é™ä½èµ„æºæ¶ˆè€—ï¼šé€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—</li> <li>æé«˜å“åº”é€Ÿåº¦ï¼šå½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œ</li> <li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼šçº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li></ul> <p><strong>è¦ç‚¹</strong>ï¼šä¸‰å¤§æ–¹æ³•ã€ä¸ƒå¤§å‚æ•°ã€å››ç§æ‹’ç»ç­–ç•¥</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolDemo01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å•ä¸ªçº¿ç¨‹</span>
<span class="token comment">//        ExecutorService executorService = Executors.newSingleThreadExecutor();</span>
<span class="token comment">//        ExecutorService executorService = Executors.newFixedThreadPool(5);</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="ä¸ƒå¤§å‚æ•°æºç "><a href="#ä¸ƒå¤§å‚æ•°æºç " class="header-anchor">#</a> ä¸ƒå¤§å‚æ•°æºç </h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span> <span class="token comment">//æ ¸å¿ƒçº¿ç¨‹æ•°</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span> <span class="token comment">//æœ€å¤§çº¿ç¨‹æ•°</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span> <span class="token comment">//è¶…æ—¶æ—¶é—´æ•°</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span> <span class="token comment">//è¶…æ—¶æ—¶é—´å•ä½</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span> <span class="token comment">//å·¥ä½œé˜»å¡é˜Ÿåˆ—</span>
                              <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span> <span class="token comment">//åˆ›å»ºçº¿ç¨‹çš„å·¥å‚</span>
                              <span class="token class-name">RejectedExecutionHandler</span> handler <span class="token comment">//æ‹’ç»ç­–ç•¥</span>
                         <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>corePoolSize <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
            maximumPoolSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span>
            maximumPoolSize <span class="token operator">&lt;</span> corePoolSize <span class="token operator">||</span>
            keepAliveTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>workQueue <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> threadFactory <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>acc <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span>
                <span class="token keyword">null</span> <span class="token operator">:</span>
                <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>corePoolSize <span class="token operator">=</span> corePoolSize<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maximumPoolSize <span class="token operator">=</span> maximumPoolSize<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>workQueue <span class="token operator">=</span> workQueue<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keepAliveTime <span class="token operator">=</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadFactory <span class="token operator">=</span> threadFactory<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><blockquote><ul><li><code>int corePoolSize</code>, å¸¸é©»çº¿ç¨‹æ•°é‡ï¼ˆæ ¸å¿ƒï¼‰</li> <li><code>int maximumPoolSize</code>,æœ€å¤§çº¿ç¨‹æ•°é‡</li> <li><code>long keepAliveTime,TimeUnit unit</code>,çº¿ç¨‹å­˜æ´»æ—¶é—´</li> <li><code>BlockingQueue&lt;Runnable&gt; workQueue</code>,é˜»å¡é˜Ÿåˆ—ï¼ˆæ’é˜Ÿçš„çº¿ç¨‹æ”¾å…¥ï¼‰</li> <li><code>ThreadFactory threadFactory</code>,çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹</li> <li><code>RejectedExecutionHandler handler</code>æ‹’ç»ç­–ç•¥ï¼ˆçº¿ç¨‹æ»¡äº†ä¸”é˜»å¡é˜Ÿåˆ—æ»¡äº†å¦‚ä½•å¤„ç†ï¼‰</li></ul></blockquote> <h4 id="å››ç§æ‹’ç»ç­–ç•¥ç±»"><a href="#å››ç§æ‹’ç»ç­–ç•¥ç±»" class="header-anchor">#</a> å››ç§æ‹’ç»ç­–ç•¥ç±»ï¼š</h4> <p><img src="https://images.zaiolos.top/images/202201061137957.png" alt="image-20211110175800442"></p> <ol><li><p>æŠ›å¼‚å¸¸</p> <blockquote><p>AbortPolicy(é»˜è®¤)ï¼šç›´æ¥æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</p> <p><img src="https://images.zaiolos.top/images/image-20211110181503075.png" alt="image-20211110181503075"></p></blockquote></li> <li><p>è°è°ƒç”¨æ‰¾è°</p> <blockquote><p>CallerRunsPolicyï¼š&quot;è°ƒç”¨è€…è¿è¡Œ&quot;ï¼šä¸€ç§è°ƒèŠ‚æœºåˆ¶ï¼Œè¯¥ç­–ç•¥æ—¢ä¸ä¼šæŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡ã€‚ä¾‹å¦‚å¦‚æœå½“å‰çº¿ç¨‹æ± å’Œé˜»å¡é˜Ÿåˆ—å‡è¾¾åˆ°äº†æœ€å¤§å®¹é‡ï¼Œä»æœ‰å¤šçš„çº¿ç¨‹å¸Œæœ›æ‰§è¡Œï¼Œåˆ™ä¼šä½¿ç”¨ä¸»çº¿ç¨‹(main)æ‰§è¡Œ</p> <p><img src="https://images.zaiolos.top/images/202201061137096.png" alt="image-20211110181419697"></p></blockquote></li> <li><p>æŠ›å¼ƒæœ€ä¹…æ‰§è¡Œå½“å‰</p> <blockquote><p>DiscardOldestPolicyï¼šæŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡(å°è¯•å’Œæœ€æ—©çš„ç«äº‰)ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ï¼Œ</p> <p>å¤±è´¥ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸</p></blockquote></li> <li><p>ä¸ç†ä¸é—®</p> <blockquote><p>DiscardPolicyï¼šè¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§ç­–ç•¥</p></blockquote></li></ol> <p>çº¿ç¨‹æ± æŠ½è±¡ï¼š</p> <p><img src="https://images.zaiolos.top/images/202201061137106.png" alt="image-20211110175146651"></p> <p><code>ä»£ç ç¤ºä¾‹</code>ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
                <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token number">3L</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//10ä¸ªçº¿ç¨‹ï¼Œä½†æœ€å¤§çº¿ç¨‹æ•°åªæœ‰5ï¼Œä¸”ç”¨äºç­‰å¾…çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º3</span>
        <span class="token comment">//æ€»çš„èƒ½å®¹çº³çš„çº¿ç¨‹æ•°ä¸º8  å¦‚æœå¦‚ä¸‹ è¶…è¿‡ åˆ™ä¼šå‡ºç° RejectedExecutionException</span>
        <span class="token comment">//å› ä¸ºè®¾å®šçš„æ‹’ç»ç­–ç•¥ä¸ºAbortPolicy</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; å¤„ç†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="cpuå¯†é›†å‹å’Œioå¯†é›†å‹"><a href="#cpuå¯†é›†å‹å’Œioå¯†é›†å‹" class="header-anchor">#</a> CPUå¯†é›†å‹å’ŒIOå¯†é›†å‹</h4> <ol><li><p>æ± çš„å¤§å°å¦‚ä½•å®šä¹‰ï¼š</p> <ul><li><p>CPUå¯†é›†å‹ï¼šCPUå¤šå°‘æ ¸å¿ƒï¼Œå³å¯åŒæ—¶æ‰§è¡Œå¤šå°‘æ¡çº¿ç¨‹</p> <blockquote><p>å¯ä»¥é€šè¿‡ Runtime.getRuntime().availableProcessors();ä»£ç è·å–CPUæ ¸å¿ƒæ•°</p></blockquote></li> <li><p>IOå¯†é›†å‹ï¼šåˆ¤æ–­ç¨‹åºä¸­ååˆ†è€—IOçš„çº¿ç¨‹æ•°é‡ï¼Œå°†æœ€å¤§çº¿ç¨‹æ•°è®¾ä¸ºå¤§äºæ­¤æ•°é‡</p></li></ul></li></ol> <h3 id="forkjoin-åˆ†æ”¯åˆå¹¶"><a href="#forkjoin-åˆ†æ”¯åˆå¹¶" class="header-anchor">#</a> ForkJoin(åˆ†æ”¯åˆå¹¶)</h3> <blockquote><p>ä»jdk1.7å¼€å§‹å­˜åœ¨ã€‚å¯ä»¥å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œæé«˜æ•ˆç‡ã€‚å»ºè®®åœ¨å¤§æ•°æ®é‡æ—¶ä½¿ç”¨</p></blockquote> <blockquote><p>ForkJoinç‰¹ç‚¹ï¼šå·¥ä½œçªƒå–</p> <p>ä¸¾ä¾‹ï¼šAçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œäº†ä¸€éƒ¨åˆ†æ—¶ï¼ŒBçº¿ç¨‹ä»»åŠ¡å·²æ‰§è¡Œå®Œï¼Œè¿™æ—¶Bçº¿ç¨‹å°±ä¼šå°†Açº¿ç¨‹çš„ä»»åŠ¡&quot;çªƒå–&quot;è¿‡æ¥è‡ªå·±å®Œæˆã€‚</p> <p><img src="https://images.zaiolos.top/images/202201061137074.png" alt="image-20211111201623717"></p></blockquote> <p><strong>æ¦‚å¿µï¼š</strong></p> <blockquote><p>å°†ä¸€ä¸ªå¤§çš„ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæœ€åå°†å­ä»»åŠ¡ç»“æœåˆå¹¶æˆæœ€åçš„è®¡ç®—ç»“æœ</p></blockquote> <ul><li><strong>ForkJoinTask</strong>:æˆ‘ä»¬è¦ä½¿ç”¨ Fork/Join æ¡†æ¶ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª ForkJoin ä»»åŠ¡ã€‚è¯¥ç±»æä¾›äº†åœ¨ä»»åŠ¡ä¸­æ‰§è¡Œ fork å’Œ join çš„æœºåˆ¶ã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥é›†æˆ ForkJoinTask ç±»ï¼Œåªéœ€è¦ç»§æ‰¿å®ƒçš„å­ç±»ï¼ŒFork/Join æ¡†æ¶æä¾›äº†ä¸¤ä¸ªå­ç±»ï¼š
<ul><li><strong>RecursiveAction</strong>ï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡</li> <li><strong>RecursiveTask</strong>:ç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡</li></ul></li> <li>ForkJoinPool:ForkJoinTask éœ€è¦é€šè¿‡ ForkJoinPool æ¥æ‰§è¡Œ</li> <li>RecursiveTask: ç»§æ‰¿åå¯ä»¥å®ç°é€’å½’(è‡ªå·±è°ƒè‡ªå·±)è°ƒç”¨çš„ä»»åŠ¡</li></ul> <p>åˆ›å»ºåˆ†æ”¯åˆå¹¶å¯¹è±¡ï¼Œé€šè¿‡è¯¥å¯¹è±¡è°ƒç”¨å†…éƒ¨æ–¹æ³•</p> <p><strong>demoï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinDemo</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * ForkJoin 150-220ms
     * @throws ExecutionException
     * @throws InterruptedException
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> demoTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinDemoTest</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span> <span class="token number">1000000000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> submit <span class="token operator">=</span> forkJoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>demoTest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> result <span class="token operator">=</span> submit<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æœï¼š&quot;</span><span class="token operator">+</span>result<span class="token operator">+</span><span class="token string">&quot; èŠ±è´¹æ—¶é—´(ms)ï¼š&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * streamå¹¶è¡Œæµæ–¹å¼ 150mså·¦å³
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> sum <span class="token operator">=</span> <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span> <span class="token number">1_0000_00000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æœï¼š&quot;</span><span class="token operator">+</span>sum<span class="token operator">+</span><span class="token string">&quot; èŠ±è´¹æ—¶é—´(ms)ï¼š&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">ForkJoinDemoTest</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> temp <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> start<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> end<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ForkJoinDemoTest</span><span class="token punctuation">(</span><span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Long</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> temp<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">long</span> sum <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sum<span class="token operator">+=</span>i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">long</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token operator">+</span>end<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">ForkJoinDemoTest</span> task1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinDemoTest</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ForkJoinDemoTest</span> task2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinDemoTest</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task1<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            task2<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> task1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> task2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="å¼‚æ­¥å›è°ƒ"><a href="#å¼‚æ­¥å›è°ƒ" class="header-anchor">#</a> å¼‚æ­¥å›è°ƒ</h3> <blockquote><p>CompletableFuture åœ¨ Java é‡Œé¢è¢«ç”¨äºå¼‚æ­¥ç¼–ç¨‹ï¼Œå¼‚æ­¥é€šå¸¸æ„å‘³ç€éé˜»å¡ï¼Œå¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„ä»»åŠ¡å•ç‹¬è¿è¡Œåœ¨ä¸ä¸»çº¿ç¨‹åˆ†ç¦»çš„å…¶ä»–çº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”é€šè¿‡å›è°ƒå¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­å¾—åˆ°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ˜¯å¦å®Œæˆï¼Œå’Œæ˜¯å¦å¼‚å¸¸ç­‰ä¿¡æ¯</p></blockquote> <p><strong>ç±»ä¸­çš„å…·ä½“å¼•ç”¨ç±»ä»¥åŠæ¥å£ï¼š</strong></p> <p><img src="https://images.zaiolos.top/images/202201061137988.png" alt="image-20211113182321944"></p> <blockquote><p>CompletableFuture å®ç°äº† Future, CompletionStage æ¥å£ï¼Œå®ç°äº† Futureæ¥å£å°±å¯ä»¥å…¼å®¹ç°åœ¨æœ‰çº¿ç¨‹æ± æ¡†æ¶ï¼Œè€Œ CompletionStage æ¥å£æ‰æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ¥å£æŠ½è±¡ï¼Œé‡Œé¢å®šä¹‰å¤šç§å¼‚æ­¥æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸¤è€…é›†åˆï¼Œä»è€Œæ‰“é€ å‡ºäº†å¼ºå¤§çš„CompletableFuture ç±»</p> <ul><li>å¼‚æ­¥è°ƒç”¨æ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼šrunAsync()</li> <li>å¼‚æ­¥è°ƒç”¨æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼šsupplyAsync()</li> <li>ä¸»çº¿ç¨‹è°ƒç”¨get()æ–¹æ³•ä¼šé˜»å¡</li></ul></blockquote> <p><strong>demoï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * æ— è¿”å›å€¼
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">noReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> voidCompletableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;151515&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸»çº¿ç¨‹è°ƒç”¨ äº§ç”Ÿé˜»å¡ è¿”å›null</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>voidCompletableFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hasReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> booleanCompletableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//whenCompleteæ˜¯å½“ä¸Šè¿°å¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸåçš„å›è°ƒ</span>
        <span class="token comment">//exceptionallyæ˜¯å½“å¼‚æ­¥ä»»åŠ¡å‘ç”Ÿå¼‚å¸¸æ—¶çš„å›è°ƒ</span>
        <span class="token class-name">Boolean</span> result <span class="token operator">=</span> booleanCompletableFuture<span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;u = &quot;</span> <span class="token operator">+</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t = &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result = &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><blockquote><p>æ³¨ï¼šwhenCompleteæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªBiConsumer&lt;? super T, ? super Throwable&gt;ç±»å‹çš„æ¶ˆè´¹å‹æ¥å£</p></blockquote> <h4 id="futureå’Œcompletablefuture"><a href="#futureå’Œcompletablefuture" class="header-anchor">#</a> Futureå’ŒCompletableFuture</h4> <blockquote><p>å¯¹æ¯”è¿™ä¸¤ç§æ–¹æ³•ï¼Œå‰è€…ä»ä¸ºåŒæ­¥ï¼Œåè€…ä¸ºå¼‚æ­¥ã€‚</p> <p>Futureåœ¨javaé‡Œï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„å¼•ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± é‡Œé¢ï¼Œç„¶åæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªFutureï¼Œåœ¨Futureé‡Œé¢æœ‰isDoneæ–¹æ³•æ¥å¸•åŠªå•ä»»åŠ¡æ˜¯å¦å¤„ç†ç»“æŸï¼Œè¿˜æœ‰getæ–¹æ³•å¯ä»¥ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡ç»“æŸç„¶åè·å–ç»“æœï¼Œä½†æ€»ä½“æ¥è¯´è¿™ç§æ–¹å¼è¿˜æ˜¯åŒæ­¥çš„ï¼Œå› ä¸ºéœ€è¦å®¢æˆ·ç«¯ä¸æ–­é˜»å¡ç­‰å¾…æˆ–è€…ä¸ä½†è½®è¯¢æ‰èƒ½çŸ¥é“ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚</p></blockquote> <p>Futureç›¸è¾ƒäºCompletableFutureçš„ç¼ºç‚¹</p> <ol><li><p><strong>ä¸æ”¯æŒæ‰‹åŠ¨å®Œæˆ</strong></p> <blockquote><p>æˆ‘æäº¤äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œå¤ªæ…¢äº†ï¼Œæˆ‘é€šè¿‡å…¶ä»–è·¯å¾„å·²ç»è·å–åˆ°äº†ä»»åŠ¡ç»“æœï¼Œç°åœ¨æ²¡æ³•æŠŠè¿™ä¸ªä»»åŠ¡ç»“æœé€šçŸ¥åˆ°æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»ä¸»åŠ¨å–æ¶ˆæˆ–è€…ä¸€ç›´ç­‰å¾…å®ƒæ‰§è¡Œå®Œæˆ</p></blockquote></li> <li><p><strong>ä¸æ”¯æŒè¿›ä¸€æ­¥çš„éé˜»å¡è°ƒç”¨</strong></p> <blockquote><p>é€šè¿‡Futureçš„getæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°ä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯æƒ³åœ¨è·å–ä»»åŠ¡ç»“æœä¹‹åæ‰§è¡Œé¢å¤–çš„ä»»åŠ¡å°±ä¸è¡Œäº†ï¼Œå› ä¸ºFutureä¸æ”¯æŒå›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥æ— æ³•å®ç°è¿™ä¸ªåŠŸèƒ½</p></blockquote></li> <li><p><strong>ä¸æ”¯æŒé“¾å¼è°ƒç”¨</strong></p> <blockquote><p>å¯¹äºFuture æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬æƒ³ç»§ç»­ä¼ åˆ°ä¸‹ä¸€ä¸ªFutureå¤„ç†ä½¿ç”¨ï¼Œä»è€Œå½¢æˆä¸€ä¸ªé“¾å¼çš„piplineè°ƒç”¨ï¼Œè¿™åœ¨Futureä¸­æ˜¯æ²¡æ³•å®ç°çš„</p></blockquote></li> <li><p><strong>ä¸æ”¯æŒå¤šä¸ªFutureåˆå¹¶</strong></p> <blockquote><p>æ¯”å¦‚æœ‰10ä¸ªFutureå¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬æƒ³åœ¨æ‰€æœ‰çš„Futureè¿è¡Œå®Œæ¯•åï¼Œæ‰§è¡ŒæŸäº›å‡½æ•°ï¼Œæ˜¯æ²¡åŠæ³•é€šè¿‡Futureå®ç°çš„</p></blockquote></li> <li><p><strong>ä¸æ”¯æŒå¼‚å¸¸å¤„ç†</strong></p> <blockquote><p>Futureæ²¡æœ‰ä»»ä½•ä¸å¼‚å¸¸å¤„ç†ç›¸å…³çš„APIï¼Œæ‰€ä»¥åœ¨å¼‚æ­¥è¿è¡Œæ—¶ï¼Œå‡ºç°é—®é¢˜ä¸å¥½å®šä½</p></blockquote></li></ol></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hnistzdk/my-notes/edit/master/docs/01.Java/03.Java-å¤šçº¿ç¨‹/02.å¤šçº¿ç¨‹è¿›é˜¶-JUC.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/my-notes/tags/?tag=%E5%A4%9A%E7%BA%BF%E7%A8%8B" title="æ ‡ç­¾">#å¤šçº¿ç¨‹</a><a href="/my-notes/tags/?tag=JUC" title="æ ‡ç­¾">#JUC</a></div> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°:</span> <span class="time">2022/10/04, 8:10:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/my-notes/java/se/thread/1/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">å¤šçº¿ç¨‹åŸºç¡€</div></a> <a href="/my-notes/java/se/thread/3/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">å¤šçº¿ç¨‹è¿›é˜¶-JMM</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/my-notes/java/se/thread/1/" class="prev">å¤šçº¿ç¨‹åŸºç¡€</a></span> <span class="next"><a href="/my-notes/java/se/thread/3/">å¤šçº¿ç¨‹è¿›é˜¶-JMM</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:369365576@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-gitee"></a><a href="http://music.163.com/playlist?id=936642760&amp;userid=604011130" title="æ™®é€šæ­Œå•" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2023
    <span>zdk | notes <br><a href=http://beian.miit.gov.cn/>æ¹˜ICPå¤‡2022001117å·-1</a><br><img src=/img/ghs.png /><a href=http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51142102511562>å·å…¬ç½‘å®‰å¤‡ 51142102511562å·</a><br><a href=https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referra><img src=/img/upyun.png align=absmiddle width=70px height=30px /></a> <span> æä¾›åŠ é€ŸæœåŠ¡ </span></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div id="goTop" class="hide-cat" data-v-bf92849a></div><div></div><div></div></div></div>
    <script src="/my-notes/assets/js/app.7f931ee0.js" defer></script><script src="/my-notes/assets/js/2.e52a17f8.js" defer></script><script src="/my-notes/assets/js/29.208cdce3.js" defer></script><script src="/my-notes/assets/js/6.bcc16901.js" defer></script>
  </body>
</html>
