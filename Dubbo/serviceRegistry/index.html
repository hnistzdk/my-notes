<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æœåŠ¡æ³¨å†Œ(provideræœåŠ¡æš´éœ²) | DK&#39;s Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/my-notes/img/logo.jpg">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334691_b03dsaqrwck.css">
    <meta name="description" content="æ—¶ä¸æˆ‘å¾…ï¼Œèˆæˆ‘å…¶è°">
    <meta name="keywords" content="Java">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/my-notes/assets/css/0.styles.565c6041.css" as="style"><link rel="preload" href="/my-notes/assets/js/app.7f931ee0.js" as="script"><link rel="preload" href="/my-notes/assets/js/2.e52a17f8.js" as="script"><link rel="preload" href="/my-notes/assets/js/121.d3137f51.js" as="script"><link rel="preload" href="/my-notes/assets/js/6.bcc16901.js" as="script"><link rel="prefetch" href="/my-notes/assets/js/10.fee8f7ec.js"><link rel="prefetch" href="/my-notes/assets/js/100.9be19fac.js"><link rel="prefetch" href="/my-notes/assets/js/101.9aaae740.js"><link rel="prefetch" href="/my-notes/assets/js/102.a72c0165.js"><link rel="prefetch" href="/my-notes/assets/js/103.d47527c3.js"><link rel="prefetch" href="/my-notes/assets/js/104.d5bae560.js"><link rel="prefetch" href="/my-notes/assets/js/105.fdb07f67.js"><link rel="prefetch" href="/my-notes/assets/js/106.b89b7d37.js"><link rel="prefetch" href="/my-notes/assets/js/107.a9d142eb.js"><link rel="prefetch" href="/my-notes/assets/js/108.1b8c8817.js"><link rel="prefetch" href="/my-notes/assets/js/109.0cd465a0.js"><link rel="prefetch" href="/my-notes/assets/js/11.75b40e53.js"><link rel="prefetch" href="/my-notes/assets/js/110.4c56723c.js"><link rel="prefetch" href="/my-notes/assets/js/111.12b9cb85.js"><link rel="prefetch" href="/my-notes/assets/js/112.3f791546.js"><link rel="prefetch" href="/my-notes/assets/js/113.d9998b70.js"><link rel="prefetch" href="/my-notes/assets/js/114.faf0da70.js"><link rel="prefetch" href="/my-notes/assets/js/115.35d9b5f6.js"><link rel="prefetch" href="/my-notes/assets/js/116.13fbe1ab.js"><link rel="prefetch" href="/my-notes/assets/js/117.bffe4459.js"><link rel="prefetch" href="/my-notes/assets/js/118.eabefad3.js"><link rel="prefetch" href="/my-notes/assets/js/119.8593c8a5.js"><link rel="prefetch" href="/my-notes/assets/js/12.34db197a.js"><link rel="prefetch" href="/my-notes/assets/js/120.f5b73620.js"><link rel="prefetch" href="/my-notes/assets/js/122.f47bca90.js"><link rel="prefetch" href="/my-notes/assets/js/123.6d846b88.js"><link rel="prefetch" href="/my-notes/assets/js/124.49825ebc.js"><link rel="prefetch" href="/my-notes/assets/js/125.6d3a9ce5.js"><link rel="prefetch" href="/my-notes/assets/js/126.eeef761b.js"><link rel="prefetch" href="/my-notes/assets/js/127.0f7e28c1.js"><link rel="prefetch" href="/my-notes/assets/js/128.4a35f42a.js"><link rel="prefetch" href="/my-notes/assets/js/129.e364bc33.js"><link rel="prefetch" href="/my-notes/assets/js/13.ab02aa59.js"><link rel="prefetch" href="/my-notes/assets/js/130.1299fc06.js"><link rel="prefetch" href="/my-notes/assets/js/131.61faa498.js"><link rel="prefetch" href="/my-notes/assets/js/132.9e46a3c4.js"><link rel="prefetch" href="/my-notes/assets/js/133.0b6e6f7f.js"><link rel="prefetch" href="/my-notes/assets/js/134.6724b7a7.js"><link rel="prefetch" href="/my-notes/assets/js/135.1d3daca0.js"><link rel="prefetch" href="/my-notes/assets/js/136.190f2a28.js"><link rel="prefetch" href="/my-notes/assets/js/137.5ce96397.js"><link rel="prefetch" href="/my-notes/assets/js/138.c0b55b02.js"><link rel="prefetch" href="/my-notes/assets/js/139.068ed7d7.js"><link rel="prefetch" href="/my-notes/assets/js/14.721e1994.js"><link rel="prefetch" href="/my-notes/assets/js/140.5226be4f.js"><link rel="prefetch" href="/my-notes/assets/js/141.196d1aa6.js"><link rel="prefetch" href="/my-notes/assets/js/142.11cbb52f.js"><link rel="prefetch" href="/my-notes/assets/js/143.509f8300.js"><link rel="prefetch" href="/my-notes/assets/js/144.436415bf.js"><link rel="prefetch" href="/my-notes/assets/js/145.a25cd8bc.js"><link rel="prefetch" href="/my-notes/assets/js/146.a2d1d780.js"><link rel="prefetch" href="/my-notes/assets/js/147.1cac4e0a.js"><link rel="prefetch" href="/my-notes/assets/js/148.5c361eba.js"><link rel="prefetch" href="/my-notes/assets/js/149.f62eacfa.js"><link rel="prefetch" href="/my-notes/assets/js/15.35ef567c.js"><link rel="prefetch" href="/my-notes/assets/js/150.80b0aa20.js"><link rel="prefetch" href="/my-notes/assets/js/151.6f0e31d8.js"><link rel="prefetch" href="/my-notes/assets/js/152.86efa86d.js"><link rel="prefetch" href="/my-notes/assets/js/153.d6605e26.js"><link rel="prefetch" href="/my-notes/assets/js/154.e5b33cc7.js"><link rel="prefetch" href="/my-notes/assets/js/155.5d3cf278.js"><link rel="prefetch" href="/my-notes/assets/js/156.bcb9784f.js"><link rel="prefetch" href="/my-notes/assets/js/157.ca3b8e8c.js"><link rel="prefetch" href="/my-notes/assets/js/158.eb0116b8.js"><link rel="prefetch" href="/my-notes/assets/js/159.309a26da.js"><link rel="prefetch" href="/my-notes/assets/js/16.ca698d39.js"><link rel="prefetch" href="/my-notes/assets/js/160.ce6e9321.js"><link rel="prefetch" href="/my-notes/assets/js/161.ac24f13a.js"><link rel="prefetch" href="/my-notes/assets/js/162.c3390211.js"><link rel="prefetch" href="/my-notes/assets/js/163.8267154f.js"><link rel="prefetch" href="/my-notes/assets/js/164.3ce822f9.js"><link rel="prefetch" href="/my-notes/assets/js/165.80836bd1.js"><link rel="prefetch" href="/my-notes/assets/js/166.7346e59a.js"><link rel="prefetch" href="/my-notes/assets/js/167.5577b6af.js"><link rel="prefetch" href="/my-notes/assets/js/168.23aca72c.js"><link rel="prefetch" href="/my-notes/assets/js/169.ce891665.js"><link rel="prefetch" href="/my-notes/assets/js/17.549cfc80.js"><link rel="prefetch" href="/my-notes/assets/js/170.b4aebdaf.js"><link rel="prefetch" href="/my-notes/assets/js/171.39cdd90b.js"><link rel="prefetch" href="/my-notes/assets/js/172.06cd5671.js"><link rel="prefetch" href="/my-notes/assets/js/173.44c7c161.js"><link rel="prefetch" href="/my-notes/assets/js/174.62d8a34f.js"><link rel="prefetch" href="/my-notes/assets/js/175.baa645ac.js"><link rel="prefetch" href="/my-notes/assets/js/176.8361f852.js"><link rel="prefetch" href="/my-notes/assets/js/177.4a8f2fec.js"><link rel="prefetch" href="/my-notes/assets/js/178.f594def6.js"><link rel="prefetch" href="/my-notes/assets/js/179.2338f129.js"><link rel="prefetch" href="/my-notes/assets/js/18.a8b4f826.js"><link rel="prefetch" href="/my-notes/assets/js/180.1b2f62df.js"><link rel="prefetch" href="/my-notes/assets/js/181.10759f41.js"><link rel="prefetch" href="/my-notes/assets/js/182.c0e1c3c5.js"><link rel="prefetch" href="/my-notes/assets/js/183.bdc8283f.js"><link rel="prefetch" href="/my-notes/assets/js/184.30a6f685.js"><link rel="prefetch" href="/my-notes/assets/js/185.1949079b.js"><link rel="prefetch" href="/my-notes/assets/js/186.bb7c7093.js"><link rel="prefetch" href="/my-notes/assets/js/187.1d02d132.js"><link rel="prefetch" href="/my-notes/assets/js/188.5230fbeb.js"><link rel="prefetch" href="/my-notes/assets/js/189.2931d469.js"><link rel="prefetch" href="/my-notes/assets/js/19.16e1a44c.js"><link rel="prefetch" href="/my-notes/assets/js/190.9bd3b616.js"><link rel="prefetch" href="/my-notes/assets/js/191.d75de9d3.js"><link rel="prefetch" href="/my-notes/assets/js/192.dacb160e.js"><link rel="prefetch" href="/my-notes/assets/js/193.660b4fce.js"><link rel="prefetch" href="/my-notes/assets/js/194.45f8499e.js"><link rel="prefetch" href="/my-notes/assets/js/195.e91d4663.js"><link rel="prefetch" href="/my-notes/assets/js/196.e94176ac.js"><link rel="prefetch" href="/my-notes/assets/js/197.5acbb43f.js"><link rel="prefetch" href="/my-notes/assets/js/198.dc1a1207.js"><link rel="prefetch" href="/my-notes/assets/js/199.288adcec.js"><link rel="prefetch" href="/my-notes/assets/js/20.b19ef4b2.js"><link rel="prefetch" href="/my-notes/assets/js/200.3d318d2e.js"><link rel="prefetch" href="/my-notes/assets/js/21.e3682738.js"><link rel="prefetch" href="/my-notes/assets/js/22.fafa8b54.js"><link rel="prefetch" href="/my-notes/assets/js/23.9d683b40.js"><link rel="prefetch" href="/my-notes/assets/js/24.02c0c08c.js"><link rel="prefetch" href="/my-notes/assets/js/25.af427f02.js"><link rel="prefetch" href="/my-notes/assets/js/26.50a41828.js"><link rel="prefetch" href="/my-notes/assets/js/27.8f1d2fe6.js"><link rel="prefetch" href="/my-notes/assets/js/28.7f820229.js"><link rel="prefetch" href="/my-notes/assets/js/29.208cdce3.js"><link rel="prefetch" href="/my-notes/assets/js/3.32ea0d41.js"><link rel="prefetch" href="/my-notes/assets/js/30.e7a171d3.js"><link rel="prefetch" href="/my-notes/assets/js/31.8ee9f363.js"><link rel="prefetch" href="/my-notes/assets/js/32.b33ae00e.js"><link rel="prefetch" href="/my-notes/assets/js/33.3a961845.js"><link rel="prefetch" href="/my-notes/assets/js/34.46f30eb6.js"><link rel="prefetch" href="/my-notes/assets/js/35.dedda1f7.js"><link rel="prefetch" href="/my-notes/assets/js/36.fb63ded5.js"><link rel="prefetch" href="/my-notes/assets/js/37.321340a9.js"><link rel="prefetch" href="/my-notes/assets/js/38.c21281dd.js"><link rel="prefetch" href="/my-notes/assets/js/39.01776b7e.js"><link rel="prefetch" href="/my-notes/assets/js/4.2466bf2a.js"><link rel="prefetch" href="/my-notes/assets/js/40.c6763f18.js"><link rel="prefetch" href="/my-notes/assets/js/41.afa4c2f3.js"><link rel="prefetch" href="/my-notes/assets/js/42.187357b5.js"><link rel="prefetch" href="/my-notes/assets/js/43.90030eae.js"><link rel="prefetch" href="/my-notes/assets/js/44.e11eff59.js"><link rel="prefetch" href="/my-notes/assets/js/45.760e3e3f.js"><link rel="prefetch" href="/my-notes/assets/js/46.0eccc1a4.js"><link rel="prefetch" href="/my-notes/assets/js/47.30e063f8.js"><link rel="prefetch" href="/my-notes/assets/js/48.5ab681d2.js"><link rel="prefetch" href="/my-notes/assets/js/49.5921c987.js"><link rel="prefetch" href="/my-notes/assets/js/5.56264475.js"><link rel="prefetch" href="/my-notes/assets/js/50.a53fa873.js"><link rel="prefetch" href="/my-notes/assets/js/51.5cded08c.js"><link rel="prefetch" href="/my-notes/assets/js/52.8960c473.js"><link rel="prefetch" href="/my-notes/assets/js/53.2ac21c0e.js"><link rel="prefetch" href="/my-notes/assets/js/54.361bc2f3.js"><link rel="prefetch" href="/my-notes/assets/js/55.3853b7f3.js"><link rel="prefetch" href="/my-notes/assets/js/56.754a3b4c.js"><link rel="prefetch" href="/my-notes/assets/js/57.1d9684e7.js"><link rel="prefetch" href="/my-notes/assets/js/58.0e7f2b60.js"><link rel="prefetch" href="/my-notes/assets/js/59.b37ab2f4.js"><link rel="prefetch" href="/my-notes/assets/js/60.f31d0aea.js"><link rel="prefetch" href="/my-notes/assets/js/61.5aebeb50.js"><link rel="prefetch" href="/my-notes/assets/js/62.cebf26d6.js"><link rel="prefetch" href="/my-notes/assets/js/63.6c7932ca.js"><link rel="prefetch" href="/my-notes/assets/js/64.cad8a013.js"><link rel="prefetch" href="/my-notes/assets/js/65.25e4c14e.js"><link rel="prefetch" href="/my-notes/assets/js/66.e9c81af6.js"><link rel="prefetch" href="/my-notes/assets/js/67.31cbef00.js"><link rel="prefetch" href="/my-notes/assets/js/68.edc93332.js"><link rel="prefetch" href="/my-notes/assets/js/69.5eaf1e4f.js"><link rel="prefetch" href="/my-notes/assets/js/7.5a6eeb6c.js"><link rel="prefetch" href="/my-notes/assets/js/70.7114cd64.js"><link rel="prefetch" href="/my-notes/assets/js/71.2066867c.js"><link rel="prefetch" href="/my-notes/assets/js/72.0f93cb73.js"><link rel="prefetch" href="/my-notes/assets/js/73.6c4d69ec.js"><link rel="prefetch" href="/my-notes/assets/js/74.0a91fc3c.js"><link rel="prefetch" href="/my-notes/assets/js/75.47e45f38.js"><link rel="prefetch" href="/my-notes/assets/js/76.99886a8d.js"><link rel="prefetch" href="/my-notes/assets/js/77.61eb4f51.js"><link rel="prefetch" href="/my-notes/assets/js/78.eff53df7.js"><link rel="prefetch" href="/my-notes/assets/js/79.e5d77573.js"><link rel="prefetch" href="/my-notes/assets/js/8.c2fa6f68.js"><link rel="prefetch" href="/my-notes/assets/js/80.8ac4e931.js"><link rel="prefetch" href="/my-notes/assets/js/81.82416621.js"><link rel="prefetch" href="/my-notes/assets/js/82.b7cea701.js"><link rel="prefetch" href="/my-notes/assets/js/83.eb0065f7.js"><link rel="prefetch" href="/my-notes/assets/js/84.45596ac9.js"><link rel="prefetch" href="/my-notes/assets/js/85.73902eef.js"><link rel="prefetch" href="/my-notes/assets/js/86.05a157f2.js"><link rel="prefetch" href="/my-notes/assets/js/87.83218f21.js"><link rel="prefetch" href="/my-notes/assets/js/88.bf05ee49.js"><link rel="prefetch" href="/my-notes/assets/js/89.089b5c96.js"><link rel="prefetch" href="/my-notes/assets/js/9.4a5b4024.js"><link rel="prefetch" href="/my-notes/assets/js/90.dc0b55a6.js"><link rel="prefetch" href="/my-notes/assets/js/91.ddc7da4f.js"><link rel="prefetch" href="/my-notes/assets/js/92.2b5c7d5f.js"><link rel="prefetch" href="/my-notes/assets/js/93.934a02e9.js"><link rel="prefetch" href="/my-notes/assets/js/94.3a6ede23.js"><link rel="prefetch" href="/my-notes/assets/js/95.0e946220.js"><link rel="prefetch" href="/my-notes/assets/js/96.3861fb05.js"><link rel="prefetch" href="/my-notes/assets/js/97.8627cefa.js"><link rel="prefetch" href="/my-notes/assets/js/98.6e0ee750.js"><link rel="prefetch" href="/my-notes/assets/js/99.5df99b25.js">
    <link rel="stylesheet" href="/my-notes/assets/css/0.styles.565c6041.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notes/" class="home-link router-link-active"><img src="/my-notes/img/logo.jpg" alt="DK's Notes" class="logo"> <span class="site-name can-hide">DK's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notes/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">å¯¼èˆªç«™</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">JavaåŸºç¡€</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-å¤šçº¿ç¨‹</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link">å¤šçº¿ç¨‹</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-java8æ–°ç‰¹æ€§</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8æ–°ç‰¹æ€§</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Javaè™šæ‹Ÿæœº</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ•°æ®åº“" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">æ•°æ®åº“</a> <span class="title" style="display:none;">æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¡†æ¶" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">æ¡†æ¶</a> <span class="title" style="display:none;">æ¡†æ¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>ä¸­é—´ä»¶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¡¹ç›®" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">é¡¹ç›®</a> <span class="title" style="display:none;">é¡¹ç›®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">ç§’æ€é¡¹ç›®</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·|éƒ¨ç½²" class="dropdown-title"><a href="/my-notes/git/" class="link-title">å·¥å…·|éƒ¨ç½²</a> <span class="title" style="display:none;">å·¥å…·|éƒ¨ç½²</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•|åˆ·é¢˜" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">é¢è¯•|åˆ·é¢˜</a> <span class="title" style="display:none;">é¢è¯•|åˆ·é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">åˆ·é¢˜</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">å¼€å‘é—®é¢˜ğŸ˜ˆ</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">å…³äºğŸ’•</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">å½’æ¡£ğŸ•›</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.jpg"> <div class="blogger-info"><h3>é£</h3> <span>æ‘¸é±¼</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/my-notes/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">å¯¼èˆªç«™</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">JavaåŸºç¡€</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-å¤šçº¿ç¨‹</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link">å¤šçº¿ç¨‹</a></li></ul></li><li class="dropdown-item"><h4>Java-Seè¿›é˜¶-java8æ–°ç‰¹æ€§</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8æ–°ç‰¹æ€§</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Javaè™šæ‹Ÿæœº</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ•°æ®åº“" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">æ•°æ®åº“</a> <span class="title" style="display:none;">æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL æ•°æ®åº“</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ¡†æ¶" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">æ¡†æ¶</a> <span class="title" style="display:none;">æ¡†æ¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>ä¸­é—´ä»¶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¡¹ç›®" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">é¡¹ç›®</a> <span class="title" style="display:none;">é¡¹ç›®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">ç§’æ€é¡¹ç›®</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·|éƒ¨ç½²" class="dropdown-title"><a href="/my-notes/git/" class="link-title">å·¥å…·|éƒ¨ç½²</a> <span class="title" style="display:none;">å·¥å…·|éƒ¨ç½²</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•|åˆ·é¢˜" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">é¢è¯•|åˆ·é¢˜</a> <span class="title" style="display:none;">é¢è¯•|åˆ·é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">åˆ·é¢˜</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">å¼€å‘é—®é¢˜ğŸ˜ˆ</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">å…³äºğŸ’•</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">å½’æ¡£ğŸ•›</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mybatis-plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMvc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RabbitMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Dubbo</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-notes/dubbo/" class="sidebar-link">DubboçŸ¥è¯†ä½“ç³»</a></li><li><a href="/my-notes/dubbo/Dubbo/" class="sidebar-link">Dubbo</a></li><li><a href="/my-notes/Dubbo/serviceRegistry/" aria-current="page" class="active sidebar-link">æœåŠ¡æ³¨å†Œ(provideræœåŠ¡æš´éœ²)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/my-notes/Dubbo/serviceRegistry/#æ¶æ„" class="sidebar-link">æ¶æ„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#å®˜ç½‘æ¶æ„å›¾" class="sidebar-link">å®˜ç½‘æ¶æ„å›¾</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#è§’è‰²è¯´æ˜" class="sidebar-link">è§’è‰²è¯´æ˜</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#è°ƒç”¨å…³ç³»è¯´æ˜" class="sidebar-link">è°ƒç”¨å…³ç³»è¯´æ˜</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/my-notes/Dubbo/serviceRegistry/#_1-è§£æé…ç½®" class="sidebar-link">1. è§£æé…ç½®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_1-1-è§£æxml" class="sidebar-link">1.1 è§£æXML</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/Dubbo/serviceRegistry/#ç›¸å…³é…ç½®ç±»" class="sidebar-link">ç›¸å…³é…ç½®ç±»</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_1-2-æ£€æŸ¥é…ç½®" class="sidebar-link">1.2 æ£€æŸ¥é…ç½®</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_1-3-é‡ç‚¹-springå®¹å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶å¼€å§‹æ‰§è¡Œæš´éœ²" class="sidebar-link">1.3 (é‡ç‚¹)Springå®¹å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶å¼€å§‹æ‰§è¡Œæš´éœ²</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_1-5-è§£æurl" class="sidebar-link">1.5 è§£æURL</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/my-notes/Dubbo/serviceRegistry/#_2-å¯¼å‡ºdubboæœåŠ¡" class="sidebar-link">2. å¯¼å‡ºDubboæœåŠ¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_2-1-invokeråˆ›å»ºè¿‡ç¨‹" class="sidebar-link">2.1 Invokeråˆ›å»ºè¿‡ç¨‹</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_2-2-å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°" class="sidebar-link">2.2 å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-å¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹" class="sidebar-link">2.3 å¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-1-æœåŠ¡å¯¼å‡º" class="sidebar-link">2.3.1 æœåŠ¡å¯¼å‡º</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#ä¸»è¦é€»è¾‘" class="sidebar-link">ä¸»è¦é€»è¾‘</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-1-1-ç¬¬ä¸€æ­¥-dolocalexport" class="sidebar-link">2.3.1.1 ç¬¬ä¸€æ­¥ doLocalExport</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#dubboprotocolç±»ä¸­çš„exportæ–¹æ³•" class="sidebar-link">DubboProtocolç±»ä¸­çš„exportæ–¹æ³•</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-1-2-å¯åŠ¨æœåŠ¡å™¨" class="sidebar-link">2.3.1.2 å¯åŠ¨æœåŠ¡å™¨</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-1-3-åˆ›å»ºæœåŠ¡å™¨" class="sidebar-link">2.3.1.3 åˆ›å»ºæœåŠ¡å™¨</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#exchangers-bind-url-url-exchangehandler-handler" class="sidebar-link">Exchangers.bindï¼ˆURL url, ExchangeHandler handlerï¼‰</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-2-æœåŠ¡æ³¨å†Œ" class="sidebar-link">2.3.2 æœåŠ¡æ³¨å†Œ</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-2-1-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ" class="sidebar-link">2.3.2.1 åˆ›å»ºæ³¨å†Œä¸­å¿ƒ</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/Dubbo/serviceRegistry/#_2-3-2-2-èŠ‚ç‚¹åˆ›å»º" class="sidebar-link">2.3.2.2 èŠ‚ç‚¹åˆ›å»º</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/my-notes/Dubbo/serviceRegistry/#_3-æ—¶åºå›¾æ¢³ç†" class="sidebar-link">3. æ—¶åºå›¾æ¢³ç†</a></li><li class="sidebar-sub-header level2"><a href="/my-notes/Dubbo/serviceRegistry/#_4-ä¸»è¦æµç¨‹" class="sidebar-link">4. ä¸»è¦æµç¨‹</a></li></ul></li><li><a href="/my-notes/Dubbo/serviceDiscovery/" class="sidebar-link">æœåŠ¡å‘ç°(consumeræœåŠ¡å¼•å…¥)</a></li><li><a href="/my-notes/Dubbo/serviceProcess/" class="sidebar-link">æœåŠ¡è°ƒç”¨è¿‡ç¨‹</a></li><li><a href="/my-notes/dubbo/spi/" class="sidebar-link">SPIæœºåˆ¶</a></li><li><a href="/my-notes/Dubbo/loadBalance/" class="sidebar-link">è´Ÿè½½å‡è¡¡æœºåˆ¶</a></li><li><a href="/my-notes/Dubbo/serviceFaultTolerance/" class="sidebar-link">æœåŠ¡å®¹é”™ã€é™çº§</a></li><li><a href="/my-notes/Dubbo/exception/" class="sidebar-link">Dubboçš„æœåŠ¡å¼‚å¸¸å¤„ç†</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/my-notes/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/my-notes/categories/?category=%E6%A1%86%E6%9E%B6" title="åˆ†ç±»" data-v-06225672>æ¡†æ¶</a></li><li data-v-06225672><a href="/my-notes/categories/?category=Dubbo" title="åˆ†ç±»" data-v-06225672>Dubbo</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.zaiolos.top/" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>zdk</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">æœåŠ¡æ³¨å†Œ(provideræœåŠ¡æš´éœ²)<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><strong>Table of Contents</strong> <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener noreferrer">DocToc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></p> <ul><li><a href="#%E6%9E%B6%E6%9E%84">æ¶æ„</a> <ul><li><a href="#%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%E5%9B%BE">å®˜ç½‘æ¶æ„å›¾</a></li> <li><a href="#%E8%A7%92%E8%89%B2%E8%AF%B4%E6%98%8E">è§’è‰²è¯´æ˜</a></li> <li><a href="#%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E8%AF%B4%E6%98%8E">è°ƒç”¨å…³ç³»è¯´æ˜</a></li></ul></li> <li><a href="#1-%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE">1. è§£æé…ç½®</a> <ul><li><a href="#11-%E8%A7%A3%E6%9E%90xml">1.1 è§£æXML</a> <ul><li><a href="#%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E7%B1%BB">ç›¸å…³é…ç½®ç±»</a></li></ul></li> <li><a href="#12-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE">1.2 æ£€æŸ¥é…ç½®</a></li> <li><a href="#13-%E9%87%8D%E7%82%B9spring%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C%E6%9A%B4%E9%9C%B2">1.3 (é‡ç‚¹)Springå®¹å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶å¼€å§‹æ‰§è¡Œæš´éœ²</a></li> <li><a href="#15-%E8%A7%A3%E6%9E%90url">1.5 è§£æURL</a></li></ul></li> <li><a href="#2-%E5%AF%BC%E5%87%BAdubbo%E6%9C%8D%E5%8A%A1">2. å¯¼å‡ºDubboæœåŠ¡</a> <ul><li><a href="#21-invoker%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B">2.1 Invokeråˆ›å»ºè¿‡ç¨‹</a></li> <li><a href="#22-%E5%AF%BC%E5%87%BA%E6%9C%8D%E5%8A%A1%E5%88%B0%E6%9C%AC%E5%9C%B0">2.2 å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°</a></li> <li><a href="#23-%E5%AF%BC%E5%87%BA%E6%9C%8D%E5%8A%A1%E5%88%B0%E8%BF%9C%E7%A8%8B">2.3 å¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹</a> <ul><li><a href="#231-%E6%9C%8D%E5%8A%A1%E5%AF%BC%E5%87%BA">2.3.1 æœåŠ¡å¯¼å‡º</a> <ul><li><a href="#%E4%B8%BB%E8%A6%81%E9%80%BB%E8%BE%91">ä¸»è¦é€»è¾‘</a></li> <li><a href="#2311-%E7%AC%AC%E4%B8%80%E6%AD%A5-dolocalexport">2.3.1.1 ç¬¬ä¸€æ­¥ doLocalExport</a></li> <li><a href="#dubboprotocol%E7%B1%BB%E4%B8%AD%E7%9A%84export%E6%96%B9%E6%B3%95">DubboProtocolç±»ä¸­çš„exportæ–¹æ³•</a></li> <li><a href="#2312-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8">2.3.1.2 å¯åŠ¨æœåŠ¡å™¨</a></li> <li><a href="#2313-%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8">2.3.1.3 åˆ›å»ºæœåŠ¡å™¨</a></li> <li><a href="#exchangersbindurl-url-exchangehandler-handler">Exchangers.bindï¼ˆURL url, ExchangeHandler handlerï¼‰</a></li></ul></li> <li><a href="#232-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C">2.3.2 æœåŠ¡æ³¨å†Œ</a> <ul><li><a href="#2321-%E5%88%9B%E5%BB%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">2.3.2.1 åˆ›å»ºæ³¨å†Œä¸­å¿ƒ</a></li> <li><a href="#2322-%E8%8A%82%E7%82%B9%E5%88%9B%E5%BB%BA">2.3.2.2 èŠ‚ç‚¹åˆ›å»º</a></li></ul></li></ul></li></ul></li> <li><a href="#3-%E6%97%B6%E5%BA%8F%E5%9B%BE%E6%A2%B3%E7%90%86">3. æ—¶åºå›¾æ¢³ç†</a></li> <li><a href="#4-%E4%B8%BB%E8%A6%81%E6%B5%81%E7%A8%8B">4. ä¸»è¦æµç¨‹</a></li></ul> <hr> <h2 id="æ¶æ„"><a href="#æ¶æ„" class="header-anchor">#</a> æ¶æ„</h2> <h3 id="å®˜ç½‘æ¶æ„å›¾"><a href="#å®˜ç½‘æ¶æ„å›¾" class="header-anchor">#</a> å®˜ç½‘æ¶æ„å›¾</h3> <p><img src="https://images.zaiolos.top/images/202208011601172.png" alt=""></p> <h3 id="è§’è‰²è¯´æ˜"><a href="#è§’è‰²è¯´æ˜" class="header-anchor">#</a> è§’è‰²è¯´æ˜</h3> <p>Provider
æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</p> <p>Consumer
è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹</p> <p>Registry
æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</p> <p>Monitor
ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡è°ƒå’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</p> <p>Container
æœåŠ¡è¿è¡Œå®¹å™¨</p> <h3 id="è°ƒç”¨å…³ç³»è¯´æ˜"><a href="#è°ƒç”¨å…³ç³»è¯´æ˜" class="header-anchor">#</a> è°ƒç”¨å…³ç³»è¯´æ˜</h3> <ol><li>æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨,åŠ è½½,è¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</li> <li>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶,å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</li> <li>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶,å‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</li> <li>æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…,å¦‚æœæœ‰å˜æ›´,æ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</li> <li>æœåŠ¡æ¶ˆè´¹è€…,ä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­,åŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•,é€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨,å¦‚æœè°ƒç”¨å¤±è´¥,å†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li> <li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…,åœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´,å®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</li></ol> <h2 id="_1-è§£æé…ç½®"><a href="#_1-è§£æé…ç½®" class="header-anchor">#</a> 1. è§£æé…ç½®</h2> <h3 id="_1-1-è§£æxml"><a href="#_1-1-è§£æxml" class="header-anchor">#</a> 1.1 è§£æXML</h3> <div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºç³»ç»Ÿæä¾›å¯é…ç½®åŒ–æ”¯æŒï¼Œç®€å•çš„åšæ³•å¯ä»¥ç›´æ¥åŸºäºSpringçš„æ ‡å‡†Beanæ¥é…ç½®ï¼Œä½†é…ç½®è¾ƒä¸ºå¤æ‚æˆ–è€…éœ€è¦æ›´å¤šä¸°å¯Œæ§åˆ¶çš„æ—¶å€™ï¼Œä¼šæ˜¾å¾—éå¸¸ç¬¨æ‹™ã€‚ä¸€èˆ¬çš„åšæ³•ä¼šç”¨åŸç”Ÿæ€çš„æ–¹å¼å»è§£æå®šä¹‰å¥½çš„xmlæ–‡ä»¶ï¼Œç„¶åè½¬åŒ–ä¸ºé…ç½®å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼å½“ç„¶å¯ä»¥è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä½†å®ç°èµ·æ¥æ¯”è¾ƒç¹çï¼Œç‰¹åˆ«æ˜¯æ˜¯åœ¨é…ç½®éå¸¸å¤æ‚çš„æ—¶å€™ï¼Œè§£æå·¥ä½œæ˜¯ä¸€ä¸ªä¸å¾—ä¸è€ƒè™‘çš„è´Ÿæ‹…ã€‚Springæä¾›äº†å¯æ‰©å±•Schemaçš„æ”¯æŒï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œå®Œæˆä¸€ä¸ªè‡ªå®šä¹‰é…ç½®ä¸€èˆ¬éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p> <ul><li>è®¾è®¡é…ç½®å±æ€§å’ŒJavaBean</li> <li>ç¼–å†™XSDæ–‡ä»¶</li> <li>ç¼–å†™NamespaceHandlerå’ŒBeanDefinitionParserå®Œæˆè§£æå·¥ä½œ</li> <li>ç¼–å†™spring.handlerså’Œspring.schemasä¸²è”èµ·æ‰€æœ‰éƒ¨ä»¶</li> <li>åœ¨Beanæ–‡ä»¶ä¸­åº”ç”¨</li></ul> <p>åŒæ ·çš„dubboä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œèµ·äº†ä¸€ä¸ªå«dubbo-config-springçš„æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—çš„ä¸‹é¢çš„resources/META-INFæ–‡ä»¶ä¸‹é¢æœ‰ä¸‰ä¸ªè¿™æ ·çš„æ–‡ä»¶dubbo.xsdã€spring.handlersã€spring.schemas</p></div> <p><img src="https://images.zaiolos.top/images/202208011602541.png" alt="image.png"></p> <p>Dubboä¹Ÿæ˜¯åˆ©ç”¨äº†Springæä¾›çš„å¯æ‰©å±•Schemaæœºåˆ¶å®ç°äº†dubboçš„xmlé…ç½®æ–‡ä»¶è§£æ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DubboNamespaceHandler</span> <span class="token keyword">extends</span> <span class="token class-name">NamespaceHandlerSupport</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableSourceBeanMetadataElement</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">DubboNamespaceHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;application&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ApplicationConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ModuleConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;registry&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">RegistryConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;config-center&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ConfigCenterBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;metadata-report&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">MetadataReportConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;monitor&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">MonitorConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;metrics&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">MetricsConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;ssl&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">SslConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;provider&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ProviderConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;consumer&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;protocol&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ProtocolConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ServiceBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;reference&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DubboBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token class-name">ReferenceBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;annotation&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">,</span> <span class="token class-name">ParserContext</span> parserContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BeanDefinitionRegistry</span> registry <span class="token operator">=</span> parserContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerAnnotationConfigProcessors</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DubboBeanUtils</span><span class="token punctuation">.</span><span class="token function">registerCommonBeans</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> parserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> beanDefinition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerAnnotationConfigProcessors</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">registerAnnotationConfigProcessors</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">Version</span><span class="token punctuation">.</span><span class="token function">checkDuplicate</span><span class="token punctuation">(</span><span class="token class-name">DubboNamespaceHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><blockquote><p>ä»è¿™é‡ŒçŸ¥é“æ‰€æœ‰çš„dubboçš„æ ‡ç­¾ï¼Œéƒ½æ˜¯ç»Ÿä¸€ç”±DubboBeanDefinitionParseræ¥è§£æçš„,æ¯ä¸€ä¸ªæ ‡ç­¾éƒ½ä¼šç»Ÿä¸€è§£ææˆå¯¹åº”çš„Beanå¯¹è±¡ã€‚dubboå®šä¹‰äº†ä»¥ä¸‹é…ç½®ç±»(è§dubbo/dubbo-config/dubbo-config-api,å‡†ç¡®è¯´åº”è¯¥æ˜¯Beançš„çˆ¶ç±»), Bean(è§dubbo/dubbo-config/dubbo-config-spring)</p></blockquote> <h4 id="ç›¸å…³é…ç½®ç±»"><a href="#ç›¸å…³é…ç½®ç±»" class="header-anchor">#</a> ç›¸å…³é…ç½®ç±»</h4> <p><img src="https://images.zaiolos.top/images/202208011602896.png" alt="image.png"> <img src="https://images.zaiolos.top/images/202208011603995.png" alt="image.png"><img src="https://images.zaiolos.top/images/202208011603934.png" alt="image.png"></p> <blockquote><p>é…ç½®DubboæœåŠ¡æ—¶çš„DubboServiceæ ‡ç­¾å¯¹åº”çš„Beanå°±æ˜¯ServiceBeanï¼Œå¯¹åº”çš„é…ç½®ç±»å°±æ˜¯ServiceConfig
è°ƒç”¨DubboæœåŠ¡æ—¶çš„DubboReferenceæ ‡ç­¾å¯¹åº”çš„Beanå°±æ˜¯ReferenceBeanï¼Œå¯¹åº”çš„é…ç½®ç±»å°±æ˜¯ReferenceConfig
è¿™ä¸¤ä¸ªé…ç½®ç±»éƒ½æœ‰ä¸€ä¸ªxxxConfigBaseï¼Œè¿™ä¸ªBaseç±»é‡Œé¢çš„å±æ€§å°±æ˜¯èƒ½é…ç½®çš„ä¿¡æ¯</p></blockquote> <p><img src="https://images.zaiolos.top/images/202208011603447.png" alt="image.png"></p> <h3 id="_1-2-æ£€æŸ¥é…ç½®"><a href="#_1-2-æ£€æŸ¥é…ç½®" class="header-anchor">#</a> 1.2 æ£€æŸ¥é…ç½®</h3> <ul><li>æ£€æŸ¥interfaceå±æ€§æ˜¯å¦åˆæ³•</li> <li>æ£€æŸ¥providerConfigå’ŒApplicationConfigç­‰æ ¸å¿ƒé…ç½®ç±»å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºä¼šä»å…¶ä»–é…ç½®ç±»è·å–å¯¹åº”çš„å®ä¾‹ï¼›</li> <li>æ£€æŸ¥å¹¶å¤„ç†æ³›åŒ–æœåŠ¡å’Œæ™®é€šæœåŠ¡ç±»</li> <li>æ£€æŸ¥æœ¬åœ°å­˜æ ¹é…ç½®</li> <li>å¯¹ApplicationConfigã€RegisterConfigç­‰é…ç½®ç±»è¿›è¡Œæ£€æµ‹ï¼Œä¸ºç©ºåˆ™å°è¯•åˆ›å»ºï¼Œæ— æ³•åˆ›å»ºåˆ™æŠ›å¼‚å¸¸ï¼›</li></ul> <h3 id="_1-3-é‡ç‚¹-springå®¹å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶å¼€å§‹æ‰§è¡Œæš´éœ²"><a href="#_1-3-é‡ç‚¹-springå®¹å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶å¼€å§‹æ‰§è¡Œæš´éœ²" class="header-anchor">#</a> 1.3 (é‡ç‚¹)Springå®¹å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶å¼€å§‹æ‰§è¡Œæš´éœ²</h3> <p>æˆ‘ä»¬éƒ½çŸ¥é“å½“ Spring å®¹å™¨å¯åŠ¨å®Œæˆä¼šå‘å‡º ApplicationContextEvent äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>org.apache.dubbo.config.spring.context .DubboBootstrapApplicationListener# onApplicationContextEvent</code>æ–¹æ³•æ ¸å¿ƒä»£ç ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationContextEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Spring å®¹å™¨å¯åŠ¨å®Œæˆ</span>
        <span class="token function">onContextRefreshedEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">)</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">ContextClosedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Spring å®¹å™¨å…³é—­</span>
        <span class="token function">onContextClosedEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ContextClosedEvent</span><span class="token punctuation">)</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onContextRefreshedEvent</span><span class="token punctuation">(</span><span class="token class-name">ContextRefreshedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dubboBootstrap<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å½“æ¥æ”¶åˆ°ContextRefreshedEventäº‹ä»¶åä¼šæœ€ç»ˆä¼šè°ƒç”¨<code>org.apache.dubbo.config.bootstrap. DubboBootstrap#start</code>æ–¹æ³•å¯åŠ¨æœåŠ¡æ³¨å†Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DubboBootstrap</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">//åˆ¤æ–­æœåŠ¡æ˜¯å¦å¯åŠ¨ é˜²æ­¢é‡å¤æš´éœ²æœåŠ¡ åŸå­æ“ä½œ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>started<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//..</span>
        <span class="token comment">// æš´éœ²DubboæœåŠ¡</span>
        <span class="token function">exportServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ä¸Šé¢çš„ä»£ç å…ˆè¿›è¡ŒåŸå­æ“ä½œå»è®¾ç½®å¯åŠ¨æ ‡è¯†é˜²æ­¢é‡å¤æš´éœ²æœåŠ¡ï¼Œå…¶<code>exportServices</code>ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">exportServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¾ªç¯æ‰€æœ‰éœ€è¦æœåŠ¡æš´éœ²çš„é…ç½®</span>
        configManager<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sc <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO, compatible with ServiceConfig.export()</span>
            <span class="token class-name">ServiceConfig</span> serviceConfig <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServiceConfig</span><span class="token punctuation">)</span> sc<span class="token punctuation">;</span>
            serviceConfig<span class="token punctuation">.</span><span class="token function">setBootstrap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//æ˜¯å¦å¼‚æ­¥å¯¼å‡º</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>exportAsync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//è·å–çº¿ç¨‹æ± </span>
                <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> executorRepository<span class="token punctuation">.</span><span class="token function">getServiceExporterExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">//å¼‚æ­¥æœåŠ¡æš´éœ²</span>
                    sc<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                asyncExportingFutures<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//åŒæ­¥æœåŠ¡æš´éœ²å¯¼å‡º</span>
                sc<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                exportedServices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>ä¸Šé¢çš„ä»£ç æ˜¯å¾ªç¯å¯¹æ‰€æœ‰çš„ Dubbo æœåŠ¡è¿›è¡Œæš´éœ²ï¼Œæ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªexportAsyncæ ‡è¯†æ¥åˆ¤æ–­æ˜¯å¦å¼‚æ­¥æš´éœ²æœåŠ¡(å¼‚æ­¥æš´éœ²æœåŠ¡æ˜¯æŒ‡åœ¨å¦å¤–çš„çº¿ç¨‹æ‰§è¡Œä¸é˜»å¡å½“å‰çº¿ç¨‹)ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹åˆ°ä¸»è¦çš„æœåŠ¡æš´éœ²ä»£ç <code>org.apache.dubbo.config.ServiceConfig#export</code>æ–¹æ³•ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     *
     * æœåŠ¡æš´éœ²
     **/</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//...</span>
        <span class="token comment">//æ˜¯å¦å»¶è¿Ÿæš´éœ²åˆ¤æ–­</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//å»¶è¿Ÿæš´éœ²</span>
            <span class="token comment">//ä½¿ç”¨å»¶æ—¶è°ƒåº¦å™¨è¿›è¡ŒæœåŠ¡æš´éœ²</span>
            <span class="token constant">DELAY_EXPORT_EXECUTOR</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">doExport</span><span class="token punctuation">,</span> <span class="token function">getDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//æœåŠ¡æš´éœ²</span>
            <span class="token function">doExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>è¿›å…¥doExport()</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">doExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>unexported<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;The service &quot;</span> <span class="token operator">+</span> interfaceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has already unexported!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exported<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    exported <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        path <span class="token operator">=</span> interfaceName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">doExportUrls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>ç„¶åå¯¹æ¯ä¸ªåè®®çš„æœåŠ¡è¿›è¡Œå¯¼å‡º</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doExportUrls</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åŠ è½½æ³¨å†Œä¸­å¿ƒé“¾æ¥</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> registryURLs <span class="token operator">=</span> <span class="token function">loadRegistries</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// éå† protocolsï¼Œå¹¶åœ¨æ¯ä¸ªåè®®ä¸‹å¯¼å‡ºæœåŠ¡</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProtocolConfig</span> protocolConfig <span class="token operator">:</span> protocols<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">doExportUrlsFor1Protocol</span><span class="token punctuation">(</span>protocolConfig<span class="token punctuation">,</span> registryURLs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_1-5-è§£æurl"><a href="#_1-5-è§£æurl" class="header-anchor">#</a> 1.5 è§£æURL</h3> <blockquote><p>èµ°åˆ°è¿™ä¸€æ­¥urlå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š
registry://192.168.22.130:2181/org.apache.dubbo.registry.RegistryService/â€¦â€¦
è¿™ä¸€æ­¥æ˜¯æ ¹æ®é…ç½®ä¿¡æ¯ç»„è£…URL, è€Œä¸”URLé©±åŠ¨æµç¨‹çš„æ‰§è¡Œï¼Œä¼šå†å„ä¸ªæ¨¡å—ä¹‹é—´ä¸€ç›´å¾€ä¸‹ä¼ ï¼Œåç»­ä¼šä¸æ–­ä¿®æ”¹URLå¤´æˆ–åè®®åœ°å€ï¼Œå¹¶æ ¹æ®URLåœ°å€ä¸­çš„ä¿¡æ¯åšç›¸åº”çš„å¤„ç†ï¼›
åœ¨doExportUrlsFor1Protocolæ–¹æ³•ä¸­åšäº†URLçš„ç»„è£…å¤„ç†ï¼Œé€šè¿‡åå°„çš„æ–¹å¼è·å–åˆ°ç‰ˆæœ¬ã€æ—¶é—´æˆ³ã€æ–¹æ³•åä»¥åŠå„ç§é…ç½®å¯¹è±¡çš„å­—æ®µä¿¡æ¯ï¼Œç„¶åæ”¾å…¥map,æºç å¤ªé•¿äº†ï¼Œè¿™å—åªè´´ä¸€ä¸‹ä¼ªä»£ç å¸®åŠ©ç†è§£ï¼š</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doExportUrlsFor1Protocol</span><span class="token punctuation">(</span><span class="token class-name">ProtocolConfig</span> protocolConfig<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> registryURLs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å– ArgumentConfig åˆ—è¡¨</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>éå† <span class="token class-name">ArgumentConfig</span> åˆ—è¡¨<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type ä¸ä¸º <span class="token keyword">null</span>ï¼Œä¹Ÿä¸ä¸ºç©ºä¸²<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ†æ”¯1</span>
            <span class="token number">1.</span> é€šè¿‡åå°„è·å– interfaceClass çš„æ–¹æ³•åˆ—è¡¨
            <span class="token keyword">for</span> <span class="token punctuation">(</span>éå†æ–¹æ³•åˆ—è¡¨<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token number">1.</span> æ¯”å¯¹æ–¹æ³•åï¼ŒæŸ¥æ‰¾ç›®æ ‡æ–¹æ³•
                <span class="token number">2.</span> é€šè¿‡åå°„è·å–ç›®æ ‡æ–¹æ³•çš„å‚æ•°ç±»å‹æ•°ç»„ argtypes
                <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ†æ”¯2</span>
                    <span class="token number">1.</span> ä» argtypes æ•°ç»„ä¸­è·å–ä¸‹æ ‡ index å¤„çš„å…ƒç´  argType
                    <span class="token number">2.</span> æ£€æµ‹ argType çš„åç§°ä¸ <span class="token class-name">ArgumentConfig</span> ä¸­çš„ type å±æ€§æ˜¯å¦ä¸€è‡´
                    <span class="token number">3.</span> æ·»åŠ  <span class="token class-name">ArgumentConfig</span> å­—æ®µä¿¡æ¯åˆ° map ä¸­ï¼Œæˆ–æŠ›å‡ºå¼‚å¸¸
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ†æ”¯3</span>
                    <span class="token number">1.</span> éå†å‚æ•°ç±»å‹æ•°ç»„ argtypesï¼ŒæŸ¥æ‰¾ argument<span class="token punctuation">.</span>type ç±»å‹çš„å‚æ•°
                    <span class="token number">2.</span> æ·»åŠ  <span class="token class-name">ArgumentConfig</span> å­—æ®µä¿¡æ¯åˆ° map ä¸­
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ†æ”¯4</span>
            <span class="token number">1.</span> æ·»åŠ  <span class="token class-name">ArgumentConfig</span> å­—æ®µä¿¡æ¯åˆ° map ä¸­
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="_2-å¯¼å‡ºdubboæœåŠ¡"><a href="#_2-å¯¼å‡ºdubboæœåŠ¡" class="header-anchor">#</a> 2. å¯¼å‡ºDubboæœåŠ¡</h2> <p>å‡†å¤‡å·¥ä½œåšå®Œäº†ï¼Œæ¥ä¸‹æ¥è¿›è¡ŒæœåŠ¡å¯¼å‡ºã€‚æœåŠ¡å¯¼å‡ºåˆ†ä¸ºå¯¼å‡ºåˆ°æœ¬åœ°JVMå’Œå¯¼å‡ºåˆ°è¿œç¨‹ã€‚
ä»£ç æ ¹æ® url ä¸­çš„ scope å‚æ•°å†³å®šæœåŠ¡å¯¼å‡ºæ–¹å¼ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p> <ul><li>scope = noneï¼Œä¸å¯¼å‡ºæœåŠ¡</li> <li>scope != remoteï¼Œå¯¼å‡ºåˆ°æœ¬åœ°</li> <li>scope != localï¼Œå¯¼å‡ºåˆ°è¿œç¨‹</li></ul> <p><strong>æœåŠ¡å‘å¸ƒçš„æœ¬è´¨å°±æ˜¯æŠŠexportçš„æ¯ä¸ªæœåŠ¡è½¬ä¸ºä¸€ä¸ªå¯¹åº”çš„Invokerå¯æ‰§è¡Œä½“ï¼Œç„¶åæŠŠè½¬æ¢åçš„Invokeréƒ½æ”¾åˆ°ä¸€ä¸ªexporterMap(key,invoker)é›†åˆä¸­</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doExportUrlsFor1Protocol</span><span class="token punctuation">(</span><span class="token class-name">ProtocolConfig</span> protocolConfig<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> registryURLs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// çœç•¥æ— å…³ä»£ç </span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ExtensionLoader</span><span class="token punctuation">.</span><span class="token function">getExtensionLoader</span><span class="token punctuation">(</span><span class="token class-name">ConfiguratorFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">hasExtension</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åŠ è½½ ConfiguratorFactoryï¼Œå¹¶ç”Ÿæˆ Configurator å®ä¾‹ï¼Œç„¶åé€šè¿‡å®ä¾‹é…ç½® url</span>
        url <span class="token operator">=</span> <span class="token class-name">ExtensionLoader</span><span class="token punctuation">.</span><span class="token function">getExtensionLoader</span><span class="token punctuation">(</span><span class="token class-name">ConfiguratorFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getExtension</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConfigurator</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> scope <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SCOPE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœ scope = noneï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åš</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SCOPE_NONE</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// scope != remoteï¼Œå¯¼å‡ºåˆ°æœ¬åœ°</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SCOPE_REMOTE</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">exportLocal</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// scope != localï¼Œå¯¼å‡ºåˆ°è¿œç¨‹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SCOPE_LOCAL</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>registryURLs <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>registryURLs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token constant">URL</span> registryURL <span class="token operator">:</span> registryURLs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">addParameterIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC_KEY</span><span class="token punctuation">,</span> registryURL<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC_KEY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// åŠ è½½ç›‘è§†å™¨é“¾æ¥</span>
                    <span class="token class-name">URL</span> monitorUrl <span class="token operator">=</span> <span class="token function">loadMonitor</span><span class="token punctuation">(</span>registryURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>monitorUrl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// å°†ç›‘è§†å™¨é“¾æ¥ä½œä¸ºå‚æ•°æ·»åŠ åˆ° url ä¸­</span>
                        url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">addParameterAndEncoded</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">MONITOR_KEY</span><span class="token punctuation">,</span> monitorUrl<span class="token punctuation">.</span><span class="token function">toFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token class-name">String</span> proxy <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">PROXY_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        registryURL <span class="token operator">=</span> registryURL<span class="token punctuation">.</span><span class="token function">addParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">PROXY_KEY</span><span class="token punctuation">,</span> proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// ä¸ºæœåŠ¡æä¾›ç±»(ref)ç”Ÿæˆ Invoker</span>
                    <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> invoker <span class="token operator">=</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getInvoker</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> interfaceClass<span class="token punctuation">,</span> registryURL<span class="token punctuation">.</span><span class="token function">addParameterAndEncoded</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">EXPORT_KEY</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span><span class="token function">toFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// DelegateProviderMetaDataInvoker ç”¨äºæŒæœ‰ Invoker å’Œ ServiceConfig</span>
                    <span class="token class-name">DelegateProviderMetaDataInvoker</span> wrapperInvoker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelegateProviderMetaDataInvoker</span><span class="token punctuation">(</span>invoker<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// å¯¼å‡ºæœåŠ¡ï¼Œå¹¶ç”Ÿæˆ Exporter</span>
                    <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> protocol<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>wrapperInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    exporters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>exporter<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
            <span class="token comment">// ä¸å­˜åœ¨æ³¨å†Œä¸­å¿ƒï¼Œä»…å¯¼å‡ºæœåŠ¡</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> invoker <span class="token operator">=</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getInvoker</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> interfaceClass<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DelegateProviderMetaDataInvoker</span> wrapperInvoker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelegateProviderMetaDataInvoker</span><span class="token punctuation">(</span>invoker<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> protocol<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>wrapperInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
                exporters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>exporter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>urls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>ä¸ç®¡æ˜¯å¯¼å‡ºåˆ°æœ¬åœ°ï¼Œè¿˜æ˜¯è¿œç¨‹ã€‚è¿›è¡ŒæœåŠ¡å¯¼å‡ºä¹‹å‰ï¼Œå‡éœ€è¦å…ˆåˆ›å»º Invokerï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ­¥éª¤ã€‚å› æ­¤ä¸‹é¢å…ˆæ¥åˆ†æ Invoker çš„åˆ›å»ºè¿‡ç¨‹</p> <h3 id="_2-1-invokeråˆ›å»ºè¿‡ç¨‹"><a href="#_2-1-invokeråˆ›å»ºè¿‡ç¨‹" class="header-anchor">#</a> 2.1 Invokeråˆ›å»ºè¿‡ç¨‹</h3> <p>Invokeræ˜¯ä¸€ä¸ªé‡è¦æ¨¡å‹ï¼Œåœ¨æœåŠ¡çš„æä¾›ç«¯å’Œè°ƒç”¨ç«¯éƒ½ä¼šå‡ºç°Invoker</p> <blockquote><p>Invoker æ˜¯å®ä½“åŸŸï¼Œå®ƒæ˜¯ Dubbo çš„æ ¸å¿ƒæ¨¡å‹ï¼Œå…¶å®ƒæ¨¡å‹éƒ½å‘å®ƒé æ‰°ï¼Œæˆ–è½¬æ¢æˆå®ƒï¼Œå®ƒä»£è¡¨ä¸€ä¸ªå¯æ‰§è¡Œä½“ï¼Œå¯å‘å®ƒå‘èµ· invoke è°ƒç”¨ã€‚<code>å®ƒæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæœ¬åœ°çš„å®ç°ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¿œç¨‹çš„å®ç°ï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªé›†ç¾¤å®ç°</code></p></blockquote> <p>Invokerç”±ProxyFactoryåˆ›å»ºè€Œæ¥ï¼ŒDubboé»˜è®¤çš„ProxyFactoryå®ç°ç±»æ˜¯JavassistProxyFactoryã€‚æ¥çœ‹ä¸€ä¸‹JavassistProxyFactoryç±»åˆ›å»ºInvokerçš„è¿‡ç¨‹</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavassistProxyFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProxyFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> invoker<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span>interfaces<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InvokerInvocationHandler</span><span class="token punctuation">(</span>invoker<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getInvoker</span><span class="token punctuation">(</span><span class="token class-name">T</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸ºç›®æ ‡ç±»åˆ›å»º Wrapper</span>
        <span class="token keyword">final</span> <span class="token class-name">Wrapper</span> wrapper <span class="token operator">=</span> <span class="token class-name">Wrapper</span><span class="token punctuation">.</span><span class="token function">getWrapper</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">'$'</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºåŒ¿å Invoker ç±»å¯¹è±¡ï¼Œå¹¶å®ç° doInvoke æ–¹æ³• è¿”å›</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AbstractProxyInvoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> type<span class="token punctuation">,</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doInvoke</span><span class="token punctuation">(</span><span class="token class-name">T</span> proxy<span class="token punctuation">,</span> <span class="token class-name">String</span> methodName<span class="token punctuation">,</span>
                                      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">,</span>
                                      <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> wrapper<span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> methodName<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">doInvoke</p> <p>é‡å†™åçš„doInvokeé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä»…ä»…æ˜¯å°†è°ƒç”¨è¯·æ±‚è½¬å‘ç»™äº†Wrapperç±»çš„invokeMethodï¼ŒWrapperç”¨äºâ€œåŒ…è£¹â€ç›®æ ‡ç±»ï¼ŒWrapperæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä»…å¯é€šè¿‡getWrapperæ–¹æ³•ä¼ å…¥çš„Classå¯¹è±¡è¿›è¡Œè§£æï¼Œæ‹¿åˆ°ç±»çš„ä¿¡æ¯ï¼Œç”ŸæˆinvokeMethodæ–¹æ³•å’Œå…¶ä»–æ–¹æ³•ä»£ç ï¼Œä»£ç ç”Ÿæˆå®Œæ¯•ä¹‹åï¼Œé€šè¿‡javassistç”ŸæˆClasså¯¹è±¡ï¼Œæœ€åå†é€šè¿‡åå°„åˆ›å»ºWrapperå®ä¾‹ã€‚</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Wrapper</span> <span class="token function">getWrapper</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>	
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">ClassGenerator</span><span class="token punctuation">.</span><span class="token function">isDynamicClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant">OBJECT_WRAPPER</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»ç¼“å­˜ä¸­è·å– Wrapper å®ä¾‹</span>
    <span class="token class-name">Wrapper</span> ret <span class="token operator">=</span> <span class="token constant">WRAPPER_MAP</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ›å»º Wrapper</span>
        ret <span class="token operator">=</span> <span class="token function">makeWrapper</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å†™å…¥ç¼“å­˜</span>
        <span class="token constant">WRAPPER_MAP</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2-2-å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°"><a href="#_2-2-å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°" class="header-anchor">#</a> 2.2 å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">exportLocal</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœ URL çš„åè®®å¤´ç­‰äº injvmï¼Œè¯´æ˜å·²ç»å¯¼å‡ºåˆ°æœ¬åœ°äº†ï¼Œæ— éœ€å†æ¬¡å¯¼å‡º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">LOCAL_PROTOCOL</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">URL</span> local <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">toFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setProtocol</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">LOCAL_PROTOCOL</span><span class="token punctuation">)</span>    <span class="token comment">// è®¾ç½®åè®®å¤´ä¸º injvm</span>
            <span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token constant">LOCALHOST</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServiceClassHolder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pushServiceClass</span><span class="token punctuation">(</span><span class="token function">getServiceClass</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»º Invokerï¼Œå¹¶å¯¼å‡ºæœåŠ¡ï¼Œè¿™é‡Œçš„ protocol ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨InjvmProtocolçš„exportæ–¹æ³•</span>
        <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> protocol<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>
            proxyFactory<span class="token punctuation">.</span><span class="token function">getInvoker</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> interfaceClass<span class="token punctuation">,</span> local<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exporters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>exporter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>exportLocal æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆæ ¹æ® URL åè®®å¤´å†³å®šæ˜¯å¦å¯¼å‡ºæœåŠ¡ã€‚è‹¥éœ€å¯¼å‡ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ URL å¹¶å°†åè®®å¤´ã€ä¸»æœºåä»¥åŠç«¯å£è®¾ç½®æˆæ–°çš„å€¼ã€‚ç„¶ååˆ›å»º Invokerï¼Œå¹¶è°ƒç”¨ InjvmProtocol çš„ export æ–¹æ³•å¯¼å‡ºæœåŠ¡ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ InjvmProtocol çš„ export æ–¹æ³•éƒ½åšäº†å“ªäº›äº‹æƒ…</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> invoker<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RpcException</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»º InjvmExporter</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InjvmExporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>invoker<span class="token punctuation">,</span> invoker<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServiceKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> exporterMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>å¦‚ä¸Šï¼ŒInjvmProtocol çš„ export æ–¹æ³•ä»…åˆ›å»ºäº†ä¸€ä¸ª InjvmExporterï¼Œæ— å…¶ä»–é€»è¾‘ã€‚åˆ°æ­¤å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°å°±åˆ†æå®Œäº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æå¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹çš„è¿‡ç¨‹ã€‚</p></blockquote> <h3 id="_2-3-å¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹"><a href="#_2-3-å¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹" class="header-anchor">#</a> 2.3 å¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹</h3> <p>ä¸å¯¼å‡ºæœåŠ¡åˆ°æœ¬åœ°ç›¸æ¯”ï¼Œå¯¼å‡ºæœåŠ¡åˆ°è¿œç¨‹åŒ…æ‹¬äº†æœåŠ¡å¯¼å‡ºä¸æœåŠ¡æ³¨å†Œä¸¤ä¸ªè¿‡ç¨‹ï¼›</p> <h4 id="_2-3-1-æœåŠ¡å¯¼å‡º"><a href="#_2-3-1-æœåŠ¡å¯¼å‡º" class="header-anchor">#</a> 2.3.1 æœåŠ¡å¯¼å‡º</h4> <p><code>RegistryProtocol</code> çš„ <code>export</code> æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> originInvoker<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RpcException</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯¼å‡ºæœåŠ¡</span>
    <span class="token keyword">final</span> <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> <span class="token function">doLocalExport</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–æ³¨å†Œä¸­å¿ƒ URLï¼Œä»¥ zookeeper æ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œå¾—åˆ°çš„ç¤ºä¾‹ URL å¦‚ä¸‹ï¼š</span>
    <span class="token comment">// zookeeper://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?application=demo-provider&amp;dubbo=2.0.2&amp;export=dubbo%3A%2F%2F172.17.48.52%3A20880%2Fcom.alibaba.dubbo.demo.DemoService%3Fanyhost%3Dtrue%26application%3Ddemo-provider</span>
    <span class="token class-name">URL</span> registryUrl <span class="token operator">=</span> <span class="token function">getRegistryUrl</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ ¹æ® URL åŠ è½½ Registry å®ç°ç±»ï¼Œæ¯”å¦‚ ZookeeperRegistry</span>
    <span class="token keyword">final</span> <span class="token class-name">Registry</span> registry <span class="token operator">=</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// è·å–å·²æ³¨å†Œçš„æœåŠ¡æä¾›è€… URLï¼Œæ¯”å¦‚ï¼š</span>
    <span class="token comment">// dubbo://172.17.48.52:20880/com.alibaba.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello</span>
    <span class="token keyword">final</span> <span class="token class-name">URL</span> registeredProviderUrl <span class="token operator">=</span> <span class="token function">getRegisteredProviderUrl</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å– register å‚æ•°</span>
    <span class="token keyword">boolean</span> register <span class="token operator">=</span> registeredProviderUrl<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å‘æœåŠ¡æä¾›è€…ä¸æ¶ˆè´¹è€…æ³¨å†Œè¡¨ä¸­æ³¨å†ŒæœåŠ¡æä¾›è€…</span>
    <span class="token class-name">ProviderConsumerRegTable</span><span class="token punctuation">.</span><span class="token function">registerProvider</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">,</span> registryUrl<span class="token punctuation">,</span> registeredProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ ¹æ® register çš„å€¼å†³å®šæ˜¯å¦æ³¨å†ŒæœåŠ¡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>register<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡</span>
        <span class="token function">register</span><span class="token punctuation">(</span>registryUrl<span class="token punctuation">,</span> registeredProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProviderConsumerRegTable</span><span class="token punctuation">.</span><span class="token function">getProviderWrapper</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReg</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–è®¢é˜… URLï¼Œæ¯”å¦‚ï¼š</span>
    <span class="token comment">// provider://172.17.48.52:20880/com.alibaba.dubbo.demo.DemoService?category=configurators&amp;check=false&amp;anyhost=true&amp;application=demo-provider&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello</span>
    <span class="token keyword">final</span> <span class="token class-name">URL</span> overrideSubscribeUrl <span class="token operator">=</span> <span class="token function">getSubscribedOverrideUrl</span><span class="token punctuation">(</span>registeredProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºç›‘å¬å™¨</span>
    <span class="token keyword">final</span> <span class="token class-name">OverrideListener</span> overrideSubscribeListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OverrideListener</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">,</span> originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    overrideListeners<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">,</span> overrideSubscribeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å‘æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¢é˜… override æ•°æ®</span>
    registry<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">,</span> overrideSubscribeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºå¹¶è¿”å› DestroyableExporter</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DestroyableExporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>exporter<span class="token punctuation">,</span> originInvoker<span class="token punctuation">,</span> overrideSubscribeUrl<span class="token punctuation">,</span> registeredProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h5 id="ä¸»è¦é€»è¾‘"><a href="#ä¸»è¦é€»è¾‘" class="header-anchor">#</a> ä¸»è¦é€»è¾‘</h5> <ol><li>è°ƒç”¨doLocalExport å¯¼å‡ºæœåŠ¡</li> <li>å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡</li> <li>å‘æ³¨å†Œä¸­å¿ƒè®¢é˜…overrideæ•°æ®</li> <li>åˆ›å»ºå¹¶è¿”å›DestroyableExporter</li></ol> <h5 id="_2-3-1-1-ç¬¬ä¸€æ­¥-dolocalexport"><a href="#_2-3-1-1-ç¬¬ä¸€æ­¥-dolocalexport" class="header-anchor">#</a> 2.3.1.1 ç¬¬ä¸€æ­¥ doLocalExport</h5> <p>è€ç‰ˆæœ¬ä»£ç ä½¿ç”¨å…¸å‹çš„åŒé‡æ£€æŸ¥é”æœºåˆ¶æ¥åˆ›å»ºexporter
æ–°ç‰ˆæœ¬ä»£ç ä½¿ç”¨<code>ConcurrentHashMapä¸­çš„çº¿ç¨‹å®‰å…¨çš„computeIfAbsentæ–¹æ³•</code>æ¥ä¿è¯åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// è€ç‰ˆæœ¬ä»£ç </span>
<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">doLocalExport</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> originInvoker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token function">getCacheKey</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¿é—®ç¼“å­˜</span>
    <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> bounds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exporter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>bounds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exporter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> bounds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>exporter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ›å»º Invoker ä¸ºå§”æ‰˜ç±»å¯¹è±¡</span>
                <span class="token keyword">final</span> <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> invokerDelegete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvokerDelegete</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">,</span> <span class="token function">getProviderUrl</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// æ ¸å¿ƒä»£ç åœ¨è¿™é‡Œï¼š </span>
                <span class="token comment">//è°ƒç”¨ protocol çš„ export æ–¹æ³•å¯¼å‡ºæœåŠ¡</span>
                exporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> protocol<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>invokerDelegete<span class="token punctuation">)</span><span class="token punctuation">,</span> originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// å†™ç¼“å­˜</span>
                bounds<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> exporter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> exporter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ–°ä»£ç </span>
<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">doLocalExport</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> originInvoker<span class="token punctuation">,</span> <span class="token class-name">URL</span> providerUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–ç¼“å­˜key    </span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token function">getCacheKey</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// computeIfAbsentæ–¹æ³•ï¼Œå¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œå°±æ”¾å…¥ç¼“å­˜</span>
        <span class="token comment">// boundsæ˜¯ç±»å‹æ˜¯ConcurrentHashMap</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> bounds<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¿™ä¸ªæ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ å–ä»£äº†åŸæ¥çš„åŒé‡æ£€æµ‹é”æ–¹å¼	</span>
            <span class="token comment">// åˆ›å»º Invoker ä¸ºå§”æ‰˜ç±»å¯¹è±¡</span>
            <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> invokerDelegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvokerDelegate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">,</span> providerUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è°ƒç”¨ protocol çš„ export æ–¹æ³•å¯¼å‡ºæœåŠ¡</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> protocol<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>invokerDelegate<span class="token punctuation">)</span><span class="token punctuation">,</span> originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>é‡ç‚¹åœ¨äº<code>protocol.export</code>è¿™éƒ¨åˆ†ï¼Œå‡å®šè¿è¡Œæ—¶åè®®ä¸ºdubbo(é»˜è®¤)ï¼Œæ­¤å¤„protocolå˜é‡åœ¨è¿è¡Œæ—¶å€™å°†ä¼šåŠ è½½DubboProtocolï¼Œå¹¶è°ƒç”¨DubboProtocolç±»çš„exportæ–¹æ³•ï¼Œä¸‹é¢æ¥åˆ†æDubboProtocolçš„exportæ–¹æ³•ï¼š</p> <h5 id="dubboprotocolç±»ä¸­çš„exportæ–¹æ³•"><a href="#dubboprotocolç±»ä¸­çš„exportæ–¹æ³•" class="header-anchor">#</a> DubboProtocolç±»ä¸­çš„exportæ–¹æ³•</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> invoker<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RpcException</span> <span class="token punctuation">{</span>
    <span class="token class-name">URL</span> url <span class="token operator">=</span> invoker<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–æœåŠ¡æ ‡è¯†ï¼Œç†è§£æˆæœåŠ¡åæ ‡ä¹Ÿè¡Œã€‚ç”±æœåŠ¡ç»„åï¼ŒæœåŠ¡åï¼ŒæœåŠ¡ç‰ˆæœ¬å·ä»¥åŠç«¯å£ç»„æˆã€‚æ¯”å¦‚ï¼š</span>
    <span class="token comment">// demoGroup/com.alibaba.dubbo.demo.DemoService:1.0.1:20880</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token function">serviceKey</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»º DubboExporter</span>
    <span class="token class-name">DubboExporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DubboExporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>invoker<span class="token punctuation">,</span> key<span class="token punctuation">,</span> exporterMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å°† &lt;key, exporter&gt; é”®å€¼å¯¹æ”¾å…¥ç¼“å­˜ä¸­</span>
    exporterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> exporter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æœ¬åœ°å­˜æ ¹ç›¸å…³ä»£ç </span>
    <span class="token class-name">Boolean</span> isStubSupportEvent <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">STUB_EVENT_KEY</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_STUB_EVENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Boolean</span> isCallbackservice <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">IS_CALLBACK_SERVICE</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isStubSupportEvent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isCallbackservice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> stubServiceMethods <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">STUB_EVENT_METHODS_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stubServiceMethods <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> stubServiceMethods<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// çœç•¥æ—¥å¿—æ‰“å°ä»£ç </span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ ¸å¿ƒæ–¹æ³•ï¼š--  å¯åŠ¨æœåŠ¡å™¨</span>
    <span class="token function">openServer</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¼˜åŒ–åºåˆ—åŒ–</span>
    <span class="token function">optimizeSerialization</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> exporter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h5 id="_2-3-1-2-å¯åŠ¨æœåŠ¡å™¨"><a href="#_2-3-1-2-å¯åŠ¨æœåŠ¡å™¨" class="header-anchor">#</a> 2.3.1.2 å¯åŠ¨æœåŠ¡å™¨</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">openServer</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å– host:portï¼Œå¹¶å°†å…¶ä½œä¸ºæœåŠ¡å™¨å®ä¾‹çš„ keyï¼Œç”¨äºæ ‡è¯†å½“å‰çš„æœåŠ¡å™¨å®ä¾‹</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> isServer <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">IS_SERVER_KEY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¿é—®ç¼“å­˜</span>
        <span class="token class-name">ProtocolServer</span> server <span class="token operator">=</span> serverMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼ˆå•ç½‘å¡ï¼‰ï¼ŒåŒä¸€ä¸ªç«¯å£ä¸Šä»…å…è®¸å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ã€‚</span>
        <span class="token comment">// è‹¥æŸä¸ªç«¯å£ä¸Šå·²æœ‰æœåŠ¡å™¨å®ä¾‹ï¼Œæ­¤æ—¶åˆ™è°ƒç”¨ reset æ–¹æ³•é‡ç½®æœåŠ¡å™¨çš„ä¸€äº›é…ç½®</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>server <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                server <span class="token operator">=</span> serverMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>server <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æ ¸å¿ƒæ–¹æ³•ï¼šåˆ›å»ºæœåŠ¡å™¨å®ä¾‹</span>
                    serverMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">createServer</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// æœåŠ¡å™¨å·²åˆ›å»ºï¼Œåˆ™æ ¹æ® url ä¸­çš„é…ç½®é‡ç½®æœåŠ¡å™¨</span>
            server<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h5 id="_2-3-1-3-åˆ›å»ºæœåŠ¡å™¨"><a href="#_2-3-1-3-åˆ›å»ºæœåŠ¡å™¨" class="header-anchor">#</a> 2.3.1.3 åˆ›å»ºæœåŠ¡å™¨</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
createServer åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒçš„é€»è¾‘
1.æ£€æµ‹æ˜¯å¦å­˜åœ¨ server å‚æ•°æ‰€ä»£è¡¨çš„ Transporter æ‹“å±•ï¼Œä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸
2.åˆ›å»ºæœåŠ¡å™¨å®ä¾‹
3.æ£€æµ‹æ˜¯å¦æ”¯æŒ client å‚æ•°æ‰€è¡¨ç¤ºçš„ Transporter æ‹“å±•ï¼Œä¸å­˜åœ¨ä¹Ÿæ˜¯æŠ›å‡ºå¼‚å¸¸
*/</span>
<span class="token keyword">private</span> <span class="token class-name">ProtocolServer</span> <span class="token function">createServer</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    url <span class="token operator">=</span> <span class="token class-name">URLBuilder</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token comment">// send readonly event when server closes, it's enabled by default</span>
            <span class="token punctuation">.</span><span class="token function">addParameterIfAbsent</span><span class="token punctuation">(</span><span class="token constant">CHANNEL_READONLYEVENT_SENT_KEY</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// æ·»åŠ å¿ƒè·³æ£€æµ‹é…ç½®åˆ° url ä¸­</span>
            <span class="token punctuation">.</span><span class="token function">addParameterIfAbsent</span><span class="token punctuation">(</span><span class="token constant">HEARTBEAT_KEY</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_HEARTBEAT</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// æ·»åŠ ç¼–ç è§£ç å™¨å‚æ•°    </span>
            <span class="token punctuation">.</span><span class="token function">addParameter</span><span class="token punctuation">(</span><span class="token constant">CODEC_KEY</span><span class="token punctuation">,</span> <span class="token class-name">DubboCodec</span><span class="token punctuation">.</span><span class="token constant">NAME</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å– server å‚æ•°ï¼Œé»˜è®¤ä¸º netty</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token constant">SERVER_KEY</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_REMOTING_SERVER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é€šè¿‡ SPI æ£€æµ‹æ˜¯å¦å­˜åœ¨ server å‚æ•°æ‰€ä»£è¡¨çš„ Transporter æ‹“å±•ï¼Œä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">ExtensionLoader</span><span class="token punctuation">.</span><span class="token function">getExtensionLoader</span><span class="token punctuation">(</span><span class="token class-name">Transporter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasExtension</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RpcException</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported server type: &quot;</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">&quot;, url: &quot;</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token class-name">ExchangeServer</span> server<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ ¸å¿ƒæ–¹æ³•--åˆ›å»ºæœåŠ¡å™¨ ExchangeServer</span>
        server <span class="token operator">=</span> <span class="token class-name">Exchangers</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> requestHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemotingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RpcException</span><span class="token punctuation">(</span><span class="token string">&quot;Fail to start server(url: &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot;) &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·å– client å‚æ•°ï¼Œå¯æŒ‡å®š nettyï¼Œmina</span>
    str <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token constant">CLIENT_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–æ‰€æœ‰çš„ Transporter å®ç°ç±»åç§°é›†åˆï¼Œæ¯”å¦‚ supportedTypes = [netty, mina]</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> supportedTypes <span class="token operator">=</span> <span class="token class-name">ExtensionLoader</span><span class="token punctuation">.</span><span class="token function">getExtensionLoader</span><span class="token punctuation">(</span><span class="token class-name">Transporter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSupportedExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ£€æµ‹å½“å‰ Dubbo æ‰€æ”¯æŒçš„ Transporter å®ç°ç±»åç§°åˆ—è¡¨ä¸­ï¼Œ</span>
        <span class="token comment">// æ˜¯å¦åŒ…å« client æ‰€è¡¨ç¤ºçš„ Transporterï¼Œè‹¥ä¸åŒ…å«ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>supportedTypes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RpcException</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported client type: &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DubboProtocolServer</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h5 id="exchangers-bind-url-url-exchangehandler-handler"><a href="#exchangers-bind-url-url-exchangehandler-handler" class="header-anchor">#</a> Exchangers.bindï¼ˆURL url, ExchangeHandler handlerï¼‰</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExchangeServer</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">,</span> <span class="token class-name">ExchangeHandler</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemotingException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;url == null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;handler == null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">addParameterIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">CODEC_KEY</span><span class="token punctuation">,</span> <span class="token string">&quot;exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å– Exchangerï¼Œé»˜è®¤ä¸º HeaderExchangerã€‚</span>
    <span class="token comment">// ç´§æ¥ç€è°ƒç”¨ HeaderExchanger çš„ bind æ–¹æ³•åˆ›å»º ExchangeServer å®ä¾‹</span>
    <span class="token keyword">return</span> <span class="token function">getExchanger</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// HeaderExchanger çš„ bind æ–¹æ³•</span>
<span class="token comment">// åˆ›å»º ExchangeServer å®ä¾‹</span>
<span class="token keyword">public</span> <span class="token class-name">ExchangeServer</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">,</span> <span class="token class-name">ExchangeHandler</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemotingException</span> <span class="token punctuation">{</span>
	<span class="token comment">// åˆ›å»º HeaderExchangeServer å®ä¾‹ï¼Œè¯¥æ–¹æ³•åŒ…å«äº†å¤šä¸ªé€»è¾‘ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</span>
	<span class="token comment">//   1. new HeaderExchangeHandler(handler)</span>
	<span class="token comment">//	 2. new DecodeHandler(new HeaderExchangeHandler(handler))</span>
	<span class="token comment">//   3. Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler)))</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HeaderExchangeServer</span><span class="token punctuation">(</span><span class="token class-name">Transporters</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DecodeHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HeaderExchangeHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//  Transporters çš„ bind æ–¹æ³•</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Server</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">,</span> <span class="token class-name">ChannelHandler</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> handlers<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemotingException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;url == null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> handlers<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;handlers == null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">ChannelHandler</span> handler<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        handler <span class="token operator">=</span> handlers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    	<span class="token comment">// å¦‚æœ handlers å…ƒç´ æ•°é‡å¤§äº1ï¼Œåˆ™åˆ›å»º ChannelHandler åˆ†å‘å™¨</span>
        handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChannelHandlerDispatcher</span><span class="token punctuation">(</span>handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·å–è‡ªé€‚åº” Transporter å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ä¾‹æ–¹æ³•</span>
    <span class="token comment">// getTransporter() æ–¹æ³•è·å–çš„ Transporter æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ï¼Œ</span>
    <span class="token comment">// ç±»åä¸º TransporterAdaptive--è‡ªé€‚åº”æ‰©å±•ç±»ï¼Œ</span>
    <span class="token comment">// å®ƒä¼šæ ¹æ®è¿è¡Œæ—¶ä¼ å…¥çš„urlå‚æ•°å†³å®šåŠ è½½ä»€ä¹ˆç±»å‹çš„transporter,é»˜è®¤ä¸ºNettyTransporter</span>
    <span class="token keyword">return</span> <span class="token function">getTransporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// NettyTransporter çš„ bind æ–¹æ³•</span>
<span class="token comment">// è¿˜æœ‰å…¶ä»–çš„æ¯”å¦‚ Netty4 mina Grizzlyçš„</span>
<span class="token keyword">public</span> <span class="token class-name">Server</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">,</span> <span class="token class-name">ChannelHandler</span> listener<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemotingException</span> <span class="token punctuation">{</span>
	<span class="token comment">// åˆ›å»º NettyServer</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>åˆ›å»ºNettyServeråä¼šè°ƒç”¨æ¨¡æ¿ç±»ä¸­çš„ doOpen() å¯åŠ¨æœåŠ¡å™¨ï¼Œè¯¥æ–¹æ³•éœ€è¦å­ç±»å…·ä½“æ¥å®ç°</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">NettyHelper</span><span class="token punctuation">.</span><span class="token function">setNettyLoggerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> boss <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NamedThreadFactory</span><span class="token punctuation">(</span><span class="token string">&quot;NettyServerBoss&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> worker <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NamedThreadFactory</span><span class="token punctuation">(</span><span class="token string">&quot;NettyServerWorker&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ChannelFactory</span> channelFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioServerSocketChannelFactory</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPositiveParameter</span><span class="token punctuation">(</span><span class="token constant">IO_THREADS_KEY</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_IO_THREADS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span>channelFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">NettyHandler</span> nettyHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyHandler</span><span class="token punctuation">(</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channels <span class="token operator">=</span> nettyHandler<span class="token punctuation">.</span><span class="token function">getChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// https://issues.jboss.org/browse/NETTY-365</span>
        <span class="token comment">// https://issues.jboss.org/browse/NETTY-379</span>
        <span class="token comment">// final Timer timer = new HashedWheelTimer(new NamedThreadFactory(&quot;NettyIdleTimer&quot;, true));</span>
        bootstrap<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token string">&quot;child.tcpNoDelay&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bootstrap<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token string">&quot;backlog&quot;</span><span class="token punctuation">,</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPositiveParameter</span><span class="token punctuation">(</span><span class="token constant">BACKLOG_KEY</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_BACKLOG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bootstrap<span class="token punctuation">.</span><span class="token function">setPipelineFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelPipelineFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ChannelPipeline</span> <span class="token function">getPipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">NettyCodecAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyCodecAdapter</span><span class="token punctuation">(</span><span class="token function">getCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">NettyServer</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> <span class="token class-name">Channels</span><span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">/*int idleTimeout = getIdleTimeout();
                if (idleTimeout &gt; 10000) {
                    pipeline.addLast(&quot;timer&quot;, new IdleStateHandler(timer, idleTimeout / 1000, 0, 0));
                }*/</span>
                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;decoder&quot;</span><span class="token punctuation">,</span> adapter<span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;encoder&quot;</span><span class="token punctuation">,</span> adapter<span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;handler&quot;</span><span class="token punctuation">,</span> nettyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> pipeline<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// bind</span>
        channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">getBindAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>æœåŠ¡å¯¼å‡ºçš„è¿‡ç¨‹åˆ°è¿™é‡Œåˆ†æå°±ç»“æŸäº†</p> <h4 id="_2-3-2-æœåŠ¡æ³¨å†Œ"><a href="#_2-3-2-æœåŠ¡æ³¨å†Œ" class="header-anchor">#</a> 2.3.2 æœåŠ¡æ³¨å†Œ</h4> <div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>æœåŠ¡æ³¨å†Œçš„è¿‡ç¨‹ç›¸å¯¹äºdubboæ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œé€šè¿‡æœåŠ¡ç›´è¿çš„æ–¹å¼å°±å¯ä»¥ç»•è¿‡æ³¨å†Œä¸­å¿ƒã€‚ä½†é€šå¸¸æˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆåšï¼Œç›´è¿æ–¹å¼ä¸åˆ©äºæœåŠ¡æ²»ç†ï¼Œä»…åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œæ³¨å†Œä¸­å¿ƒå¯¹äºDubboæ¥è¯´è™½ç„¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†ç¡®å®å¿…è¦çš„ï¼Œä¸‹é¢ä¸»è¦å°†zkä½œä¸ºåˆ†æç›®æ ‡ã€‚
æœåŠ¡æ³¨å†Œçš„å…¥å£æ–¹æ³•è¿˜åœ¨<code>RegistryProtocol çš„ export()</code> ä¸Šï¼Œå¦‚ä¸‹ï¼š</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Exporter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Invoker</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> originInvoker<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RpcException</span> <span class="token punctuation">{</span>
    <span class="token comment">// ${çœç•¥å¯¼å‡ºæœåŠ¡}</span>
   
    <span class="token comment">// çœç•¥å…¶ä»–ä»£ç </span>
    <span class="token keyword">final</span> <span class="token class-name">URL</span> overrideSubscribeUrl <span class="token operator">=</span> <span class="token function">getSubscribedOverrideUrl</span><span class="token punctuation">(</span>providerUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">OverrideListener</span> overrideSubscribeListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OverrideListener</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">,</span> originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    overrideListeners<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">,</span> overrideSubscribeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>

    providerUrl <span class="token operator">=</span> <span class="token function">overrideUrlWithConfig</span><span class="token punctuation">(</span>providerUrl<span class="token punctuation">,</span> overrideSubscribeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//export invoker</span>
    <span class="token keyword">final</span> <span class="token class-name">ExporterChangeableWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> exporter <span class="token operator">=</span> <span class="token function">doLocalExport</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">,</span> providerUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// url to registry</span>
    <span class="token keyword">final</span> <span class="token class-name">Registry</span> registry <span class="token operator">=</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">URL</span> registeredProviderUrl <span class="token operator">=</span> <span class="token function">getUrlToRegistry</span><span class="token punctuation">(</span>providerUrl<span class="token punctuation">,</span> registryUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> register <span class="token operator">=</span> registeredProviderUrl<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>register<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ³¨å†ŒæœåŠ¡</span>
        <span class="token function">register</span><span class="token punctuation">(</span>registryUrl<span class="token punctuation">,</span> registeredProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProviderConsumerRegTable</span><span class="token punctuation">.</span><span class="token function">getProviderWrapper</span><span class="token punctuation">(</span>originInvoker<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReg</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// register stated url on provider model</span>
    <span class="token function">registerStatedUrl</span><span class="token punctuation">(</span>registryUrl<span class="token punctuation">,</span> registeredProviderUrl<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">;</span>

    exporter<span class="token punctuation">.</span><span class="token function">setRegisterUrl</span><span class="token punctuation">(</span>registeredProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    exporter<span class="token punctuation">.</span><span class="token function">setSubscribeUrl</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¢é˜… override æ•°æ®</span>
    registry<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>overrideSubscribeUrl<span class="token punctuation">,</span> overrideSubscribeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>RegistryProtocolçš„export()æ–¹æ³•åŒ…å«äº†æœåŠ¡å¯¼å‡ºï¼Œæ³¨å†Œï¼Œä»¥åŠæ•°æ®è®¢é˜…ç­‰é€»è¾‘ã€‚å…¶ä¸­æœåŠ¡å¯¼å‡ºä¸Šé¢å·²ç»åˆ†æè¿‡äº†ï¼Œè¿™é‡Œä¸»è¦åˆ†ææ³¨å†Œçš„é€»è¾‘ï¼Œå…¥å£æ–¹æ³•æ˜¯<code>register()</code>;</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">URL</span> registryUrl<span class="token punctuation">,</span> <span class="token class-name">URL</span> registedProviderUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å– Registryå®ä¾‹</span>
    <span class="token class-name">Registry</span> registry <span class="token operator">=</span> registryFactory<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span>registryUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡</span>
    registry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>registedProviderUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_2-3-2-1-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ"><a href="#_2-3-2-1-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ" class="header-anchor">#</a> 2.3.2.1 åˆ›å»ºæ³¨å†Œä¸­å¿ƒ</h5> <p>Dubboæ”¯æŒçš„æ³¨å†Œä¸­å¿ƒæœ‰zk,Nacos,Redis,Multicastï¼ŒSimpleç­‰ï¼Œç›®å‰å®˜æ–¹è¾ƒä¸ºæ¨èçš„æ˜¯zk,è¿™é‡Œä»¥zkä¸ºä¾‹è¿›è¡Œåˆ†æï¼Œ æŠ½è±¡ç±»AbstractRegistryFactory ä¸­æä¾›äº†getRegistryæ–¹æ³•ï¼Œå„ä¸ªå­ç±»å¯ä»¥å¯¹å…¶å®ç°ï¼Œä¸»è¦å…³æ³¨zkçš„å®ç°ã€‚
<code>AbstractRegistryFactory.getRegistry</code>æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Registry</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    url <span class="token operator">=</span> <span class="token class-name">URLBuilder</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token class-name">RegistryService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addParameter</span><span class="token punctuation">(</span><span class="token constant">INTERFACE_KEY</span><span class="token punctuation">,</span> <span class="token class-name">RegistryService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">removeParameters</span><span class="token punctuation">(</span><span class="token constant">EXPORT_KEY</span><span class="token punctuation">,</span> <span class="token constant">REFER_KEY</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token function">createRegistryCacheKey</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">LOCK</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
    	<span class="token comment">// è®¿é—®ç¼“å­˜</span>
        <span class="token class-name">Registry</span> registry <span class="token operator">=</span> <span class="token constant">REGISTRIES</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>registry <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> registry<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ›å»º Registry å®ä¾‹</span>
        registry <span class="token operator">=</span> <span class="token function">createRegistry</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>registry <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Can not create registry &quot;</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// å†™å…¥ç¼“å­˜</span>
        <span class="token constant">REGISTRIES</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registry<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token constant">LOCK</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">Registry</span> <span class="token function">createRegistry</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>getRegistryæ–¹æ³•å…ˆè®¿é—®ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­åˆ™è°ƒç”¨creteRegistryåˆ›å»ºRegistry,ç„¶åå†™å…¥ç¼“å­˜ï¼ŒcreateRegistryæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œç”±å…·ä½“çš„å­ç±»å®ç°ï¼Œä¸‹é¢æ­£å¼è¿›å…¥<code>ZookeeperRegistryFactory</code>çš„å®ç°</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZookeeperRegistryFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRegistryFactory</span> <span class="token punctuation">{</span>

    <span class="token comment">// zookeeperTransporter ç”± SPI åœ¨è¿è¡Œæ—¶æ³¨å…¥ï¼Œç±»å‹ä¸º ZookeeperTransporter$Adaptive</span>
    <span class="token keyword">private</span> <span class="token class-name">ZookeeperTransporter</span> zookeeperTransporter<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setZookeeperTransporter</span><span class="token punctuation">(</span><span class="token class-name">ZookeeperTransporter</span> zookeeperTransporter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>zookeeperTransporter <span class="token operator">=</span> zookeeperTransporter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Registry</span> <span class="token function">createRegistry</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»º ZookeeperRegistry</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ZookeeperRegistry</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> zookeeperTransporter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å®ä¾‹åŒ–ä¸€ä¸ªZookeeperRegistryï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ZookeeperRegistry</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">,</span> <span class="token class-name">ZookeeperTransporter</span> zookeeperTransporter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">isAnyHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;registry address == null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–ç»„åï¼Œé»˜è®¤ä¸º dubbo</span>
    <span class="token class-name">String</span> group <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token constant">GROUP_KEY</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_ROOT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>group<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">PATH_SEPARATOR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// group = &quot;/&quot; + group</span>
        group <span class="token operator">=</span> <span class="token constant">PATH_SEPARATOR</span> <span class="token operator">+</span> group<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> group<span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»º Zookeeper å®¢æˆ·ç«¯ï¼Œé»˜è®¤ä¸º CuratorZookeeperTransporter</span>
    <span class="token comment">// connectæ–¹æ³•åˆ›å»ºzkclientçš„å®¢æˆ·ç«¯ è¿™é‡Œéœ€è¦é‡ç‚¹å…³æ³¨</span>
    zkClient <span class="token operator">=</span> zookeeperTransporter<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ·»åŠ çŠ¶æ€ç›‘å¬å™¨ StateListeneræ¥å£å®ç°ç±»</span>
    zkClient<span class="token punctuation">.</span><span class="token function">addStateListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">StateListener</span><span class="token punctuation">.</span><span class="token constant">RECONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// çœç•¥æ—¥å¿—æ‰“å°</span>
                <span class="token class-name">ZookeeperRegistry</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchLatestAddresses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">StateListener</span><span class="token punctuation">.</span><span class="token constant">NEW_SESSION_CREATED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// çœç•¥æ—¥å¿—æ‰“å°</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ZookeeperRegistry</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">StateListener</span><span class="token punctuation">.</span><span class="token constant">SESSION_LOST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// çœç•¥æ—¥å¿—æ‰“å°</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">StateListener</span><span class="token punctuation">.</span><span class="token constant">SUSPENDED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">StateListener</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>zookeeperTransporterç±»å‹ä¸ºè‡ªé€‚åº”æ‰©å±•ç±»ï¼Œå› æ­¤connectæ–¹æ³•ä¼šå†è¢«è°ƒç”¨æ—¶å†³å®šåŠ è½½ä»€ä¹ˆç±»å‹çš„zookeeperTransporteræ‰©å±•ï¼Œé»˜è®¤ä¸º<code>CuratorZookeeperTransporter</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CuratorZookeeperTransporter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractZookeeperTransporter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ZookeeperClient</span> <span class="token function">createZookeeperClient</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CuratorZookeeperClient</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CuratorZookeeperClient</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractZookeeperClient</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CuratorWatcher</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>
    
    <span class="token comment">//CuratorZookeeperClientæ„é€ æ–¹æ³•ç”¨äºåˆ›å»ºå’Œå¯åŠ¨CuratorFramework å®ä¾‹</span>
    <span class="token keyword">public</span> <span class="token class-name">CuratorZookeeperClient</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> timeout <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token constant">TIMEOUT_KEY</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_CONNECTION_TIMEOUT_MS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> sessionExpireMs <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token constant">ZK_SESSION_EXPIRE_KEY</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_SESSION_TIMEOUT_MS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ›å»º CuratorFramework æ„é€ å™¨</span>
            <span class="token class-name">CuratorFrameworkFactory<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getBackupAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryNTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">connectionTimeoutMs</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span>sessionExpireMs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> authority <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getAuthority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>authority <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> authority<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                builder <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">authorization</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span> authority<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// æ„å»º CuratorFramework å®ä¾‹</span>
            client <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ·»åŠ ç›‘å¬å™¨</span>
            client<span class="token punctuation">.</span><span class="token function">getConnectionStateListenable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CuratorConnectionStateListener</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¯åŠ¨å®¢æˆ·ç«¯</span>
            client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> connected <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">blockUntilConnected</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;zookeeper not connected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h5 id="_2-3-2-2-èŠ‚ç‚¹åˆ›å»º"><a href="#_2-3-2-2-èŠ‚ç‚¹åˆ›å»º" class="header-anchor">#</a> 2.3.2.2 èŠ‚ç‚¹åˆ›å»º</h5> <p>ä»¥Zookeeperä¸ºä¾‹ï¼ŒæœåŠ¡æ³¨å†Œçš„æœ¬è´¨æ˜¯å°†æœåŠ¡é…ç½®æ•°æ®å†™å…¥åˆ°zkæŸä¸ªè·¯å¾„çš„èŠ‚ç‚¹ä¸‹ã€‚å¯ä»¥é€šè¿‡zkçš„å¯è§†åŒ–å®¢æˆ·ç«¯ZooInsepectoræŸ¥çœ‹èŠ‚ç‚¹æ•°æ®
<img src="https://images.zaiolos.top/images/202208011605139.png" alt="image.png"></p> <div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>DemoServiceæœåŠ¡å¯¹åº”çš„é…ç½®ä¿¡æ¯ï¼ˆå­˜å‚¨åœ¨URLä¸­ï¼‰æœ€ç»ˆè¢«æ³¨å†Œåˆ°providersèŠ‚ç‚¹ä¸‹ï¼Œå¦‚æœå¤šå°æœºå™¨ä¸Šéƒ½éƒ¨ç½²äº†è¿™ä¸ªæœåŠ¡ï¼Œå½“å‰è¿™ä¸ªprovidersä¸‹é¢å°±ä¼šæœ‰å¤šä¸ªurlï¼›</p></div> <p>ä¸‹é¢åˆ†ææ³¨å†Œçš„è¿‡ç¨‹ï¼š
æœåŠ¡æ³¨å†Œçš„æ¥å£ä¸ºregister(URL), è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨FailbackRegistryæŠ½è±¡ç±»ä¸­</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ ¡éªŒURLæ˜¯å¦æ»¡è¶³è¦æ±‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">acceptable</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;URL &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot; will not be registered to Registry. Registry &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot; does not accept service of this protocol type.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">removeFailedRegistered</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">removeFailedUnregistered</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// è°ƒç”¨æ¨¡æ¿æ–¹æ³•ï¼Œç”±å­ç±»å®ç°</span>
        <span class="token function">doRegister</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Throwable</span> t <span class="token operator">=</span> e<span class="token punctuation">;</span>

        <span class="token comment">// è·å– check å‚æ•°ï¼Œè‹¥ check = true å°†ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token keyword">boolean</span> check <span class="token operator">=</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">CHECK_KEY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">CHECK_KEY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">CONSUMER_PROTOCOL</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> skipFailback <span class="token operator">=</span> t <span class="token keyword">instanceof</span> <span class="token class-name">SkipFailbackWrapperException</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>check <span class="token operator">||</span> skipFailback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>skipFailback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                t <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to register &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot; to registry &quot;</span> <span class="token operator">+</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, cause: &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to register &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot;, waiting for retry, cause: &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è®°å½•æ³¨å†Œå¤±è´¥çš„é“¾æ¥</span>
        <span class="token function">addFailedRegistered</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å®ç°ï¼Œé‡ç‚¹å…³æ³¨ FailbackRegistry å­ç±» ZookeeperRegistry çš„å®ç°</span>
<span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>ZookeeperRegistry.doRegister()</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token class-name">URL</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// é€šè¿‡ Zookeeper å®¢æˆ·ç«¯åˆ›å»ºèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è·¯å¾„ç”± toUrlPath æ–¹æ³•ç”Ÿæˆï¼Œè·¯å¾„æ ¼å¼å¦‚ä¸‹:</span>
        <span class="token comment">//   /${group}/${serviceInterface}/providers/${url}</span>
        <span class="token comment">// æ¯”å¦‚</span>
        <span class="token comment">//   /dubbo/org.apache.dubbo.DemoService/providers/dubbo%3A%2F%2F127.0.0.1......</span>
        zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token function">toUrlPath</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token constant">DYNAMIC_KEY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RpcException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to register &quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot; to zookeeper &quot;</span> <span class="token operator">+</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>æœåŠ¡æ³¨å†Œåˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ç®€å•æ€»ç»“ä¸º: å…ˆåˆ›å»ºæ³¨å†Œä¸­å¿ƒå®ä¾‹ï¼Œç„¶ååœ¨é€šè¿‡æ³¨å†Œä¸­å¿ƒå®ä¾‹æ³¨å†ŒæœåŠ¡ã€‚</p> <h2 id="_3-æ—¶åºå›¾æ¢³ç†"><a href="#_3-æ—¶åºå›¾æ¢³ç†" class="header-anchor">#</a> 3. æ—¶åºå›¾æ¢³ç†</h2> <p><img src="https://images.zaiolos.top/images/202208011605345.png" alt="image.png"></p> <h2 id="_4-ä¸»è¦æµç¨‹"><a href="#_4-ä¸»è¦æµç¨‹" class="header-anchor">#</a> 4. ä¸»è¦æµç¨‹</h2> <p><img src="https://images.zaiolos.top/images/202208011605476.png" alt="image.png"></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hnistzdk/my-notes/edit/master/docs/04.æ¡†æ¶/21.Dubbo/03.æœåŠ¡æ³¨å†Œ(provideræœåŠ¡æš´éœ²).md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/my-notes/tags/?tag=Dubbo" title="æ ‡ç­¾">#Dubbo</a><a href="/my-notes/tags/?tag=%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2" title="æ ‡ç­¾">#æœåŠ¡æš´éœ²</a></div> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°:</span> <span class="time">2022/10/04, 8:10:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/my-notes/dubbo/Dubbo/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Dubbo</div></a> <a href="/my-notes/Dubbo/serviceDiscovery/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">æœåŠ¡å‘ç°(consumeræœåŠ¡å¼•å…¥)</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/my-notes/dubbo/Dubbo/" class="prev">Dubbo</a></span> <span class="next"><a href="/my-notes/Dubbo/serviceDiscovery/">æœåŠ¡å‘ç°(consumeræœåŠ¡å¼•å…¥)</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:369365576@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-gitee"></a><a href="http://music.163.com/playlist?id=936642760&amp;userid=604011130" title="æ™®é€šæ­Œå•" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2023
    <span>zdk | notes <br><a href=http://beian.miit.gov.cn/>æ¹˜ICPå¤‡2022001117å·-1</a><br><img src=/img/ghs.png /><a href=http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51142102511562>å·å…¬ç½‘å®‰å¤‡ 51142102511562å·</a><br><a href=https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referra><img src=/img/upyun.png align=absmiddle width=70px height=30px /></a> <span> æä¾›åŠ é€ŸæœåŠ¡ </span></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div id="goTop" class="hide-cat" data-v-bf92849a></div><div></div><div></div></div></div>
    <script src="/my-notes/assets/js/app.7f931ee0.js" defer></script><script src="/my-notes/assets/js/2.e52a17f8.js" defer></script><script src="/my-notes/assets/js/121.d3137f51.js" defer></script><script src="/my-notes/assets/js/6.bcc16901.js" defer></script>
  </body>
</html>
