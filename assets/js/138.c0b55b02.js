(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{484:function(t,a,s){"use strict";s.r(a);var n=s(1),r=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("strong",[t._v("Table of Contents")]),t._v(" "),a("em",[t._v("generated with "),a("a",{attrs:{href:"https://github.com/thlorenz/doctoc",target:"_blank",rel:"noopener noreferrer"}},[t._v("DocToc"),a("OutboundLink")],1)])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#sleuth"}},[t._v("Sleuth")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E6%A6%82%E8%BF%B0"}},[t._v("概述")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E9%97%AE%E9%A2%98"}},[t._v("问题")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%98%AF%E4%BB%80%E4%B9%88"}},[t._v("是什么")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%AE%89%E8%A3%85"}},[t._v("安装")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%8B%E8%BD%BD%E8%BF%90%E8%A1%8Czipkin"}},[t._v("下载运行zipkin")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#zipkin%E7%9B%91%E6%8E%A7%E7%95%8C%E9%9D%A2"}},[t._v("zipkin监控界面")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"}},[t._v("名词解释")])])])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E8%B0%83%E7%94%A8%E6%B5%8B%E8%AF%95"}},[t._v("调用测试")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"}},[t._v("引入依赖")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%A4%E4%B8%AA%E9%A1%B9%E7%9B%AE%E9%83%BD%E5%A2%9E%E5%8A%A0yaml%E9%85%8D%E7%BD%AE"}},[t._v("两个项目都增加yaml配置")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#8001controller%E6%96%B0%E5%A2%9E%E6%96%B9%E6%B3%95"}},[t._v("8001controller新增方法")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#80controller%E6%96%B0%E5%A2%9E"}},[t._v("80Controller新增")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%B5%8B%E8%AF%95"}},[t._v("测试")])])])])])])]),t._v(" "),a("hr"),t._v(" "),a("h1",{attrs:{id:"sleuth"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sleuth"}},[t._v("#")]),t._v(" Sleuth")]),t._v(" "),a("blockquote",[a("p",[t._v("分布式请求链路跟踪")])]),t._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("h3",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),a("blockquote",[a("p",[t._v("在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节点调用来协同产生最后的请求结果，每一个前段请求都会形成一条复杂的分布式服务调用链路，链路中的任何一环出现高延时或错误都会引起整个请求最后的失败。")])]),t._v(" "),a("h3",{attrs:{id:"是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[t._v("#")]),t._v(" 是什么")]),t._v(" "),a("ul",[a("li",[t._v("SpringCloud Sleuth提供了一套完整的服务跟踪的解决方案")]),t._v(" "),a("li",[t._v("在分布式系统中提供追踪解决方案并且兼容支持的zipkin")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151556350.png",alt:"image-20221115155625267"}})]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("blockquote",[a("p",[t._v("SpringCloud从F版起已不需要自己构建zipkin Server了，只需要调用jar包即可")])]),t._v(" "),a("h3",{attrs:{id:"下载运行zipkin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载运行zipkin"}},[t._v("#")]),t._v(" 下载运行zipkin")]),t._v(" "),a("p",[t._v("jar包下载地址：https://cloud.zaiolos.top/s/dmsO")]),t._v(" "),a("p",[t._v("运行命令：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" zipkin-server-2.23.16-exec.jar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("出现以下结果表示成功")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151604445.png",alt:"image-20221115160429362"}})]),t._v(" "),a("p",[t._v("访问http://127.0.0.1:9411/zipkin/即可")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151605937.png",alt:"image-20221115160507855"}})]),t._v(" "),a("h4",{attrs:{id:"zipkin监控界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zipkin监控界面"}},[t._v("#")]),t._v(" zipkin监控界面")]),t._v(" "),a("p",[a("strong",[t._v("一条链路完整图片")]),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151610122.png",alt:"image-20221115161022031"}})]),t._v(" "),a("p",[a("strong",[t._v("精简版：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151610813.png",alt:"image-20221115161036742"}})]),t._v(" "),a("p",[a("strong",[t._v("可以看到,类似链表的形式")])]),t._v(" "),a("h4",{attrs:{id:"名词解释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#名词解释"}},[t._v("#")]),t._v(" 名词解释")]),t._v(" "),a("ul",[a("li",[t._v("Trace：类似于树结构的Span集合，表示一条调用链路，存在唯一标识")]),t._v(" "),a("li",[t._v("span：表示调用链路来源，通俗的理解span就是一次请求信息")])]),t._v(" "),a("h2",{attrs:{id:"调用测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用测试"}},[t._v("#")]),t._v(" 调用测试")]),t._v(" "),a("blockquote",[a("p",[t._v("这里为了简单，就用原来最普通的8001和order80微服务来进行调用测试")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151617922.png",alt:"image-20221115161714879"}})]),t._v(" "),a("h3",{attrs:{id:"引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入依赖"}},[t._v("#")]),t._v(" 引入依赖")]),t._v(" "),a("blockquote",[a("p",[t._v("首先为两个项目都引入以下依赖")])]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 包含了sleuth+zipkin--\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-zipkin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.2.8.RELEASE"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"两个项目都增加yaml配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两个项目都增加yaml配置"}},[t._v("#")]),t._v(" 两个项目都增加yaml配置")]),t._v(" "),a("p",[t._v("即在spring下增加zipkin和sleuth的配置")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("payment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zipkin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("base-url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9411")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sleuth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sampler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采样率值介于0~1之间，1则表示全部采集")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("probability")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("      \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h3",{attrs:{id:"_8001controller新增方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8001controller新增方法"}},[t._v("#")]),t._v(" 8001controller新增方法")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/payment/zipkin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentZipkin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"this is payment zipkin server fallback~~~~~"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h3",{attrs:{id:"_80controller新增"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_80controller新增"}},[t._v("#")]),t._v(" 80Controller新增")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/consumer/payment/zipkin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentZipkin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" restTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getForObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PAYMENT_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/payment/zipkin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h3",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),a("p",[t._v("调用多次http://localhost/consumer/payment/zipkin，")]),t._v(" "),a("p",[t._v("再进入zipkin控制台http://127.0.0.1:9411/zipkin/，即可发现出现了调用信息")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151634394.png",alt:"image-20221115163403276"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://images.zaiolos.top/images/202211151635531.png",alt:"image-20221115163553418"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);