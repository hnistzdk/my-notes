<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis 全笔记 | DK&#39;s Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/my-notes/img/logo.jpg">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334691_b03dsaqrwck.css">
    <meta name="description" content="时不我待，舍我其谁">
    <meta name="keywords" content="Java">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/my-notes/assets/css/0.styles.565c6041.css" as="style"><link rel="preload" href="/my-notes/assets/js/app.7f931ee0.js" as="script"><link rel="preload" href="/my-notes/assets/js/2.e52a17f8.js" as="script"><link rel="preload" href="/my-notes/assets/js/77.61eb4f51.js" as="script"><link rel="preload" href="/my-notes/assets/js/8.c2fa6f68.js" as="script"><link rel="preload" href="/my-notes/assets/js/6.bcc16901.js" as="script"><link rel="prefetch" href="/my-notes/assets/js/10.fee8f7ec.js"><link rel="prefetch" href="/my-notes/assets/js/100.9be19fac.js"><link rel="prefetch" href="/my-notes/assets/js/101.9aaae740.js"><link rel="prefetch" href="/my-notes/assets/js/102.a72c0165.js"><link rel="prefetch" href="/my-notes/assets/js/103.d47527c3.js"><link rel="prefetch" href="/my-notes/assets/js/104.d5bae560.js"><link rel="prefetch" href="/my-notes/assets/js/105.fdb07f67.js"><link rel="prefetch" href="/my-notes/assets/js/106.b89b7d37.js"><link rel="prefetch" href="/my-notes/assets/js/107.a9d142eb.js"><link rel="prefetch" href="/my-notes/assets/js/108.1b8c8817.js"><link rel="prefetch" href="/my-notes/assets/js/109.0cd465a0.js"><link rel="prefetch" href="/my-notes/assets/js/11.75b40e53.js"><link rel="prefetch" href="/my-notes/assets/js/110.4c56723c.js"><link rel="prefetch" href="/my-notes/assets/js/111.12b9cb85.js"><link rel="prefetch" href="/my-notes/assets/js/112.3f791546.js"><link rel="prefetch" href="/my-notes/assets/js/113.d9998b70.js"><link rel="prefetch" href="/my-notes/assets/js/114.faf0da70.js"><link rel="prefetch" href="/my-notes/assets/js/115.35d9b5f6.js"><link rel="prefetch" href="/my-notes/assets/js/116.13fbe1ab.js"><link rel="prefetch" href="/my-notes/assets/js/117.bffe4459.js"><link rel="prefetch" href="/my-notes/assets/js/118.eabefad3.js"><link rel="prefetch" href="/my-notes/assets/js/119.8593c8a5.js"><link rel="prefetch" href="/my-notes/assets/js/12.34db197a.js"><link rel="prefetch" href="/my-notes/assets/js/120.f5b73620.js"><link rel="prefetch" href="/my-notes/assets/js/121.d3137f51.js"><link rel="prefetch" href="/my-notes/assets/js/122.f47bca90.js"><link rel="prefetch" href="/my-notes/assets/js/123.6d846b88.js"><link rel="prefetch" href="/my-notes/assets/js/124.49825ebc.js"><link rel="prefetch" href="/my-notes/assets/js/125.6d3a9ce5.js"><link rel="prefetch" href="/my-notes/assets/js/126.eeef761b.js"><link rel="prefetch" href="/my-notes/assets/js/127.0f7e28c1.js"><link rel="prefetch" href="/my-notes/assets/js/128.4a35f42a.js"><link rel="prefetch" href="/my-notes/assets/js/129.e364bc33.js"><link rel="prefetch" href="/my-notes/assets/js/13.ab02aa59.js"><link rel="prefetch" href="/my-notes/assets/js/130.1299fc06.js"><link rel="prefetch" href="/my-notes/assets/js/131.61faa498.js"><link rel="prefetch" href="/my-notes/assets/js/132.9e46a3c4.js"><link rel="prefetch" href="/my-notes/assets/js/133.0b6e6f7f.js"><link rel="prefetch" href="/my-notes/assets/js/134.6724b7a7.js"><link rel="prefetch" href="/my-notes/assets/js/135.1d3daca0.js"><link rel="prefetch" href="/my-notes/assets/js/136.190f2a28.js"><link rel="prefetch" href="/my-notes/assets/js/137.5ce96397.js"><link rel="prefetch" href="/my-notes/assets/js/138.c0b55b02.js"><link rel="prefetch" href="/my-notes/assets/js/139.068ed7d7.js"><link rel="prefetch" href="/my-notes/assets/js/14.721e1994.js"><link rel="prefetch" href="/my-notes/assets/js/140.5226be4f.js"><link rel="prefetch" href="/my-notes/assets/js/141.196d1aa6.js"><link rel="prefetch" href="/my-notes/assets/js/142.11cbb52f.js"><link rel="prefetch" href="/my-notes/assets/js/143.509f8300.js"><link rel="prefetch" href="/my-notes/assets/js/144.436415bf.js"><link rel="prefetch" href="/my-notes/assets/js/145.a25cd8bc.js"><link rel="prefetch" href="/my-notes/assets/js/146.a2d1d780.js"><link rel="prefetch" href="/my-notes/assets/js/147.1cac4e0a.js"><link rel="prefetch" href="/my-notes/assets/js/148.5c361eba.js"><link rel="prefetch" href="/my-notes/assets/js/149.f62eacfa.js"><link rel="prefetch" href="/my-notes/assets/js/15.35ef567c.js"><link rel="prefetch" href="/my-notes/assets/js/150.80b0aa20.js"><link rel="prefetch" href="/my-notes/assets/js/151.6f0e31d8.js"><link rel="prefetch" href="/my-notes/assets/js/152.86efa86d.js"><link rel="prefetch" href="/my-notes/assets/js/153.d6605e26.js"><link rel="prefetch" href="/my-notes/assets/js/154.e5b33cc7.js"><link rel="prefetch" href="/my-notes/assets/js/155.5d3cf278.js"><link rel="prefetch" href="/my-notes/assets/js/156.bcb9784f.js"><link rel="prefetch" href="/my-notes/assets/js/157.ca3b8e8c.js"><link rel="prefetch" href="/my-notes/assets/js/158.eb0116b8.js"><link rel="prefetch" href="/my-notes/assets/js/159.309a26da.js"><link rel="prefetch" href="/my-notes/assets/js/16.ca698d39.js"><link rel="prefetch" href="/my-notes/assets/js/160.ce6e9321.js"><link rel="prefetch" href="/my-notes/assets/js/161.ac24f13a.js"><link rel="prefetch" href="/my-notes/assets/js/162.c3390211.js"><link rel="prefetch" href="/my-notes/assets/js/163.8267154f.js"><link rel="prefetch" href="/my-notes/assets/js/164.3ce822f9.js"><link rel="prefetch" href="/my-notes/assets/js/165.80836bd1.js"><link rel="prefetch" href="/my-notes/assets/js/166.7346e59a.js"><link rel="prefetch" href="/my-notes/assets/js/167.5577b6af.js"><link rel="prefetch" href="/my-notes/assets/js/168.23aca72c.js"><link rel="prefetch" href="/my-notes/assets/js/169.ce891665.js"><link rel="prefetch" href="/my-notes/assets/js/17.549cfc80.js"><link rel="prefetch" href="/my-notes/assets/js/170.b4aebdaf.js"><link rel="prefetch" href="/my-notes/assets/js/171.39cdd90b.js"><link rel="prefetch" href="/my-notes/assets/js/172.06cd5671.js"><link rel="prefetch" href="/my-notes/assets/js/173.44c7c161.js"><link rel="prefetch" href="/my-notes/assets/js/174.62d8a34f.js"><link rel="prefetch" href="/my-notes/assets/js/175.baa645ac.js"><link rel="prefetch" href="/my-notes/assets/js/176.8361f852.js"><link rel="prefetch" href="/my-notes/assets/js/177.4a8f2fec.js"><link rel="prefetch" href="/my-notes/assets/js/178.f594def6.js"><link rel="prefetch" href="/my-notes/assets/js/179.2338f129.js"><link rel="prefetch" href="/my-notes/assets/js/18.a8b4f826.js"><link rel="prefetch" href="/my-notes/assets/js/180.1b2f62df.js"><link rel="prefetch" href="/my-notes/assets/js/181.10759f41.js"><link rel="prefetch" href="/my-notes/assets/js/182.c0e1c3c5.js"><link rel="prefetch" href="/my-notes/assets/js/183.bdc8283f.js"><link rel="prefetch" href="/my-notes/assets/js/184.30a6f685.js"><link rel="prefetch" href="/my-notes/assets/js/185.1949079b.js"><link rel="prefetch" href="/my-notes/assets/js/186.bb7c7093.js"><link rel="prefetch" href="/my-notes/assets/js/187.1d02d132.js"><link rel="prefetch" href="/my-notes/assets/js/188.5230fbeb.js"><link rel="prefetch" href="/my-notes/assets/js/189.2931d469.js"><link rel="prefetch" href="/my-notes/assets/js/19.16e1a44c.js"><link rel="prefetch" href="/my-notes/assets/js/190.9bd3b616.js"><link rel="prefetch" href="/my-notes/assets/js/191.d75de9d3.js"><link rel="prefetch" href="/my-notes/assets/js/192.dacb160e.js"><link rel="prefetch" href="/my-notes/assets/js/193.660b4fce.js"><link rel="prefetch" href="/my-notes/assets/js/194.45f8499e.js"><link rel="prefetch" href="/my-notes/assets/js/195.e91d4663.js"><link rel="prefetch" href="/my-notes/assets/js/196.e94176ac.js"><link rel="prefetch" href="/my-notes/assets/js/197.5acbb43f.js"><link rel="prefetch" href="/my-notes/assets/js/198.dc1a1207.js"><link rel="prefetch" href="/my-notes/assets/js/199.288adcec.js"><link rel="prefetch" href="/my-notes/assets/js/20.b19ef4b2.js"><link rel="prefetch" href="/my-notes/assets/js/200.3d318d2e.js"><link rel="prefetch" href="/my-notes/assets/js/21.e3682738.js"><link rel="prefetch" href="/my-notes/assets/js/22.fafa8b54.js"><link rel="prefetch" href="/my-notes/assets/js/23.9d683b40.js"><link rel="prefetch" href="/my-notes/assets/js/24.02c0c08c.js"><link rel="prefetch" href="/my-notes/assets/js/25.af427f02.js"><link rel="prefetch" href="/my-notes/assets/js/26.50a41828.js"><link rel="prefetch" href="/my-notes/assets/js/27.8f1d2fe6.js"><link rel="prefetch" href="/my-notes/assets/js/28.7f820229.js"><link rel="prefetch" href="/my-notes/assets/js/29.208cdce3.js"><link rel="prefetch" href="/my-notes/assets/js/3.32ea0d41.js"><link rel="prefetch" href="/my-notes/assets/js/30.e7a171d3.js"><link rel="prefetch" href="/my-notes/assets/js/31.8ee9f363.js"><link rel="prefetch" href="/my-notes/assets/js/32.b33ae00e.js"><link rel="prefetch" href="/my-notes/assets/js/33.3a961845.js"><link rel="prefetch" href="/my-notes/assets/js/34.46f30eb6.js"><link rel="prefetch" href="/my-notes/assets/js/35.dedda1f7.js"><link rel="prefetch" href="/my-notes/assets/js/36.fb63ded5.js"><link rel="prefetch" href="/my-notes/assets/js/37.321340a9.js"><link rel="prefetch" href="/my-notes/assets/js/38.c21281dd.js"><link rel="prefetch" href="/my-notes/assets/js/39.01776b7e.js"><link rel="prefetch" href="/my-notes/assets/js/4.2466bf2a.js"><link rel="prefetch" href="/my-notes/assets/js/40.c6763f18.js"><link rel="prefetch" href="/my-notes/assets/js/41.afa4c2f3.js"><link rel="prefetch" href="/my-notes/assets/js/42.187357b5.js"><link rel="prefetch" href="/my-notes/assets/js/43.90030eae.js"><link rel="prefetch" href="/my-notes/assets/js/44.e11eff59.js"><link rel="prefetch" href="/my-notes/assets/js/45.760e3e3f.js"><link rel="prefetch" href="/my-notes/assets/js/46.0eccc1a4.js"><link rel="prefetch" href="/my-notes/assets/js/47.30e063f8.js"><link rel="prefetch" href="/my-notes/assets/js/48.5ab681d2.js"><link rel="prefetch" href="/my-notes/assets/js/49.5921c987.js"><link rel="prefetch" href="/my-notes/assets/js/5.56264475.js"><link rel="prefetch" href="/my-notes/assets/js/50.a53fa873.js"><link rel="prefetch" href="/my-notes/assets/js/51.5cded08c.js"><link rel="prefetch" href="/my-notes/assets/js/52.8960c473.js"><link rel="prefetch" href="/my-notes/assets/js/53.2ac21c0e.js"><link rel="prefetch" href="/my-notes/assets/js/54.361bc2f3.js"><link rel="prefetch" href="/my-notes/assets/js/55.3853b7f3.js"><link rel="prefetch" href="/my-notes/assets/js/56.754a3b4c.js"><link rel="prefetch" href="/my-notes/assets/js/57.1d9684e7.js"><link rel="prefetch" href="/my-notes/assets/js/58.0e7f2b60.js"><link rel="prefetch" href="/my-notes/assets/js/59.b37ab2f4.js"><link rel="prefetch" href="/my-notes/assets/js/60.f31d0aea.js"><link rel="prefetch" href="/my-notes/assets/js/61.5aebeb50.js"><link rel="prefetch" href="/my-notes/assets/js/62.cebf26d6.js"><link rel="prefetch" href="/my-notes/assets/js/63.6c7932ca.js"><link rel="prefetch" href="/my-notes/assets/js/64.cad8a013.js"><link rel="prefetch" href="/my-notes/assets/js/65.25e4c14e.js"><link rel="prefetch" href="/my-notes/assets/js/66.e9c81af6.js"><link rel="prefetch" href="/my-notes/assets/js/67.31cbef00.js"><link rel="prefetch" href="/my-notes/assets/js/68.edc93332.js"><link rel="prefetch" href="/my-notes/assets/js/69.5eaf1e4f.js"><link rel="prefetch" href="/my-notes/assets/js/7.5a6eeb6c.js"><link rel="prefetch" href="/my-notes/assets/js/70.7114cd64.js"><link rel="prefetch" href="/my-notes/assets/js/71.2066867c.js"><link rel="prefetch" href="/my-notes/assets/js/72.0f93cb73.js"><link rel="prefetch" href="/my-notes/assets/js/73.6c4d69ec.js"><link rel="prefetch" href="/my-notes/assets/js/74.0a91fc3c.js"><link rel="prefetch" href="/my-notes/assets/js/75.47e45f38.js"><link rel="prefetch" href="/my-notes/assets/js/76.99886a8d.js"><link rel="prefetch" href="/my-notes/assets/js/78.eff53df7.js"><link rel="prefetch" href="/my-notes/assets/js/79.e5d77573.js"><link rel="prefetch" href="/my-notes/assets/js/80.8ac4e931.js"><link rel="prefetch" href="/my-notes/assets/js/81.82416621.js"><link rel="prefetch" href="/my-notes/assets/js/82.b7cea701.js"><link rel="prefetch" href="/my-notes/assets/js/83.eb0065f7.js"><link rel="prefetch" href="/my-notes/assets/js/84.45596ac9.js"><link rel="prefetch" href="/my-notes/assets/js/85.73902eef.js"><link rel="prefetch" href="/my-notes/assets/js/86.05a157f2.js"><link rel="prefetch" href="/my-notes/assets/js/87.83218f21.js"><link rel="prefetch" href="/my-notes/assets/js/88.bf05ee49.js"><link rel="prefetch" href="/my-notes/assets/js/89.089b5c96.js"><link rel="prefetch" href="/my-notes/assets/js/9.4a5b4024.js"><link rel="prefetch" href="/my-notes/assets/js/90.dc0b55a6.js"><link rel="prefetch" href="/my-notes/assets/js/91.ddc7da4f.js"><link rel="prefetch" href="/my-notes/assets/js/92.2b5c7d5f.js"><link rel="prefetch" href="/my-notes/assets/js/93.934a02e9.js"><link rel="prefetch" href="/my-notes/assets/js/94.3a6ede23.js"><link rel="prefetch" href="/my-notes/assets/js/95.0e946220.js"><link rel="prefetch" href="/my-notes/assets/js/96.3861fb05.js"><link rel="prefetch" href="/my-notes/assets/js/97.8627cefa.js"><link rel="prefetch" href="/my-notes/assets/js/98.6e0ee750.js"><link rel="prefetch" href="/my-notes/assets/js/99.5df99b25.js">
    <link rel="stylesheet" href="/my-notes/assets/css/0.styles.565c6041.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notes/" class="home-link router-link-active"><img src="/my-notes/img/logo.jpg" alt="DK's Notes" class="logo"> <span class="site-name can-hide">DK's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">Java基础</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-多线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link">多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-java8新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8新特性</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java虚拟机</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link router-link-active">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">秒杀项目</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><a href="/my-notes/git/" class="link-title">工具|部署</a> <span class="title" style="display:none;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试|刷题" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">面试|刷题</a> <span class="title" style="display:none;">面试|刷题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">刷题</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">开发问题😈</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">关于💕</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">归档🕛</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.jpg"> <div class="blogger-info"><h3>风</h3> <span>摸鱼</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/my-notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">Java基础</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-多线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link">多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-java8新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8新特性</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java虚拟机</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link router-link-active">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">秒杀项目</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><a href="/my-notes/git/" class="link-title">工具|部署</a> <span class="title" style="display:none;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试|刷题" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">面试|刷题</a> <span class="title" style="display:none;">面试|刷题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">刷题</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">开发问题😈</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">关于💕</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">归档🕛</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-notes/redis/" aria-current="page" class="sidebar-link">Redis - 知识体系</a></li><li><a href="/my-notes/redis/7/" aria-current="page" class="active sidebar-link">Redis 全笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/my-notes/redis/7/#redis记录" class="sidebar-link">Redis记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#安装redis" class="sidebar-link">安装Redis</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#redis配置允许远程访问" class="sidebar-link">Redis配置允许远程访问</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#其他的redis配置" class="sidebar-link">其他的Redis配置</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#连接客户端" class="sidebar-link">连接客户端</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#设置redis开机启动" class="sidebar-link">设置redis开机启动</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#用途举例" class="sidebar-link">用途举例</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#redis键-key" class="sidebar-link">Redis键(key)</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#原子性" class="sidebar-link">原子性</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#string" class="sidebar-link">String</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#基本命令" class="sidebar-link">基本命令</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#string的数据结构" class="sidebar-link">String的数据结构</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#相对于使用c语言原本的char-的字符串有什么好处" class="sidebar-link">相对于使用C语言原本的char[]的字符串有什么好处</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#list" class="sidebar-link">List</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#概述-2" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#list的数据结构" class="sidebar-link">List的数据结构</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#作为list底层实现之一的压缩列表" class="sidebar-link">作为List底层实现之一的压缩列表</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#概述-3" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#常用命令-2" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#set的数据结构" class="sidebar-link">set的数据结构</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#有序集合zset" class="sidebar-link">有序集合zset</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#概述-4" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#常用命令-3" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#数据结构" class="sidebar-link">数据结构</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#有序集合zset底层实现之跳跃表" class="sidebar-link">有序集合zset底层实现之跳跃表</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#hash" class="sidebar-link">hash</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#底层结构" class="sidebar-link">底层结构</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#redis配置文件详解" class="sidebar-link">Redis配置文件详解</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#redis新数据类型" class="sidebar-link">Redis新数据类型</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#bitmaps" class="sidebar-link">Bitmaps</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#hyperloglog" class="sidebar-link">HyperLogLog</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#geospatial" class="sidebar-link">Geospatial</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#jedis访问redis步骤" class="sidebar-link">jedis访问redis步骤</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#redis事务" class="sidebar-link">redis事务</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#事务不执行的情况" class="sidebar-link">事务不执行的情况</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#乐观锁实现秒杀系统" class="sidebar-link">乐观锁实现秒杀系统</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#redis实现乐观锁" class="sidebar-link">redis实现乐观锁</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#springboot整合redis" class="sidebar-link">SpringBoot整合Redis</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/redis/7/#编写redis配置类-对key-value进行序列化-实体类需实现serializable接口" class="sidebar-link">编写redis配置类,对key value进行序列化(实体类需实现Serializable接口)</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/redis/7/#编写redis常用操作工具类" class="sidebar-link">编写redis常用操作工具类</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#redis各种数据结构使用场景总结" class="sidebar-link">redis各种数据结构使用场景总结</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#redis持久化" class="sidebar-link">redis持久化</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/redis/7/#redis的发布和订阅" class="sidebar-link">Redis的发布和订阅</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#什么是发布和订阅" class="sidebar-link">什么是发布和订阅</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/redis/7/#发布订阅命令行实现-广发用于构建即时通信应用-如网络聊天室-chatroom-和实时广播、实时提醒等" class="sidebar-link">发布订阅命令行实现(广发用于构建即时通信应用，如网络聊天室(chatroom)和实时广播、实时提醒等)</a></li></ul></li></ul></li><li><a href="/my-notes/redis/1/" class="sidebar-link">Redis - 概念和基础</a></li><li><a href="/my-notes/redis/2/" class="sidebar-link">Redis - 五大数据类型</a></li><li><a href="/my-notes/redis/3/" class="sidebar-link">Redis - 三种特殊数据类型</a></li><li><a href="/my-notes/redis/4/" class="sidebar-link">Redis - 事务</a></li><li><a href="/my-notes/redis/5/" class="sidebar-link">Redis - Java</a></li><li><a href="/my-notes/redis/6/" class="sidebar-link">Redis - 高级</a></li><li><a href="/my-notes/redis/persistence/" class="sidebar-link">Redis持久化机制</a></li><li><a href="/my-notes/redis/masterSlave/" class="sidebar-link">Redis集群:主从模式</a></li><li><a href="/my-notes/redis/sentinel/" class="sidebar-link">Redis高可用-哨兵机制</a></li><li><a href="/my-notes/Redis/transaction/" class="sidebar-link">Redis事务机制</a></li><li><a href="/my-notes/Redis/ttl-disuse-Strategy/" class="sidebar-link">Redis过期清除策略和内存淘汰机制</a></li><li><a href="/my-notes/Redis/cacheConsistency/" class="sidebar-link">缓存一致性问题</a></li><li><a href="/my-notes/Redis/distributedLock/" class="sidebar-link">redis和zookeeper分布式锁</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ElasticSearch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/my-notes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/my-notes/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>数据库</a></li><li data-v-06225672><a href="/my-notes/categories/?category=Redis" title="分类" data-v-06225672>Redis</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.zaiolos.top/" target="_blank" title="作者" class="beLink" data-v-06225672>zdk</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-01-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Redis 全笔记<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><strong>Table of Contents</strong> <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener noreferrer">DocToc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></p> <ul><li><a href="#redis%E8%AE%B0%E5%BD%95">Redis记录</a> <ul><li><a href="#%E6%A6%82%E8%BF%B0">概述</a></li> <li><a href="#%E5%AE%89%E8%A3%85redis">安装Redis</a></li> <li><a href="#redis%E9%85%8D%E7%BD%AE%E5%85%81%E8%AE%B8%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE">Redis配置允许远程访问</a></li> <li><a href="#%E5%85%B6%E4%BB%96%E7%9A%84redis%E9%85%8D%E7%BD%AE">其他的Redis配置</a> <ul><li><a href="#%E8%BF%9E%E6%8E%A5%E5%AE%A2%E6%88%B7%E7%AB%AF">连接客户端</a></li> <li><a href="#%E8%AE%BE%E7%BD%AEredis%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8">设置redis开机启动</a></li> <li><a href="#%E7%94%A8%E9%80%94%E4%B8%BE%E4%BE%8B">用途举例</a></li></ul></li> <li><a href="#redis%E9%94%AEkey">Redis键(key)</a></li> <li><a href="#%E5%8E%9F%E5%AD%90%E6%80%A7">原子性</a></li> <li><a href="#string">String</a> <ul><li><a href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4">基本命令</a></li> <li><a href="#string%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">String的数据结构</a></li> <li><a href="#%E7%9B%B8%E5%AF%B9%E4%BA%8E%E4%BD%BF%E7%94%A8c%E8%AF%AD%E8%A8%80%E5%8E%9F%E6%9C%AC%E7%9A%84char%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84">相对于使用C语言原本的char[]的字符串有什么好处</a></li></ul></li> <li><a href="#list">List</a> <ul><li><a href="#%E6%A6%82%E8%BF%B0-1">概述</a></li> <li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">常用命令</a></li> <li><a href="#list%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">List的数据结构</a></li> <li><a href="#%E4%BD%9C%E4%B8%BAlist%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E4%B9%8B%E4%B8%80%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8">作为List底层实现之一的压缩列表</a></li></ul></li> <li><a href="#set">Set</a> <ul><li><a href="#%E6%A6%82%E8%BF%B0-2">概述</a></li> <li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1">常用命令</a></li> <li><a href="#set%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">set的数据结构</a></li></ul></li> <li><a href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset">有序集合zset</a> <ul><li><a href="#%E6%A6%82%E8%BF%B0-3">概述</a></li> <li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2">常用命令</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a></li> <li><a href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E4%B9%8B%E8%B7%B3%E8%B7%83%E8%A1%A8">有序集合zset底层实现之跳跃表</a></li></ul></li> <li><a href="#hash">hash</a> <ul><li><a href="#%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84">底层结构</a></li></ul></li> <li><a href="#redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3">Redis配置文件详解</a></li> <li><a href="#redis%E6%96%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Redis新数据类型</a> <ul><li><a href="#bitmaps">Bitmaps</a></li> <li><a href="#hyperloglog">HyperLogLog</a></li> <li><a href="#geospatial">Geospatial</a></li></ul></li> <li><a href="#jedis%E8%AE%BF%E9%97%AEredis%E6%AD%A5%E9%AA%A4">jedis访问redis步骤</a></li> <li><a href="#redis%E4%BA%8B%E5%8A%A1">redis事务</a> <ul><li><a href="#%E4%BA%8B%E5%8A%A1%E4%B8%8D%E6%89%A7%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5">事务不执行的情况</a></li> <li><a href="#%E4%B9%90%E8%A7%82%E9%94%81%E5%AE%9E%E7%8E%B0%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F">乐观锁实现秒杀系统</a></li> <li><a href="#redis%E5%AE%9E%E7%8E%B0%E4%B9%90%E8%A7%82%E9%94%81">redis实现乐观锁</a></li> <li><a href="#springboot%E6%95%B4%E5%90%88redis">SpringBoot整合Redis</a> <ul><li><a href="#%E7%BC%96%E5%86%99redis%E9%85%8D%E7%BD%AE%E7%B1%BB%E5%AF%B9key-value%E8%BF%9B%E8%A1%8C%E5%BA%8F%E5%88%97%E5%8C%96%E5%AE%9E%E4%BD%93%E7%B1%BB%E9%9C%80%E5%AE%9E%E7%8E%B0serializable%E6%8E%A5%E5%8F%A3">编写redis配置类,对key value进行序列化(实体类需实现Serializable接口)</a></li> <li><a href="#%E7%BC%96%E5%86%99redis%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E7%B1%BB">编写redis常用操作工具类</a></li></ul></li> <li><a href="#redis%E5%90%84%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E6%80%BB%E7%BB%93">redis各种数据结构使用场景总结</a></li> <li><a href="#redis%E6%8C%81%E4%B9%85%E5%8C%96">redis持久化</a></li></ul></li> <li><a href="#redis%E7%9A%84%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85">Redis的发布和订阅</a> <ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85">什么是发布和订阅</a></li> <li><a href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9E%E7%8E%B0%E5%B9%BF%E5%8F%91%E7%94%A8%E4%BA%8E%E6%9E%84%E5%BB%BA%E5%8D%B3%E6%97%B6%E9%80%9A%E4%BF%A1%E5%BA%94%E7%94%A8%E5%A6%82%E7%BD%91%E7%BB%9C%E8%81%8A%E5%A4%A9%E5%AE%A4chatroom%E5%92%8C%E5%AE%9E%E6%97%B6%E5%B9%BF%E6%92%AD%E5%AE%9E%E6%97%B6%E6%8F%90%E9%86%92%E7%AD%89">发布订阅命令行实现(广发用于构建即时通信应用，如网络聊天室(chatroom)和实时广播、实时提醒等)</a></li></ul></li></ul></li></ul> <hr> <h2 id="redis记录"><a href="#redis记录" class="header-anchor">#</a> Redis记录</h2> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <ol><li>Redis是noSQL(not only SQL)数据库 即非关系型数据库</li> <li>以key-value形式缓存数据在内存中，读取速度极快支持多种数据结构如string,list,set,zset,hash等</li> <li>这些数据都支持push/pop,add/remove以及取交集并集差集等操作，且这些操作都是原子性的也可进行数据持久化，</li> <li>将数据存储到硬盘：RDB和AOF方式</li> <li>Redis与memcached区别：Redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件,在此基础上，Redis实现了主从同步</li></ol> <h3 id="安装redis"><a href="#安装redis" class="header-anchor">#</a> 安装Redis</h3> <ul><li><p>先给Linux安装gcc环境 yum -y install gcc automake autoconf libtool make</p></li> <li><p>将gcc升级到9</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># gcc -v                             # 查看gcc版本</span>
<span class="token comment"># yum -y install centos-release-scl  # 升级到9.1版本</span>
<span class="token comment"># yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span>
<span class="token comment"># scl enable devtoolset-9 bash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>在/目录下新建soft文件夹，将redis的tar.gz包放入，使用tar -zxvf redis-xx解压(如果没安装tar，可以使用 yum install tar -y安装)</p></li> <li><p>在redis的解压目录下输入make指令</p></li> <li><p>在redis的解压目录下输入 make install PREFIX=/usr/local/redis(prefix表示安装的目录，不指定的话默认安装到/usr/local/bin里面)</p></li> <li><p>观察/usr/local/redis中的文件结构，需要安装tree命令软件(yum install tree -y)</p></li> <li><p>然后启动redis服务：/usr/local/redis/bin/redis-server</p></li> <li><p>再打开一个终端窗口使用redis客户端操作：/usr/local/redis/bin/redis-cli</p></li> <li><p>在redis服务启动的窗口使用ctrl+c或shutdown(推荐)或使用kill -9 进程id杀死redis进程。shutdown命令后的参数可以是save/nosave，一般用save进行本地保存以便下次启动时恢复数据</p></li> <li><p>通过ps -aux|grep redis可查看redis服务端的进程</p></li> <li><p>firewall-cmd --zone=public --add-port=6379/tcp --permanent：开启6379防火墙</p></li> <li><p>firewall-cmd --reload：重新加载防火墙</p></li></ul> <h3 id="redis配置允许远程访问"><a href="#redis配置允许远程访问" class="header-anchor">#</a> Redis配置允许远程访问</h3> <ol><li><p>配置redis访问密码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>port <span class="token number">6500</span>
daemonize <span class="token function">yes</span>
pidfile /var/run/redis_6500.pid
 logfile <span class="token string">&quot;/usr/local/redis/bin/redis-6500.log&quot;</span>
dbfilename dump-6500.rdb
 requirepass <span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>指定监听的ip地址</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>port <span class="token number">6500</span>
daemonize <span class="token function">yes</span>
pidfile /var/run/redis_6500.pid
 logfile <span class="token string">&quot;/usr/local/redis/bin/redis-6500.log&quot;</span>
dbfilename dump-6500.rdb
 <span class="token builtin class-name">bind</span> <span class="token number">192.168</span>.3.42
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>直接禁用保护模式(不推荐、危险)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>port <span class="token number">6500</span>
daemonize <span class="token function">yes</span>
pidfile /var/run/redis_6500.pid
 logfile <span class="token string">&quot;/usr/local/redis/bin/redis-6500.log&quot;</span>
dbfilename dump-6500.rdb
 protected-mode no
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>推荐使用设置密码+设置监听IP的方式</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>port <span class="token number">6500</span>
daemonize <span class="token function">yes</span>
pidfile /var/run/redis_6500.pid
logfile <span class="token string">&quot;/usr/local/redis/bin/redis-6500.log&quot;</span>
 dbfilename dump-6500.rdb
<span class="token builtin class-name">bind</span> <span class="token number">192.168</span>.3.42
 requirepass <span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h3 id="其他的redis配置"><a href="#其他的redis配置" class="header-anchor">#</a> 其他的Redis配置</h3> <div class="custom-block note"><p class="custom-block-title">笔记</p> <ol><li><p>loglevel：redis的日志记录等级，默认为notice，共有四级(debug&lt;verbose&lt;notice&lt;warning)</p></li> <li><p>databases：redis服务中数据库的数量，通过select+数字切换，默认为0</p></li> <li><p>timeout：超时关闭连接的时间，当连接redis服务的客户端timeout秒没有活动的时候就关闭这个连接。若设置为0则表示永远不关闭</p></li> <li><p>save：指出在多长时间内，有多少次更新操作，就将数据同步到数据文件</p></li> <li><p>rdbcompression：指定存储至本地数据库时是否压缩数据，默认为 yes</p></li></ol> <p>Redis 采用 LZF 压缩，如果为了节省 CPU 时间，可以关闭该选项，但会导致数据库文件变的巨大</p> <ol start="6"><li><p>dir： 本地数据库存放路径，默认值为 ./</p></li> <li><p>slaveof： 当本机为从服务时，设置主服务的IP及端口，如：192.168.0.100:6500</p></li> <li><p>slave-read-only： 当本机为从服务时，是否设置为只读状态</p></li> <li><p>masterauth： 当本机为从服务时，设置主服务的连接密码，如：123456</p></li> <li><p>maxclients： 最大客户端连接数，默认10000，参照<code>/soft/redis-6.0.6/redis.conf</code>中的说明。可在客户端中使用config get maxclients查看这个配置</p></li></ol></div> <ol start="11"><li><p>appendonly：指定是否在每次更新操作后进行日志记录（注意是进行日志记录，而不是存储数据），默认为no。Redis 在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis 本身同步数据文件是按上面 save 条件来同步的，所以有的数据会在一段时间内只存在于内存中</p></li> <li><p>appendfilename：指定更新日志文件名，默认为 appendonly.aof，默认的就是appendonly.aof文件</p></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>
###启动redis

```bash
/usr/local/redis/bin/redis.conf或/usr/local/redis/bin/redis-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="连接客户端"><a href="#连接客户端" class="header-anchor">#</a> 连接客户端</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token comment">#-h：指定ip	-p：指定端口	  -a：若开启了验证，需指定验证密码登录</span>
/usr/local/redis/bin/redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token parameter variable">-a</span> <span class="token number">123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="设置redis开机启动"><a href="#设置redis开机启动" class="header-anchor">#</a> 设置redis开机启动</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>：编辑 /etc下的 rc.local 文件,将redis的启动命令写入文件
<span class="token function">vim</span> /etc/rc.local

<span class="token number">2</span>：编辑脚本内容
/usr/local/redis/redis-server /usr/local/redis/redis.conf

tip：若开机脚本不起作用，可能因为 rc.local 的执行权限问题。
<span class="token function">chmod</span> <span class="token number">755</span> /etc/rc.local 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="用途举例"><a href="#用途举例" class="header-anchor">#</a> 用途举例</h4> <ul><li>获取最新的N个数据：通过list实现按自然时间排序的数据</li> <li>排行榜topN：利用zset(有序集合)实现</li> <li>时效性数据，如手机、邮箱验证码：利用Expire过期</li> <li>计数器，秒杀：原子性，利用自增方法INCR、DECR</li> <li>去除大量数据中的重复数据：利用Set集合</li> <li>构建队列：利用list</li> <li>发布订阅消息系统：pub/sub模式</li></ul> <h3 id="redis键-key"><a href="#redis键-key" class="header-anchor">#</a> Redis键(key)</h3> <ul><li>**keys <em>：查看当前库中所有key (匹配：keys <em>1)</em></em></li> <li><strong>exists key：判断某个key是否存在</strong></li> <li><strong>type key：查看你的key是什么类型</strong></li> <li><strong>del key：删除指定的key的数据</strong></li> <li><strong>unlink key：非阻塞删除数据(异步删除,不是立刻删除)，仅将key从keyspace元数据中删除，真正的删除会在后续异步执行</strong></li> <li><strong>expire key 10(单位是seconds)：为给定的key设置过期时间</strong></li> <li><strong>ttl key：查看还有多少秒过期，-1表示永不过期，-2表示已经过期</strong></li> <li><strong>select (数字)：切换数据库(0-15)一共16个数据库</strong></li> <li><strong>dbsize：查看当前数据库的key的数量</strong></li> <li><strong>flushdb：清空当前库</strong></li> <li><strong>flushall：清空所有库</strong></li></ul> <h3 id="原子性"><a href="#原子性" class="header-anchor">#</a> 原子性</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>所谓原子操作是指不会被线程调度机制打断的操作<span class="token punctuation">;</span>
这种操作一旦开始，就会一直运行到结束，中间不会有任何context switch<span class="token punctuation">(</span>切换到另一线程<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>在单线程中，能够在单条指令中完成的操作都可以认为是<span class="token string">&quot;原子操作&quot;</span>，因为中断只能发生在指令之间
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>在多线程中，不能被其他进程<span class="token punctuation">(</span>线程<span class="token punctuation">)</span>打断的操作就叫原子操作，redis单命令的原子性主要得益于redis是单线程
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="string"><a href="#string" class="header-anchor">#</a> String</h3> <blockquote><p>String是Redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。v
String类型是二进制安全的。意味着Redis的string 可以包含任何数据。比如jpg图片或者序列化的对象。·
String类型是Redis最基本的数据类型，一个Redis 中字符串value最多可以是512M</p></blockquote> <h4 id="基本命令"><a href="#基本命令" class="header-anchor">#</a> 基本命令</h4> <ul><li>set [key] [value] 存一个，重复set同一个key ，原来的值会被覆盖</li> <li>get [key] 获取对应key 的值</li> <li>append [key] [value] 在指定key 的值后面追加value字符串</li> <li>strlen [key] 获取对应key值的字符串长度</li> <li>setnx [key] [value]：只有在key不存在时设置key的值</li> <li>incr [key] 将key中储存的数字值加1，只能对数字值操作，如果为空，新增这个key，赋值为1</li> <li>decr [key] 将key中储存的数字值减1，只能对数字值操作，如果为空，新增这个key，赋值为-1</li> <li>incrby/decrby [key] [步长]：将key中储存的数字进行增减自定义步长</li> <li>mset [key] [value] [key] [value] [key] [value]....同时设置一个或多个key value键值对</li> <li>mget [key] [value] [key] [value] [key] [value]....同时获取一个或多个key的值</li> <li>msetnx [key] [value] [key] [value]：当其中有一个key是已存在的，整个msetnx操作会失败(原子性的)</li> <li>getrange [key] [index] [end] 获取值得范围，类似Java substring，左右均为闭区间</li> <li>setrange [key] [index] [value] 用value覆盖从index(包含index)开始后的字符串value长度个字符串(index从0开始)</li> <li>setex [key] [过期时间] [value]：在设置值的时候即可设置过期时间</li> <li>getset [key] [value]：以新换旧，设置新值得到旧值(取到的是旧值，然后存储的旧值被新值替换)</li></ul> <h4 id="string的数据结构"><a href="#string的数据结构" class="header-anchor">#</a> String的数据结构</h4> <blockquote><p>String 的string的底层数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配。内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M。</p></blockquote> <p>SDS定义</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sdshdr</span><span class="token punctuation">{</span>
     <span class="token comment">//记录buf数组中已使用字节的数量</span>
     <span class="token comment">//等于 SDS 保存字符串的长度</span>
     <span class="token keyword">int</span> len<span class="token punctuation">;</span>
     <span class="token comment">//记录 buf 数组中未使用字节的数量</span>
     <span class="token keyword">int</span> free<span class="token punctuation">;</span>
     <span class="token comment">//字节数组，用于保存字符串</span>
     <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="https://images.zaiolos.top/images/image-20220426193757806.png" alt=""></p> <h4 id="相对于使用c语言原本的char-的字符串有什么好处"><a href="#相对于使用c语言原本的char-的字符串有什么好处" class="header-anchor">#</a> 相对于使用C语言原本的char[]的字符串有什么好处</h4> <ol><li><p><strong>常数复杂度获取字符串长度</strong></p> <blockquote><p>由于 len 属性的存在，我们获取 SDS 字符串的长度只需要读取 len 属性，时间复杂度为 O(1)。而对于 C 语言，获取字符串的长度通常是经过遍历计数来实现的，时间复杂度为 O(n)。通过 strlen key 命令可以获取 key 的字符串长度</p></blockquote></li> <li><p><strong>杜绝缓冲区溢出</strong></p> <blockquote><p>我们知道在 C 语言中使用 strcat 函数来进行两个字符串的拼接，一旦没有分配足够长度的内存空间，就会造成缓冲区溢出。而对于 SDS 数据类型，在进行字符修改的时候，会首先根据记录的 len 属性检查内存空间是否满足需求，如果不满足，会进行相应的空间扩展，然后在进行修改操作，所以不会出现缓冲区溢出</p></blockquote></li> <li><p><strong>减少修改字符串的内存重新分配次数</strong></p> <blockquote><p>C语言由于不记录字符串的长度，所以如果要修改字符串，必须要重新分配内存（先释放再申请），因为如果没有重新分配，字符串长度增大时会造成内存缓冲区溢出，字符串长度减小时会造成内存泄露。</p> <p>而对于SDS，由于len属性和free属性的存在，对于修改字符串SDS实现了空间预分配和惰性空间释放两种策略：</p> <ul><li>空间预分配：对字符串进行空间扩展的时候，扩展的内存比实际需要的多，这样可以减少连续执行字符串增长操作所需的内存重分配次数</li> <li>惰性空间释放：对字符串进行缩短操作时，程序不立即使用内存重新分配来回收缩短后多余的字节，而是使用 free 属性将这些字节的数量记录下来，等待后续使用。（当然SDS也提供了相应的API，当我们有需要时，也可以手动释放这些未使用的空间。）</li></ul></blockquote></li> <li><p><strong>二进制安全</strong></p> <blockquote><p>因为C字符串以空字符作为字符串结束的标识，而对于一些二进制文件（如图片等），内容可能包括空字符串，因此C字符串无法正确存取；而所有 SDS 的API 都是以处理二进制的方式来处理 buf 里面的元素，并且 SDS 不是以空字符串来判断是否结束，而是以 len 属性表示的长度来判断字符串是否结束</p></blockquote></li> <li><p><strong>兼容部分 C 字符串函数</strong></p> <blockquote><p>虽然 SDS 是二进制安全的，但是一样遵从每个字符串都是以空字符串结尾的惯例，这样可以重用 C 语言库&lt;string.h&gt; 中的一部分函数</p></blockquote></li> <li><p><strong>总结</strong></p> <p><img src="https://images.zaiolos.top/images/image-20220426200122877.png" alt=""></p></li></ol> <h3 id="list"><a href="#list" class="header-anchor">#</a> List</h3> <h4 id="概述-2"><a href="#概述-2" class="header-anchor">#</a> 概述</h4> <blockquote><p>单键多值</p> <p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部(左边）或者尾部(右边)。
它的底层实际是个双向链表，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p></blockquote> <h4 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h4> <ul><li><p>lrange/rrange [key] [start] [stop] 按照索引下标获取元素(从左到右或从右到左)</p> <p>如果start是0，stop是-1，即可取到所有值，因为0表示左边第一个，-1表示右边第一个</p></li> <li><p>lpush/rpush [key] [value] [key] [value] [key] [value]..... ：从左或右插入一个或多个值，插入方式为左插法或右插法，即每次插入到当前方向的最后一个的后面。</p> <p>例如lpush k1 v1 k2 v2 k3 v3，然后使用lrange 0 2取到的值得顺序是v3 v2 v1，因为插入的方式是先v1</p> <p>，然后v2 v1，然后v3 v2 v1。</p></li> <li><p>lpop/rpop [key] 从左边/右边吐出一个值</p></li> <li><p>rpoplpush [key1] [key2] 从[key1]列表右边吐出一个值，插到[key2]列表的左边</p></li> <li><p>lindex[key] [index] 根据索引获取元素(从左到右)</p></li> <li><p>llen[key] 获得链表长度</p></li> <li><p>linsert[key] before/after [value] [newvalue] 在value的之前或之后插入newvalue</p></li> <li><p>lset[key] [index] [value] 将列表key下标为index的值替换为value</p></li> <li><p>lrem[key] [n] [value] 从左边开始删除n个value</p></li></ul> <h4 id="list的数据结构"><a href="#list的数据结构" class="header-anchor">#</a> List的数据结构</h4> <blockquote><p>List的数据结构为快速链表quickList。</p> <p>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。
它将所有的元素紧挨着一起存储，分配的是一块连续的内存。当数据量比较多的时候才会改成quicklist。</p> <p>因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。</p> <p>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p></blockquote> <p>链表结点定义：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span>  <span class="token keyword">struct</span> <span class="token class-name">listNode</span><span class="token punctuation">{</span>
       <span class="token comment">//前置节点</span>
       <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
       <span class="token comment">//后置节点</span>
       <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
       <span class="token comment">//节点的值</span>
       <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>listNode
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>双向链表定义：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">list</span><span class="token punctuation">{</span>
     <span class="token comment">//表头节点</span>
     listNode <span class="token operator">*</span>head<span class="token punctuation">;</span>
     <span class="token comment">//表尾节点</span>
     listNode <span class="token operator">*</span>tail<span class="token punctuation">;</span>
     <span class="token comment">//链表所包含的节点数量</span>
     <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>
     <span class="token comment">//节点值复制函数</span>
     <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>free<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//节点值释放函数</span>
     <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>free<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//节点值对比函数</span>
     <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>match<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span><span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>list<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Redis链表特性：</p> <ul><li>双端：链表具有前置节点和后置节点的引用，获取这两个节点时间复杂度都为O(1)</li> <li>无环：表头节点的 prev 指针和表尾节点的 next 指针都指向 NULL,对链表的访问都是以 NULL 结束</li> <li>带链表长度计数器：通过 len 属性获取链表长度的时间复杂度为 O(1)</li> <li>多态：链表节点使用 void* 指针来保存节点值，可以保存各种不同类型的值</li></ul> <h4 id="作为list底层实现之一的压缩列表"><a href="#作为list底层实现之一的压缩列表" class="header-anchor">#</a> 作为List底层实现之一的压缩列表</h4> <blockquote><p>压缩列表（ziplist）是Redis为了节省内存而开发的，是由一系列特殊编码的连续内存块组成的顺序型数据结构，一个压缩列表可以包含任意多个节点（entry），每个节点可以保存一个字节数组或者一个整数值</p></blockquote> <p><strong>压缩列表的原理：压缩列表并不是对数据利用某种算法进行压缩，而是将数据按照一定规则编码在一块连续的内存区域，目的是节省内存</strong></p> <p>压缩列表的每个节点构成如下：</p> <p><img src="https://images.zaiolos.top/images/image-20220426203659897.png" alt="image-20220426203659897"></p> <ol><li>previous_entry_ength：记录压缩列表前一个字节的长度。previous_entry_ength的长度可能是1个字节或者是5个字节，如果上一个节点的长度小于254，则该节点只需要一个字节就可以表示前一个节点的长度了，如果前一个节点的长度大于等于254，则previous length的第一个字节为254，后面用四个字节表示当前节点前一个节点的长度。利用此原理即当前节点位置减去上一个节点的长度即得到上一个节点的起始位置，压缩列表可以从尾部向头部遍历。这么做很有效地减少了内存的浪费</li> <li>encoding：节点的encoding保存的是节点的content的内容类型以及长度，encoding类型一共有两种，一种字节数组一种是整数，encoding区域长度为1字节、2字节或者5字节长</li> <li>content：content区域用于保存节点的内容，节点内容类型和长度由encoding决定</li></ol> <h3 id="set"><a href="#set" class="header-anchor">#</a> Set</h3> <h4 id="概述-3"><a href="#概述-3" class="header-anchor">#</a> 概述</h4> <blockquote><p>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择。</p> <p>并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</p> <p>Redis的set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的复杂度都是O(1)。</p> <p>一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变</p></blockquote> <h4 id="常用命令-2"><a href="#常用命令-2" class="header-anchor">#</a> 常用命令</h4> <ul><li><p>sadd[key] [value1] [value2] 将一个或多个元素加入到集合key中</p></li> <li><p>smembers[key] 取出该集合的所有值</p></li> <li><p>sismember[key] [value] 判断集合key是含有该value，有为1，没有为0</p></li> <li><p>scard[key] 返回该集合的元素个数</p></li> <li><p>srem[key] [value1] [value2]..删除集合中的某(几)个元素</p></li> <li><p>spop[key] [n]随机从该集合中吐出n个值，不加n默认吐出一个，即拿出，会从集合中删除</p></li> <li><p>srandmember[key] [n]随机从该集合中取出n个值，不会从集合中删除</p></li> <li><p>smove[source] [destination] value 把集合source中的值为value的元素移动到集合destination中</p></li> <li><p>sinter[key1] [key2] 返回两个集合的交集元素</p></li> <li><p>sunion[key1] [key2] 返回两个集合的并集元素</p></li> <li><p>sdiff[key1] [key2] 返回两个集合的差集元素(key1中有的，key2中没有的)</p></li></ul> <h4 id="set的数据结构"><a href="#set的数据结构" class="header-anchor">#</a> set的数据结构</h4> <blockquote><p>set的数据结构是dict(dictionary)字典，字典是用哈希表实现的</p> <p>Java中 HashSet的内部实现使用的是 HashMap，只不过所有的value都指向同一个对象。</p> <p>Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值。</p></blockquote> <h3 id="有序集合zset"><a href="#有序集合zset" class="header-anchor">#</a> 有序集合zset</h3> <h4 id="概述-4"><a href="#概述-4" class="header-anchor">#</a> 概述</h4> <blockquote><p>Redis有序集合zset与普通集合set非常相似，是一个没有重复元素的字符串集合。·
不同之处是有序集合的每个成员都关联了一个评分(score),这个评分(score)被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以是重复了。
因为元素是有序的，所以你也可以很快的根据评分(score)或者次序(position)来获取一个范围的元素。
访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。</p></blockquote> <h4 id="常用命令-3"><a href="#常用命令-3" class="header-anchor">#</a> 常用命令</h4> <ul><li><p>zadd[key] [score1] [value1] [score2] [value2]...：将一个或多个member元素及其score值加入到有序集合key中</p></li> <li><p>zrange[key] [start] [stop] [WAHTSCORES]：返回有序结合中，下标在start和top之间的元素,带WAHTSCORES可以让score和值一起返回。stop为-1时返回所有数据</p></li> <li><p>zrangebyscore key minmax[withscores] [limit offset count]：返回有序集合key中，所有score值介于min和max之间(包括等于min和max)的成员。有序集合按score值递增排序(从小到大)</p></li> <li><p>zrevrangebyscore key maxmin[withscores] [limit offset count]：同上，排序方式改为从大到小</p></li> <li><p>zincrby[key] [increment] [value] 为元素的score加上增量</p></li> <li><p>zrem[key] [value]删除该集合下，指定值的元素</p></li> <li><p>zcount[key] [min] [max]统计该集合的元素score在区间[min,max]之间的元素个数</p></li> <li><p>zrank[key] [value] 返回该值在集合中的排名，从0开始</p></li></ul> <p>案例：如何利用zset实现一个文章访问量的排行榜</p> <h4 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h4> <blockquote><p>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String，Double&gt;，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。
zset底层使用了两个数据结构
(1) hash ,hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。
(2）跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。</p></blockquote> <h4 id="有序集合zset底层实现之跳跃表"><a href="#有序集合zset底层实现之跳跃表" class="header-anchor">#</a> 有序集合zset底层实现之跳跃表</h4> <p><img src="https://images.zaiolos.top/images/image-20211101133155477.png" alt="image-20211101133155477"></p> <div class="custom-block tip"><p class="custom-block-title">概念</p> <p>跳跃表（skiplist）是一种有序数据结构，它通过在每个节点中维持多个指向其它节点的指针，从而达到快速访问节点的目的。具有如下性质：</p> <ol><li>由很多层结构组成；</li> <li>每一层都是一个有序的链表，排列顺序为由高层到底层，都至少包含两个链表节点，分别是前面的head节点和后面的nil节点；</li> <li>最底层的链表包含了所有的元素；</li> <li>如果一个元素出现在某一层的链表中，那么在该层之下的链表也全都会出现（上一层的元素是当前层的元素的子集）；</li> <li>链表中的每个节点都包含两个指针，一个指向同一层的下一个链表节点，另一个指向下一层的同一个链表节点；</li></ol> <p><img src="https://images.zaiolos.top/images/image-20220426203950581.png" alt="image-20220426203950581"></p></div> <p>Redis中跳跃表结点的定义如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token punctuation">{</span>
     <span class="token comment">//层</span>
     <span class="token keyword">struct</span> <span class="token class-name">zskiplistLevel</span><span class="token punctuation">{</span>
           <span class="token comment">//前进指针</span>
           <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>forward<span class="token punctuation">;</span>
           <span class="token comment">//跨度</span>
           <span class="token keyword">unsigned</span> <span class="token keyword">int</span> span<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>level<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
     <span class="token comment">//后退指针</span>
     <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>backward<span class="token punctuation">;</span>
     <span class="token comment">//分值</span>
     <span class="token keyword">double</span> score<span class="token punctuation">;</span>
     <span class="token comment">//成员对象</span>
     robj <span class="token operator">*</span>obj<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span> zskiplistNode
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>多个跳跃表结点构成一个跳跃表：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplist</span><span class="token punctuation">{</span>
     <span class="token comment">//表头节点和表尾节点</span>
     structz skiplistNode <span class="token operator">*</span>header<span class="token punctuation">,</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
     <span class="token comment">//表中节点的数量</span>
     <span class="token keyword">unsigned</span> <span class="token keyword">long</span> length<span class="token punctuation">;</span>
     <span class="token comment">//表中层数最大的节点的层数</span>
     <span class="token keyword">int</span> level<span class="token punctuation">;</span>
<span class="token punctuation">}</span>zskiplist<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://images.zaiolos.top/images/image-20220426204054792.png" alt="image-20220426204054792"></p> <div class="custom-block tip"><p class="custom-block-title">操作</p> <ol><li>搜索：从最高层的链表节点开始，如果比当前节点要大和比当前层的下一个节点要小，那么则往下找，也就是和当前层的下一层的节点的下一个节点进行比较，以此类推，一直找到最底层的最后一个节点，如果找到则返回，反之则返回空。</li> <li>插入：首先确定插入的层数，有一种方法是假设抛一枚硬币，如果是正面就累加，直到遇见反面为止，最后记录正面的次数作为插入的层数。当确定插入的层数k后，则需要将新元素插入到从底层到k层</li> <li>删除：在各个层中找到包含指定值的节点，然后将节点从链表中删除即可，如果删除以后只剩下头尾两个节点，则删除这一层</li></ol></div> <h3 id="hash"><a href="#hash" class="header-anchor">#</a> hash</h3> <p>key item value</p> <p>命令：</p> <ul><li>hdel key field1 [field2] 删除一个或多个哈希表字段</li> <li>hexists key field  查看哈希表 key 中，指定的字段是否存在。</li> <li>hget key field  获取存储在哈希表中指定字段的值。</li> <li>hgetall key  获取在哈希表中指定 key 的所有字段和值</li> <li>hincrby key field increment 为哈希表key中的指定字段的整数值加上常量increment</li> <li>hincrbyfloat key field increment  为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</li> <li>hkeys key 获取哈希表中所有字段</li> <li>hlen key 获取哈希表中字段的数量</li> <li>hmget key field1 [field2] 获取所有给定字段的值</li> <li>hmset key field1 value [field2 value2]  同时将多个 field-value (域-值)对设置到哈希表 key 中。</li> <li>hset key field value 将哈希表 key 中的字段 field 的值设为 value</li> <li>hsetnx key field value  只有在字段 field 不存在时，设置哈希表字段的值。</li> <li>hvals key 获取哈希表中所有值</li> <li>hscan key cursor [MATCH pattern] [COUNT count]  迭代哈希表中的键值对</li></ul> <h4 id="底层结构"><a href="#底层结构" class="header-anchor">#</a> 底层结构</h4> <span class="badge tip" style="vertical-align:top;" data-v-d5affa18>Redis 的字典使用哈希表作为底层实现</span> <p>哈希表结构定义：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dictht</span><span class="token punctuation">{</span>
     <span class="token comment">//哈希表数组</span>
     dictEntry <span class="token operator">*</span><span class="token operator">*</span>table<span class="token punctuation">;</span>
     <span class="token comment">//哈希表大小</span>
     <span class="token keyword">unsigned</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span>
     <span class="token comment">//哈希表大小掩码，用于计算索引值</span>
     <span class="token comment">//总是等于 size-1</span>
     <span class="token keyword">unsigned</span> <span class="token keyword">long</span> sizemask<span class="token punctuation">;</span>
     <span class="token comment">//该哈希表已有节点的数量</span>
     <span class="token keyword">unsigned</span> <span class="token keyword">long</span> used<span class="token punctuation">;</span>
<span class="token punctuation">}</span>dictht
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>哈希表是由数组 table 组成，table 中每个元素都是指向 dictEntry 结构，dictEntry 结构定义如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span><span class="token punctuation">{</span>
     <span class="token comment">//键</span>
     <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>
     <span class="token comment">//值</span>
     <span class="token keyword">union</span><span class="token punctuation">{</span>
          <span class="token keyword">void</span> <span class="token operator">*</span>val<span class="token punctuation">;</span>
          uint64_tu64<span class="token punctuation">;</span>
          int64_ts64<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>v<span class="token punctuation">;</span>
     <span class="token comment">//指向下一个哈希表节点，形成链表</span>
     <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>dictEntry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>key 用来保存键，val 属性用来保存值，值可以是一个指针，也可以是uint64_t整数，也可以是int64_t整数</p> <blockquote><p>注意这里还有一个指向下一个哈希表节点的指针，我们知道哈希表最大的问题是存在哈希冲突，如何解决哈希冲突，有开放地址法和链地址法。这里采用的便是链地址法，通过next这个指针可以将多个哈希值相同的键值对连接在一起，用来解决<strong>哈希冲突</strong></p></blockquote> <p>连在一起的键K1和键K0</p> <p><img src="https://images.zaiolos.top/images/image-20220426203100321.png" alt="image-20220426203100321"></p> <ol><li><p>**哈希算法：**Redis计算哈希值和索引值方法如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#1、使用字典设置的哈希函数，计算键 key 的哈希值</span>
<span class="token builtin class-name">hash</span> <span class="token operator">=</span> dict-<span class="token operator">&gt;</span>type-<span class="token operator">&gt;</span>hashFunction<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#2、使用哈希表的sizemask属性和第一步得到的哈希值，计算索引值</span>
index <span class="token operator">=</span> <span class="token builtin class-name">hash</span> <span class="token operator">&amp;</span> dict-<span class="token operator">&gt;</span>ht<span class="token punctuation">[</span>x<span class="token punctuation">]</span>.sizemask<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>**解决哈希冲突：**方法是链地址法。通过字典里面的 *next 指针指向下一个具有相同索引值的哈希表节点</p></li> <li><p>**扩容和收缩：**当哈希表保存的键值对太多或者太少时，就要通过 rerehash(重新散列）来对哈希表进行相应的扩展或者收缩。具体步骤：</p> <ul><li>如果执行扩展操作，会基于原哈希表创建一个大小等于 ht[0].used*2n 的哈希表（也就是每次扩展都是根据原哈希表已使用的空间扩大一倍创建另一个哈希表）。相反如果执行的是收缩操作，每次收缩是根据已使用空间缩小一倍创建一个新的哈希表</li> <li>重新利用上面的哈希算法，计算索引值，然后将键值对放到新的哈希表位置上</li> <li>所有键值对都迁徙完毕后，释放原哈希表的内存空间</li></ul></li> <li><p><strong>触发扩容的条件：</strong></p> <ul><li><p>服务器目前没有执行 BGSAVE 命令或者 BGREWRITEAOF 命令，并且负载因子大于等于1</p></li> <li><p>服务器目前正在执行 BGSAVE 命令或者 BGREWRITEAOF 命令，并且负载因子大于等于5</p> <p><code>ps：负载因子 = 哈希表已保存节点数量 / 哈希表大小</code></p></li></ul></li> <li><p><strong>渐近式 rehash</strong></p> <blockquote><p>渐近式 rehash，扩容和收缩操作不是一次性、集中式完成的，而是分多次、渐进式完成的。如果保存在Redis中的键值对只有几个几十个，那么 rehash 操作可以瞬间完成，但是如果键值对有几百万，几千万甚至几亿，那么要一次性的进行 rehash，势必会造成Redis一段时间内不能进行别的操作。所以Redis采用渐进式 rehash,这样在进行渐进式rehash期间，字典的删除查找更新等操作可能会在两个哈希表上进行，第一个哈希表没有找到，就会去第二个哈希表上进行查找。但是进行 增加操作，一定是在新的哈希表上进行的</p></blockquote></li></ol> <h3 id="redis配置文件详解"><a href="#redis配置文件详解" class="header-anchor">#</a> Redis配置文件详解</h3> <ul><li><p>port：端口号，默认6379</p></li> <li><p>tcp-backlog</p> <blockquote><p>设置tcp的backlog,backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列＋已经完成三次握手队列。
在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。u
注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值(128），所以需要确认增大/proc/sys/net/core/somaxconn和/proc/sys/net/ipv4/tcp_max_syn_backlog(128)两个值来达到想要的效果</p></blockquote></li></ul> <h3 id="redis新数据类型"><a href="#redis新数据类型" class="header-anchor">#</a> Redis新数据类型</h3> <h4 id="bitmaps"><a href="#bitmaps" class="header-anchor">#</a> Bitmaps</h4> <ol><li><p>简介</p> <p><img src="https://images.zaiolos.top/images/image-20211101133201992.png" alt="image-20211101133201992"></p> <ol start="2"><li><p>常用命令</p> <ul><li><p>setbit[key] [offset] [value] 设bitmaps中某个偏移量的值为0或1.offset：偏移量从0开始</p> <p><img src="https://images.zaiolos.top/images/image-20211101133208197.png" alt="image-20211101133208197"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>注意：很多应用的用户id以一个指定数字（例如10000 ）开头，直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费，通常的做法是每次做setbit 操作时将用户id减去这个指定数字。
在第一次初始化 Bitmaps时，假如偏移量非常大，那么整个初始化过程执行会比较慢，可能会造成 Redis的阻塞。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>getbit[key] [offset] 获取bitmaps中第偏移量为offset的值(offset从0开始)</p></li> <li><p>bitcount[key] [start end]：统计字符串被设置为1的bit数，一般情况下给定的整个字符串都会被进行计数，通过指定额外的start和end参数可以让计数只在特定的位之间进行。start和end参数的设置都可以使用负数值，比如-1表示最后一个位，-2表示倒数第二个位。start、end是指bit组的字节的下标数，[start,end]左右皆为闭区间。[start,end]表示有(end-start+1)8个字节空间。例如[0,2]，即下标在0~(2-0+1)*8-1=23之间的下标中，值为1的个数。</p></li> <li><p>bitop and(or/not/xor) [destkey] [key]：bitop是一个复合操作，它可以做多个Bitmaps的and(交集）、or(并集） 、not(非) 、 xor（异或）操作并将结果保存在destkey中。</p></li></ul></li> <li><p>set与bitmap对比</p> <p><img src="https://images.zaiolos.top/images/image-20211101133218544.png" alt="image-20211101133218544"> <img src="https://images.zaiolos.top/images/image-20211101133225425.png" alt="image-20211101133225425"> <img src="https://images.zaiolos.top/images/image-20211101133231200.png" alt="image-20211101133231200"></p></li></ol></li></ol> <h4 id="hyperloglog"><a href="#hyperloglog" class="header-anchor">#</a> HyperLogLog</h4> <ol><li><p>简介</p> <p><img src="https://images.zaiolos.top/images/image-20211101133250834.png" alt="image-20211101133250834"> <img src="https://images.zaiolos.top/images/image-20211101133304014.png" alt="image-20211101133304014"></p> <p><img src="https://images.zaiolos.top/images/image-20211101133311498.png" alt="image-20211101133311498"></p></li> <li><p>常用命令</p> <ul><li>pfadd[key] [element]...：添加一个或多个元素到HyperLogLog中。执行命令后如果HLL估计的近似基数发生变化，则返回1，否则返回0
<ul><li>pfcount[key] [key]....：计算HLL的近似基数，可以计算多个</li></ul></li> <li>pfmerge[destkey] [sourcekey] [sourcekey]....：将一个或多个HLL合并后的结果存在另一个HLL destkey中。比如每月活跃用户可以使用每天的活跃用户来合并计算出来</li></ul></li></ol> <h4 id="geospatial"><a href="#geospatial" class="header-anchor">#</a> Geospatial</h4> <ol><li><p>简介</p> <p><img src="https://images.zaiolos.top/images/image-20211101133318417.png" alt="image-20211101133318417"></p></li> <li><p>基本命令</p> <ul><li><p>Geospatial底层是zset，所以可用zset的命令实现Geospatial自身命令不能实现的操作(如删除操作)</p></li> <li><p>geoadd[key] [longitude] [latitude] [member] [longitude latitude member...]：添加地理位置(经度、纬度、名称)</p> <blockquote><p>两极无法直接添加，一般会下载城市数据，直接通过Java程序一次性导入
有效的经度从-180度到180度。有效的纬度从-85.05112878度到85.05112878度
当坐标位置超出指定范围时，该命令将会返回一个错误
已经添加的数据，是无法再次往里面添加的</p></blockquote></li> <li><p>geopos[key] [member...]：获取一个或多个指定地区的坐标值</p></li> <li><p>geodis[key] [member1] [member2] [m|km|ft|mi]：获取两个位置之间的直线距离</p> <blockquote><p>m表示单位为米(默认值)
km表示单位为千米
mi表示单位为英里
ft表示单位为英尺</p></blockquote></li> <li><p>georadius[key] [longitude] [latitude] radius [m|km|ft|mi]：找出某一半径内的元素(经度 纬度 距离 单位)</p></li></ul></li></ol> <h3 id="jedis访问redis步骤"><a href="#jedis访问redis步骤" class="header-anchor">#</a> jedis访问redis步骤</h3> <ul><li><p>关闭Linux防火墙或者开放redis的端口</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">6379</span>/tcp --permanent开启6379防火墙
firewall-cmd --reload：重新加载防火墙
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>记得注释掉配置文件中的bind 127.0.0.1</p></li> <li><p>redis.conf设置密码后，服务端启动时需带上redis.conf即指定配置文件启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./redis-server redis.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>客户端启动时需要使用-a带上requirpass的密码</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./redis-cli <span class="token parameter variable">-a</span> 密码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用jedis连接时，也需要加上密码</p> <p><img src="https://images.zaiolos.top/images/image-20211101133324485.png" alt="image-20211101133324485"></p></li></ul> <h3 id="redis事务"><a href="#redis事务" class="header-anchor">#</a> redis事务</h3> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>redis事务的本质就是一组命令的集合。一个事务中所有的命令都会被序列化(顺序)，按顺序执行
具有：一次性、顺序性、排他性
redis单条命令保证原子性(因为redis是单线程)，但事务不保证原子性</p></div> <p>过程：</p> <ul><li><p>开启事务：multi</p> <p><img src="https://images.zaiolos.top/images/image-20211101133330639.png" alt="image-20211101133330639"></p></li> <li><p>命令入队：输入一系列命令</p> <p><img src="https://images.zaiolos.top/images/image-20211101133335437.png" alt="image-20211101133335437"></p></li> <li><p>中途也可取消事务：使用discard命令</p> <p><img src="https://images.zaiolos.top/images/image-20211101133339820.png" alt="image-20211101133339820"></p></li> <li><p>执行事务：exec</p> <p><img src="https://images.zaiolos.top/images/image-20211101133346972.png" alt="image-20211101133346972"></p></li></ul> <h4 id="事务不执行的情况"><a href="#事务不执行的情况" class="header-anchor">#</a> 事务不执行的情况</h4> <blockquote><p>出现编译型异常(代码有问题即命令本身有错误)，那么事务中的所有命令都不会执行</p></blockquote> <p><img src="https://images.zaiolos.top/images/image-20211101133427852.png" alt="image-20211101133427852">	因为队列中有一次命令出现了语法错误，所以所有命令均未执行</p> <blockquote><p>出现运行时异常(如1/0这种)，出现此种错误，其他命令仍可正常执行</p></blockquote> <p><img src="https://images.zaiolos.top/images/image-20211101133435210.png" alt="image-20211101133435210"></p> <p>这种错误其他命令仍可正常执行</p> <h4 id="乐观锁实现秒杀系统"><a href="#乐观锁实现秒杀系统" class="header-anchor">#</a> 乐观锁实现秒杀系统</h4> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>我们知道大多数是基于数据版本（ version )的记录机制实现的。即为数据增加一个版本标识，在基于数据库表的版本解决方案中，一般是通过为数据库表增加一个&quot;version&quot;字段来实现读取出数据时，将此版本号一同读出，之后更新时，对此版本号加1。此时，将提交数据的版本号与数据库表对应记录的当前版本号进行比对，如果提交的数据版本号大于数据库当前版本号，则予以更新，否则认为是过期数据。redis中可以使用watch命令会监视给定的key，当exec时候如果监视的key从调用watch后发生过变化，则整个事务会失败。也可以调用watch多次监视多个key。这样就可以对指定的key加乐观锁了。注意watch的key是对整个连接有效的，事务也一样。如果连接断开，监视和事务都会被自动清除。当然了exec , discard , unwatch命令都会清除连接中的所有监视</p></div> <h4 id="redis实现乐观锁"><a href="#redis实现乐观锁" class="header-anchor">#</a> redis实现乐观锁</h4> <p>当一个线程在要对数据进行操作，但它的操作还未完成时，数据便被另一线程改变，这一线程操作的数据就不是原来的数据了。为了防止这种情况，可以使用乐观锁。</p> <ul><li><p>使用watch[key]....：监控一个或多个key，当事务未执行时，如果监控的key的值发生了改变，事务便不会执行</p> <ul><li><p>先设定两个初值k1 k2，监控k1，然后进行事务</p> <p><img src="https://images.zaiolos.top/images/image-20211101133447825.png" alt="image-20211101133447825"></p></li> <li><p>在事务未执行时，在另一终端标签页对k1 k2进行修改</p> <p><img src="https://images.zaiolos.top/images/image-20211101133453321.png" alt="image-20211101133453321"></p></li> <li><p>再回到原来的页面执行事务，发现事务并没有执行，使用unwatch后继续监控key</p> <p><img src="https://images.zaiolos.top/images/image-20211101133459234.png" alt="image-20211101133459234"></p></li></ul></li> <li><p>然后再使用unwatch命令解除监控，即可再次监控key</p></li></ul> <h4 id="springboot整合redis"><a href="#springboot整合redis" class="header-anchor">#</a> SpringBoot整合Redis</h4> <p>SpringBoot 2.x之后，原来使用的jedis被替换为了lettuce</p> <ul><li>jedis:采用客户端直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用jedis pool连接池!BIO模式</li> <li>lettuce：采用netty，实例可以在多个线程中进程共享，不存在线程不安全的情况，可以减少线程数据。更像NIO模式</li></ul> <h5 id="编写redis配置类-对key-value进行序列化-实体类需实现serializable接口"><a href="#编写redis配置类-对key-value进行序列化-实体类需实现serializable接口" class="header-anchor">#</a> 编写redis配置类,对key value进行序列化(实体类需实现Serializable接口)</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author zdk
 * @date 2021/7/18 21:08
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;myRedisTemplate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//key采用string的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//value采用Jackson序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//hash的key也采用string的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//value序列化方式采用Jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;myStringRedisTemplate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//key采用string的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//value采用string的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h5 id="编写redis常用操作工具类"><a href="#编写redis常用操作工具类" class="header-anchor">#</a> 编写redis常用操作工具类</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author zdk
 * @date 2021/7/19 9:56
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisUtil</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;myRedisTemplate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;myStringRedisTemplate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>

    <span class="token comment">// =============================common============================</span>
    <span class="token comment">/**
     * 指定缓存失效时间
     * @param key 键
     * @param time 时间(秒)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据key 获取过期时间
     * @param key 键 不能为null
     * @return 时间(秒) 返回0代表为永久有效
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getExpire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getExpire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 判断key是否存在
     * @param key 键
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除缓存
     * @param key 可以传一个值 或多个
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">arrayToList</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ============================String=============================</span>
    <span class="token comment">/**
     * 普通缓存获取
     * @param key 键
     * @return 值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 普通缓存放入
     * @param key 键
     * @param value 值
     * @return true成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 普通缓存放入并设置时间
     * @param key 键
     * @param value 值
     * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期
     * @return true成功 false 失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 递增
     * @param key 键
     * @param delta 要增加几(大于0)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;递增因子必须大于0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 递减
     * @param key 键
     * @param delta 要减少几(小于0)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">decr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;递减因子必须大于0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token operator">-</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ================================Map=================================</span>
    <span class="token comment">/**
     * HashGet
     * @param key 键 不能为null
     * @param item 项 不能为null
     * @return 值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">hget</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取hashKey对应的所有键值
     * @param key 键
     * @return 对应的多个键值
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">hmget</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * HashSet
     * @param key 键
     * @param map 对应多个键值
     * @return true 成功 false 失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * HashSet 并设置时间
     * @param key 键
     * @param map 对应多个键值
     * @param time 时间(秒)
     * @return true成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 向一张hash表中放入数据,如果不存在将创建
     * @param key 键
     * @param item 项
     * @param value 值
     * @return true 成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 向一张hash表中放入数据,如果不存在将创建
     * @param key 键
     * @param item 项
     * @param value 值
     * @param time 时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间
     * @return true 成功 false失败
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除hash表中的值
     * @param key 键 不能为null
     * @param item 项 可以使多个 不能为null
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hdel</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 判断hash表中是否有该项的值
     * @param key 键 不能为null
     * @param item 项 不能为null
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hHasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
     * @param key 键
     * @param item 项
     * @param by 要增加几(大于0)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hincr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> by<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * hash递减
     * @param key 键
     * @param item 项
     * @param by 要减少记(小于0)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hdecr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">-</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ============================set=============================</span>
    <span class="token comment">/**
     * 根据key获取Set中的所有值
     * @param key 键
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">sGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据value从一个set中查询,是否存在
     * @param key 键
     * @param value 值
     * @return true 存在 false不存在
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">sHasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isMember</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将数据放入set缓存
     * @param key 键
     * @param values 值 可以是多个
     * @return 成功个数
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">sSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将set数据放入缓存
     * @param key 键
     * @param time 时间(秒)
     * @param values 值 可以是多个
     * @return 成功个数
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">sSetAndTime</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取set缓存的长度
     * @param key 键
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">sGetSetSize</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 移除值为value的
     * @param key 键
     * @param values 值 可以是多个
     * @return 移除的个数
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">setRemove</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ===============================list=================================</span>

    <span class="token comment">/**
     * 获取list缓存的内容
     * @param key 键
     * @param start 开始
     * @param end 结束 0 到 -1代表所有值
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">lGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取list缓存的长度
     * @param key 键
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">lGetListSize</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 通过索引 获取list中的值
     * @param key 键
     * @param index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">lGetIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @param time 时间(秒)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将list放入缓存
     *
     * @param key 键
     * @param value 值
     * @param time 时间(秒)
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据索引修改list中的某条数据
     * @param key 键
     * @param index 索引
     * @param value 值
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lUpdateIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 移除N个值为value
     * @param key 键
     * @param count 移除多少个
     * @param value 值
     * @return 移除的个数
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">lRemove</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> count<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ===============================zset=================================</span>


    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">zAdd</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">Object</span> value<span class="token punctuation">,</span><span class="token keyword">double</span> score<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">zRange</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token keyword">long</span> start<span class="token punctuation">,</span><span class="token keyword">long</span> stop<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> start<span class="token punctuation">,</span> stop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">zRangeByScore</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token keyword">double</span> min<span class="token punctuation">,</span><span class="token keyword">double</span> max<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rangeByScore</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> min<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">zRangeAll</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br></div></div><h4 id="redis各种数据结构使用场景总结"><a href="#redis各种数据结构使用场景总结" class="header-anchor">#</a> redis各种数据结构使用场景总结</h4> <ol><li>String：value除了可以是字符串还能是数字
<ul><li>计数器：incr</li> <li>统计多单位的数量</li> <li>粉丝数</li> <li>对象缓存存储</li></ul></li> <li>List：
<ul><li>消息排队</li> <li>消息队列(Lpush,Rpop)</li> <li>栈(Lpush,Lpop)</li></ul></li> <li>Set：
<ul><li>将每个用户关注的人放入一个set，粉丝放入一个set，可以使用sinter获取他们的共同关注</li> <li>共同爱好</li></ul></li> <li>hash
<ul><li>更适合储存对象(易变更的数据)</li></ul></li> <li>zset
<ul><li>set排序</li> <li>储存班级成绩表、工资表排序</li> <li>消息排序，用权重判断是否重要</li> <li>排行榜应用实现，取TopN测试</li></ul></li> <li>Geospatial
<ul><li>地理位置</li> <li>附近的人</li></ul></li> <li>bitmap
<ul><li>网站、游戏签到</li> <li>网站每天访问人数统计</li> <li>指定用户是否在某一天访问了</li></ul></li></ol> <h4 id="redis持久化"><a href="#redis持久化" class="header-anchor">#</a> redis持久化</h4> <ol><li><p>RDB(Redis DataBase)</p> <p><img src="https://images.zaiolos.top/images/image-20211101133513460.png" alt="image-20211101133513460"></p> <blockquote><p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是Snapshot快照，它恢复时是将快照文件直接读到内存里。</p> <p>Redis会单独创建 ( fork )一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。</p> <p>整个过程中，主进程是不进行任何I0操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p></blockquote> <span class="badge tip" style="vertical-align:top;" data-v-d5affa18>RDB保存的文件是dump.rdb</span> <ul><li><p>触发规则：</p> <ol><li>save的规则满足的情况下，会自动触发rdb规则</li> <li>执行flushall命令，也会触发rdb</li> <li>退出redis服务，也会产生rdb文件</li></ol> <p>备份就自动生成一个dump.rdb</p></li> <li><p>如何恢复数据：</p> <ol><li><p>只需将rdb文件放在redis启动目录下，redis会自动检查恢复dump.rdb中的数据</p></li> <li><p>查看需要存在的位置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get <span class="token function">dir</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;dir&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;/usr/local/redis/bin&quot;</span> <span class="token comment">#如果在此目录下存在dump.rdb文件，redis会自动恢复其中的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol></li></ul> <p>优点：</p> <ul><li>适合大规模的数据恢复</li> <li>适用于对数据完整性要求不高的情况</li></ul> <p>缺点：</p> <ul><li>需要一定的时间间隔进行操作。如果redis意外宕机，最后一次修改的数据就没了</li> <li>fork进程的时候，会占用一定的内存</li></ul></li> <li><p>AOF(Append Only File)</p> <blockquote><p>将所有写入的命令都记录下来，储存在文件中，恢复的时候就把文件中的命令全部执行一次。
以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p></blockquote> <p><img src="https://images.zaiolos.top/images/image-20211101133519677.png" alt="image-20211101133519677"></p> <p><strong>AOF保存的是appendonly.aof文件</strong></p> <p>AOF在redis.conf中的配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>appendonly no <span class="token comment">#默认是不开启的</span>
<span class="token comment"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span> <span class="token comment">#保存的文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#AOF持久化策略</span>

appendfsync always <span class="token comment">#每次修改都会执行一次sync，会消耗更多性能</span>
appendfsync everysec <span class="token comment">#每一秒执行一次sync，可能会丢失这一秒的数据</span>
appendfsync no <span class="token comment">#不执行sync，这时操作系统自己同步数据，速度最快</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#自动重写的规则</span>
no-appendfsync-on-rewrite no  <span class="token comment">#是否开启文件重写</span>
auto-aof-rewrite-percentage <span class="token number">100</span> <span class="token comment">#重写的精确值</span>

<span class="token comment">#重写的文件最小值，如果文件超过这个值，就会fork一个新的进程来将文件进行重写</span>
auto-aof-rewrite-min-size 64mb 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>开启appendonly yes后重启redis即可生效，重启时如果没有appendonly.aof文件，会自动生成一个

如果原来的aof文件有错误，此时redis是不能启动的。需要运行 redis-check-aof <span class="token parameter variable">--fix</span> appendonly.aof
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>优点：</p> <ul><li>每次修改都会同步，数据的完整性更好</li> <li>每秒同步一次，只可能会丢失一秒的数据</li> <li>从不同步的话，效率最高</li></ul> <p>缺点：</p> <ul><li>aof文件远大于rdb，修复速度更慢</li> <li>aof是io操作，运行效率也要比rdb慢，所以redis默认配置是rdb而不是aof</li></ul> <p>扩展：</p> <ol><li>RDB持久化方式能够在指定的时间间隔内对你的数据进行快照存储</li> <li>AOF持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。</li> <li><strong>只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</strong></li> <li>同时开启两种持久化方式
<ul><li>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</li> <li>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢?作者建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份），快速重启，而且不会有AOF可能潜在的Bug，留着作为一个万一的手段。</li></ul></li> <li>性能建议
<ul><li>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则。</li> <li>如果Enable AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了，代价一是带来了持续的lO，二是AOFrewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重写可以改到适当的数值。</li> <li>如果不Enable AOF，仅靠Master-Slave Repllcation实现高可用性也可以，能省掉一大笔IO，也减少了rewrite时带来的系统波动。代价是如果Master/Slave同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</li></ul></li></ol></li></ol> <h3 id="redis的发布和订阅"><a href="#redis的发布和订阅" class="header-anchor">#</a> Redis的发布和订阅</h3> <h4 id="什么是发布和订阅"><a href="#什么是发布和订阅" class="header-anchor">#</a> 什么是发布和订阅</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Redis发布订阅<span class="token punctuation">(</span>pub/sub<span class="token punctuation">)</span>是一种消息通信模式：发送者<span class="token punctuation">(</span>pub<span class="token punctuation">)</span>发送消息，订阅者<span class="token punctuation">(</span>sub<span class="token punctuation">)</span>接收消息
Redis客户端可以订阅任意数量的频道
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="发布订阅命令行实现-广发用于构建即时通信应用-如网络聊天室-chatroom-和实时广播、实时提醒等"><a href="#发布订阅命令行实现-广发用于构建即时通信应用-如网络聊天室-chatroom-和实时广播、实时提醒等" class="header-anchor">#</a> 发布订阅命令行实现(广发用于构建即时通信应用，如网络聊天室(chatroom)和实时广播、实时提醒等)</h4> <ul><li>PSUBSCRIBE pattern [pattern ...]：订阅一个或多个符合给定模式的频道</li> <li>PUBSUB subcommand [argument [argument ...]]：查看订阅和发布系统状态</li> <li>PUBLISH channel message：将消息发送到指定的频道</li> <li>PUNSUBSCRIBE [pattern [pattern ...]]：退订所有给定模式的频道</li> <li>SUBSCRIBE channel [channel...]：订阅给定的一个或多个频道的信息</li> <li>UNSUBSCRIBE [channel [channel...]]：退订给定的频道</li></ul> <ol><li><p>打开一个客户端订阅一个频道为channel1</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SUBSCRIBE channel1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://images.zaiolos.top/images/image-20211101133528305.png" alt="image-20211101133528305"></p></li> <li><p>打开另一个客户端，给channel1发布消息hello</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>publish channel1 hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://images.zaiolos.top/images/image-20211101133533705.png" alt="image-20211101133533705"></p> <p>发布成功返回的是订阅者的数量</p></li> <li><p>订阅了channel1的订阅者收到消息</p> <p><img src="https://images.zaiolos.top/images/image-20211101133538886.png" alt="image-20211101133538886"></p> <p>注：发布的消息没有持久化，没有订阅的客户端收不到hello，只能收到订阅后channel1发布的消息</p></li></ol> <p>发布订阅的原理：</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>Redis是使用C实现的，通过分析Redis 源码里的pubsub.c文件，了解发布和订阅机制的底层实现，籍此加深对Redis的理解。Redis 通过PUBLISH、SUBSCRIBE和PSUBSCRIBE等命令实现发布和订阅功能。
通过SUBSCRIBE命令订阅某频道后，redis-server里维护了一个字典，字典的键就是一个个channel，而字典的值则是一个链表，链表中保存了所有订阅这个channel的客户端。SUBSCRIBE命令的关键，就是将客户端添加到给定channel的订阅链表中。通过PUBLISH命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的channel字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。
Pub/Sub从字面上理解就是发布( Publish )与订阅(Subscribe )，在Redis中，你可以设定对某一个key值进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p></div> <p><strong>使用场景：</strong></p> <ul><li>实时消息系统(网站的消息推送)</li> <li>实时聊天(频道当做聊天室，将信息回显给所有人)</li> <li>订阅，关注系统</li></ul> <p>更复杂的场景就会使用消息中间件：MQ 等</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hnistzdk/my-notes/edit/master/docs/03.数据库/10.Redis/01.Redis全笔记.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/my-notes/tags/?tag=Redis" title="标签">#Redis</a></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2022/10/04, 8:10:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/my-notes/redis/" class="page-nav-centre page-nav-centre-prev router-link-active"><div class="tooltip">Redis - 知识体系</div></a> <a href="/my-notes/redis/1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Redis - 概念和基础</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/my-notes/redis/" class="prev router-link-active">Redis - 知识体系</a></span> <span class="next"><a href="/my-notes/redis/1/">Redis - 概念和基础</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:369365576@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-gitee"></a><a href="http://music.163.com/playlist?id=936642760&amp;userid=604011130" title="普通歌单" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>zdk | notes <br><a href=http://beian.miit.gov.cn/>湘ICP备2022001117号-1</a><br><img src=/img/ghs.png /><a href=http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51142102511562>川公网安备 51142102511562号</a><br><a href=https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referra><img src=/img/upyun.png align=absmiddle width=70px height=30px /></a> <span> 提供加速服务 </span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div id="goTop" class="hide-cat" data-v-bf92849a></div><div></div><div></div></div></div>
    <script src="/my-notes/assets/js/app.7f931ee0.js" defer></script><script src="/my-notes/assets/js/2.e52a17f8.js" defer></script><script src="/my-notes/assets/js/77.61eb4f51.js" defer></script><script src="/my-notes/assets/js/8.c2fa6f68.js" defer></script><script src="/my-notes/assets/js/6.bcc16901.js" defer></script>
  </body>
</html>
