<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nacos | DK&#39;s Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/my-notes/img/logo.jpg">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334662_k54hl9700p.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="/my-notes//at.alicdn.com/t/font_3334691_b03dsaqrwck.css">
    <meta name="description" content="时不我待，舍我其谁">
    <meta name="keywords" content="Java">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/my-notes/assets/css/0.styles.565c6041.css" as="style"><link rel="preload" href="/my-notes/assets/js/app.7f931ee0.js" as="script"><link rel="preload" href="/my-notes/assets/js/2.e52a17f8.js" as="script"><link rel="preload" href="/my-notes/assets/js/139.068ed7d7.js" as="script"><link rel="preload" href="/my-notes/assets/js/8.c2fa6f68.js" as="script"><link rel="preload" href="/my-notes/assets/js/6.bcc16901.js" as="script"><link rel="prefetch" href="/my-notes/assets/js/10.fee8f7ec.js"><link rel="prefetch" href="/my-notes/assets/js/100.9be19fac.js"><link rel="prefetch" href="/my-notes/assets/js/101.9aaae740.js"><link rel="prefetch" href="/my-notes/assets/js/102.a72c0165.js"><link rel="prefetch" href="/my-notes/assets/js/103.d47527c3.js"><link rel="prefetch" href="/my-notes/assets/js/104.d5bae560.js"><link rel="prefetch" href="/my-notes/assets/js/105.fdb07f67.js"><link rel="prefetch" href="/my-notes/assets/js/106.b89b7d37.js"><link rel="prefetch" href="/my-notes/assets/js/107.a9d142eb.js"><link rel="prefetch" href="/my-notes/assets/js/108.1b8c8817.js"><link rel="prefetch" href="/my-notes/assets/js/109.0cd465a0.js"><link rel="prefetch" href="/my-notes/assets/js/11.75b40e53.js"><link rel="prefetch" href="/my-notes/assets/js/110.4c56723c.js"><link rel="prefetch" href="/my-notes/assets/js/111.12b9cb85.js"><link rel="prefetch" href="/my-notes/assets/js/112.3f791546.js"><link rel="prefetch" href="/my-notes/assets/js/113.d9998b70.js"><link rel="prefetch" href="/my-notes/assets/js/114.faf0da70.js"><link rel="prefetch" href="/my-notes/assets/js/115.35d9b5f6.js"><link rel="prefetch" href="/my-notes/assets/js/116.13fbe1ab.js"><link rel="prefetch" href="/my-notes/assets/js/117.bffe4459.js"><link rel="prefetch" href="/my-notes/assets/js/118.eabefad3.js"><link rel="prefetch" href="/my-notes/assets/js/119.8593c8a5.js"><link rel="prefetch" href="/my-notes/assets/js/12.34db197a.js"><link rel="prefetch" href="/my-notes/assets/js/120.f5b73620.js"><link rel="prefetch" href="/my-notes/assets/js/121.d3137f51.js"><link rel="prefetch" href="/my-notes/assets/js/122.f47bca90.js"><link rel="prefetch" href="/my-notes/assets/js/123.6d846b88.js"><link rel="prefetch" href="/my-notes/assets/js/124.49825ebc.js"><link rel="prefetch" href="/my-notes/assets/js/125.6d3a9ce5.js"><link rel="prefetch" href="/my-notes/assets/js/126.eeef761b.js"><link rel="prefetch" href="/my-notes/assets/js/127.0f7e28c1.js"><link rel="prefetch" href="/my-notes/assets/js/128.4a35f42a.js"><link rel="prefetch" href="/my-notes/assets/js/129.e364bc33.js"><link rel="prefetch" href="/my-notes/assets/js/13.ab02aa59.js"><link rel="prefetch" href="/my-notes/assets/js/130.1299fc06.js"><link rel="prefetch" href="/my-notes/assets/js/131.61faa498.js"><link rel="prefetch" href="/my-notes/assets/js/132.9e46a3c4.js"><link rel="prefetch" href="/my-notes/assets/js/133.0b6e6f7f.js"><link rel="prefetch" href="/my-notes/assets/js/134.6724b7a7.js"><link rel="prefetch" href="/my-notes/assets/js/135.1d3daca0.js"><link rel="prefetch" href="/my-notes/assets/js/136.190f2a28.js"><link rel="prefetch" href="/my-notes/assets/js/137.5ce96397.js"><link rel="prefetch" href="/my-notes/assets/js/138.c0b55b02.js"><link rel="prefetch" href="/my-notes/assets/js/14.721e1994.js"><link rel="prefetch" href="/my-notes/assets/js/140.5226be4f.js"><link rel="prefetch" href="/my-notes/assets/js/141.196d1aa6.js"><link rel="prefetch" href="/my-notes/assets/js/142.11cbb52f.js"><link rel="prefetch" href="/my-notes/assets/js/143.509f8300.js"><link rel="prefetch" href="/my-notes/assets/js/144.436415bf.js"><link rel="prefetch" href="/my-notes/assets/js/145.a25cd8bc.js"><link rel="prefetch" href="/my-notes/assets/js/146.a2d1d780.js"><link rel="prefetch" href="/my-notes/assets/js/147.1cac4e0a.js"><link rel="prefetch" href="/my-notes/assets/js/148.5c361eba.js"><link rel="prefetch" href="/my-notes/assets/js/149.f62eacfa.js"><link rel="prefetch" href="/my-notes/assets/js/15.35ef567c.js"><link rel="prefetch" href="/my-notes/assets/js/150.80b0aa20.js"><link rel="prefetch" href="/my-notes/assets/js/151.6f0e31d8.js"><link rel="prefetch" href="/my-notes/assets/js/152.86efa86d.js"><link rel="prefetch" href="/my-notes/assets/js/153.d6605e26.js"><link rel="prefetch" href="/my-notes/assets/js/154.e5b33cc7.js"><link rel="prefetch" href="/my-notes/assets/js/155.5d3cf278.js"><link rel="prefetch" href="/my-notes/assets/js/156.bcb9784f.js"><link rel="prefetch" href="/my-notes/assets/js/157.ca3b8e8c.js"><link rel="prefetch" href="/my-notes/assets/js/158.eb0116b8.js"><link rel="prefetch" href="/my-notes/assets/js/159.309a26da.js"><link rel="prefetch" href="/my-notes/assets/js/16.ca698d39.js"><link rel="prefetch" href="/my-notes/assets/js/160.ce6e9321.js"><link rel="prefetch" href="/my-notes/assets/js/161.ac24f13a.js"><link rel="prefetch" href="/my-notes/assets/js/162.c3390211.js"><link rel="prefetch" href="/my-notes/assets/js/163.8267154f.js"><link rel="prefetch" href="/my-notes/assets/js/164.3ce822f9.js"><link rel="prefetch" href="/my-notes/assets/js/165.80836bd1.js"><link rel="prefetch" href="/my-notes/assets/js/166.7346e59a.js"><link rel="prefetch" href="/my-notes/assets/js/167.5577b6af.js"><link rel="prefetch" href="/my-notes/assets/js/168.23aca72c.js"><link rel="prefetch" href="/my-notes/assets/js/169.ce891665.js"><link rel="prefetch" href="/my-notes/assets/js/17.549cfc80.js"><link rel="prefetch" href="/my-notes/assets/js/170.b4aebdaf.js"><link rel="prefetch" href="/my-notes/assets/js/171.39cdd90b.js"><link rel="prefetch" href="/my-notes/assets/js/172.06cd5671.js"><link rel="prefetch" href="/my-notes/assets/js/173.44c7c161.js"><link rel="prefetch" href="/my-notes/assets/js/174.62d8a34f.js"><link rel="prefetch" href="/my-notes/assets/js/175.baa645ac.js"><link rel="prefetch" href="/my-notes/assets/js/176.8361f852.js"><link rel="prefetch" href="/my-notes/assets/js/177.4a8f2fec.js"><link rel="prefetch" href="/my-notes/assets/js/178.f594def6.js"><link rel="prefetch" href="/my-notes/assets/js/179.2338f129.js"><link rel="prefetch" href="/my-notes/assets/js/18.a8b4f826.js"><link rel="prefetch" href="/my-notes/assets/js/180.1b2f62df.js"><link rel="prefetch" href="/my-notes/assets/js/181.10759f41.js"><link rel="prefetch" href="/my-notes/assets/js/182.c0e1c3c5.js"><link rel="prefetch" href="/my-notes/assets/js/183.bdc8283f.js"><link rel="prefetch" href="/my-notes/assets/js/184.30a6f685.js"><link rel="prefetch" href="/my-notes/assets/js/185.1949079b.js"><link rel="prefetch" href="/my-notes/assets/js/186.bb7c7093.js"><link rel="prefetch" href="/my-notes/assets/js/187.1d02d132.js"><link rel="prefetch" href="/my-notes/assets/js/188.5230fbeb.js"><link rel="prefetch" href="/my-notes/assets/js/189.2931d469.js"><link rel="prefetch" href="/my-notes/assets/js/19.16e1a44c.js"><link rel="prefetch" href="/my-notes/assets/js/190.9bd3b616.js"><link rel="prefetch" href="/my-notes/assets/js/191.d75de9d3.js"><link rel="prefetch" href="/my-notes/assets/js/192.dacb160e.js"><link rel="prefetch" href="/my-notes/assets/js/193.660b4fce.js"><link rel="prefetch" href="/my-notes/assets/js/194.45f8499e.js"><link rel="prefetch" href="/my-notes/assets/js/195.e91d4663.js"><link rel="prefetch" href="/my-notes/assets/js/196.e94176ac.js"><link rel="prefetch" href="/my-notes/assets/js/197.5acbb43f.js"><link rel="prefetch" href="/my-notes/assets/js/198.dc1a1207.js"><link rel="prefetch" href="/my-notes/assets/js/199.288adcec.js"><link rel="prefetch" href="/my-notes/assets/js/20.b19ef4b2.js"><link rel="prefetch" href="/my-notes/assets/js/200.3d318d2e.js"><link rel="prefetch" href="/my-notes/assets/js/21.e3682738.js"><link rel="prefetch" href="/my-notes/assets/js/22.fafa8b54.js"><link rel="prefetch" href="/my-notes/assets/js/23.9d683b40.js"><link rel="prefetch" href="/my-notes/assets/js/24.02c0c08c.js"><link rel="prefetch" href="/my-notes/assets/js/25.af427f02.js"><link rel="prefetch" href="/my-notes/assets/js/26.50a41828.js"><link rel="prefetch" href="/my-notes/assets/js/27.8f1d2fe6.js"><link rel="prefetch" href="/my-notes/assets/js/28.7f820229.js"><link rel="prefetch" href="/my-notes/assets/js/29.208cdce3.js"><link rel="prefetch" href="/my-notes/assets/js/3.32ea0d41.js"><link rel="prefetch" href="/my-notes/assets/js/30.e7a171d3.js"><link rel="prefetch" href="/my-notes/assets/js/31.8ee9f363.js"><link rel="prefetch" href="/my-notes/assets/js/32.b33ae00e.js"><link rel="prefetch" href="/my-notes/assets/js/33.3a961845.js"><link rel="prefetch" href="/my-notes/assets/js/34.46f30eb6.js"><link rel="prefetch" href="/my-notes/assets/js/35.dedda1f7.js"><link rel="prefetch" href="/my-notes/assets/js/36.fb63ded5.js"><link rel="prefetch" href="/my-notes/assets/js/37.321340a9.js"><link rel="prefetch" href="/my-notes/assets/js/38.c21281dd.js"><link rel="prefetch" href="/my-notes/assets/js/39.01776b7e.js"><link rel="prefetch" href="/my-notes/assets/js/4.2466bf2a.js"><link rel="prefetch" href="/my-notes/assets/js/40.c6763f18.js"><link rel="prefetch" href="/my-notes/assets/js/41.afa4c2f3.js"><link rel="prefetch" href="/my-notes/assets/js/42.187357b5.js"><link rel="prefetch" href="/my-notes/assets/js/43.90030eae.js"><link rel="prefetch" href="/my-notes/assets/js/44.e11eff59.js"><link rel="prefetch" href="/my-notes/assets/js/45.760e3e3f.js"><link rel="prefetch" href="/my-notes/assets/js/46.0eccc1a4.js"><link rel="prefetch" href="/my-notes/assets/js/47.30e063f8.js"><link rel="prefetch" href="/my-notes/assets/js/48.5ab681d2.js"><link rel="prefetch" href="/my-notes/assets/js/49.5921c987.js"><link rel="prefetch" href="/my-notes/assets/js/5.56264475.js"><link rel="prefetch" href="/my-notes/assets/js/50.a53fa873.js"><link rel="prefetch" href="/my-notes/assets/js/51.5cded08c.js"><link rel="prefetch" href="/my-notes/assets/js/52.8960c473.js"><link rel="prefetch" href="/my-notes/assets/js/53.2ac21c0e.js"><link rel="prefetch" href="/my-notes/assets/js/54.361bc2f3.js"><link rel="prefetch" href="/my-notes/assets/js/55.3853b7f3.js"><link rel="prefetch" href="/my-notes/assets/js/56.754a3b4c.js"><link rel="prefetch" href="/my-notes/assets/js/57.1d9684e7.js"><link rel="prefetch" href="/my-notes/assets/js/58.0e7f2b60.js"><link rel="prefetch" href="/my-notes/assets/js/59.b37ab2f4.js"><link rel="prefetch" href="/my-notes/assets/js/60.f31d0aea.js"><link rel="prefetch" href="/my-notes/assets/js/61.5aebeb50.js"><link rel="prefetch" href="/my-notes/assets/js/62.cebf26d6.js"><link rel="prefetch" href="/my-notes/assets/js/63.6c7932ca.js"><link rel="prefetch" href="/my-notes/assets/js/64.cad8a013.js"><link rel="prefetch" href="/my-notes/assets/js/65.25e4c14e.js"><link rel="prefetch" href="/my-notes/assets/js/66.e9c81af6.js"><link rel="prefetch" href="/my-notes/assets/js/67.31cbef00.js"><link rel="prefetch" href="/my-notes/assets/js/68.edc93332.js"><link rel="prefetch" href="/my-notes/assets/js/69.5eaf1e4f.js"><link rel="prefetch" href="/my-notes/assets/js/7.5a6eeb6c.js"><link rel="prefetch" href="/my-notes/assets/js/70.7114cd64.js"><link rel="prefetch" href="/my-notes/assets/js/71.2066867c.js"><link rel="prefetch" href="/my-notes/assets/js/72.0f93cb73.js"><link rel="prefetch" href="/my-notes/assets/js/73.6c4d69ec.js"><link rel="prefetch" href="/my-notes/assets/js/74.0a91fc3c.js"><link rel="prefetch" href="/my-notes/assets/js/75.47e45f38.js"><link rel="prefetch" href="/my-notes/assets/js/76.99886a8d.js"><link rel="prefetch" href="/my-notes/assets/js/77.61eb4f51.js"><link rel="prefetch" href="/my-notes/assets/js/78.eff53df7.js"><link rel="prefetch" href="/my-notes/assets/js/79.e5d77573.js"><link rel="prefetch" href="/my-notes/assets/js/80.8ac4e931.js"><link rel="prefetch" href="/my-notes/assets/js/81.82416621.js"><link rel="prefetch" href="/my-notes/assets/js/82.b7cea701.js"><link rel="prefetch" href="/my-notes/assets/js/83.eb0065f7.js"><link rel="prefetch" href="/my-notes/assets/js/84.45596ac9.js"><link rel="prefetch" href="/my-notes/assets/js/85.73902eef.js"><link rel="prefetch" href="/my-notes/assets/js/86.05a157f2.js"><link rel="prefetch" href="/my-notes/assets/js/87.83218f21.js"><link rel="prefetch" href="/my-notes/assets/js/88.bf05ee49.js"><link rel="prefetch" href="/my-notes/assets/js/89.089b5c96.js"><link rel="prefetch" href="/my-notes/assets/js/9.4a5b4024.js"><link rel="prefetch" href="/my-notes/assets/js/90.dc0b55a6.js"><link rel="prefetch" href="/my-notes/assets/js/91.ddc7da4f.js"><link rel="prefetch" href="/my-notes/assets/js/92.2b5c7d5f.js"><link rel="prefetch" href="/my-notes/assets/js/93.934a02e9.js"><link rel="prefetch" href="/my-notes/assets/js/94.3a6ede23.js"><link rel="prefetch" href="/my-notes/assets/js/95.0e946220.js"><link rel="prefetch" href="/my-notes/assets/js/96.3861fb05.js"><link rel="prefetch" href="/my-notes/assets/js/97.8627cefa.js"><link rel="prefetch" href="/my-notes/assets/js/98.6e0ee750.js"><link rel="prefetch" href="/my-notes/assets/js/99.5df99b25.js">
    <link rel="stylesheet" href="/my-notes/assets/css/0.styles.565c6041.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notes/" class="home-link router-link-active"><img src="/my-notes/img/logo.jpg" alt="DK's Notes" class="logo"> <span class="site-name can-hide">DK's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">Java基础</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-多线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link">多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-java8新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8新特性</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java虚拟机</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link router-link-active">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">秒杀项目</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><a href="/my-notes/git/" class="link-title">工具|部署</a> <span class="title" style="display:none;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试|刷题" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">面试|刷题</a> <span class="title" style="display:none;">面试|刷题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">刷题</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">开发问题😈</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">关于💕</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">归档🕛</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.jpg"> <div class="blogger-info"><h3>风</h3> <span>摸鱼</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/my-notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/my-notes/about/website/tools/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/my-notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/base/" class="nav-link">Java基础</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-多线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/thread/" class="nav-link">多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶-java8新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/java/se/java8/" class="nav-link">java8新特性</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java虚拟机</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/JVM/" class="nav-link">JVM</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/my-notes/mysql/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/my-notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/my-notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/my-notes/mybatis/study-note/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ORM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/my-notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/Spring/study-note/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>SpringMVC</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/1/" class="nav-link">SpringMVC1</a></li><li class="dropdown-subitem"><a href="/my-notes/SpringMvc/study-note/2/" class="nav-link">SpringMVC2</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/SpringCloud/" class="nav-link router-link-active">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/my-notes/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/my-notes/dubbo/" class="nav-link">Dubbo</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/my-notes/project/seckill/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/project/seckill/" class="nav-link">秒杀项目</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><a href="/my-notes/git/" class="link-title">工具|部署</a> <span class="title" style="display:none;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/my-notes/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/my-notes/JWT/note/" class="nav-link">JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试|刷题" class="dropdown-title"><a href="/my-notes/work/interview/" class="link-title">面试|刷题</a> <span class="title" style="display:none;">面试|刷题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-notes/work/interview/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/my-notes/work/algorithm/" class="nav-link">刷题</a></li></ul></div></div><div class="nav-item"><a href="/my-notes/dev/question/" class="nav-link">开发问题😈</a></div><div class="nav-item"><a href="/my-notes/designPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/my-notes/about/" class="nav-link">关于💕</a></div><div class="nav-item"><a href="/my-notes/archives/" class="nav-link">归档🕛</a></div> <a href="https://github.com/hnistzdk/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mybatis-plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMvc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RabbitMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dubbo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-notes/SpringCloud/" aria-current="page" class="sidebar-link">SpringCloud知识体系</a></li><li><a href="/my-notes/SpringCloud/Eureka/" class="sidebar-link">Eureka</a></li><li><a href="/my-notes/SpringCloud/ZookeeperAndConsul/" class="sidebar-link">ZookeeperAndConsul</a></li><li><a href="/my-notes/SpringCloud/ribbon/" class="sidebar-link">Ribbn</a></li><li><a href="/my-notes/SpringCloud/OpenFeign/" class="sidebar-link">OpenFeign</a></li><li><a href="/my-notes/SpringCloud/Hystrix/" class="sidebar-link">Hystrix</a></li><li><a href="/my-notes/SpringCloud/Gateway/" class="sidebar-link">Gateway</a></li><li><a href="/my-notes/SpringCloud/Config/" class="sidebar-link">Config</a></li><li><a href="/my-notes/SpringCloud/Bus/" class="sidebar-link">Bus</a></li><li><a href="/my-notes/SpringCloud/Stream/" class="sidebar-link">Stream</a></li><li><a href="/my-notes/SpringCloud/Sleuth/" class="sidebar-link">Sleuth</a></li><li><a href="/my-notes/SpringCloud/Nacos/" aria-current="page" class="active sidebar-link">Nacos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/my-notes/SpringCloud/Nacos/#nacos简介" class="sidebar-link">Nacos简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#为什么叫nacos" class="sidebar-link">为什么叫Nacos</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#是什么" class="sidebar-link">是什么</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#能干嘛" class="sidebar-link">能干嘛</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/my-notes/SpringCloud/Nacos/#安装并运行nacos" class="sidebar-link">安装并运行Nacos</a></li><li class="sidebar-sub-header level2"><a href="/my-notes/SpringCloud/Nacos/#nacos作为服务注册中心演示" class="sidebar-link">Nacos作为服务注册中心演示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#服务提供者" class="sidebar-link">服务提供者</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#pom" class="sidebar-link">pom</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#yaml" class="sidebar-link">yaml</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#主启动类" class="sidebar-link">主启动类</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#controller" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#服务消费者" class="sidebar-link">服务消费者</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#pom-2" class="sidebar-link">pom</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#yaml-2" class="sidebar-link">yaml</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#业务类" class="sidebar-link">业务类</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#注册中心对比" class="sidebar-link">注册中心对比</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#ap、cp切换" class="sidebar-link">AP、CP切换</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/my-notes/SpringCloud/Nacos/#nacos作为服务配置中心演示" class="sidebar-link">Nacos作为服务配置中心演示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#基础配置" class="sidebar-link">基础配置</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#pom-3" class="sidebar-link">pom</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#yaml-3" class="sidebar-link">yaml</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#主启动类-2" class="sidebar-link">主启动类</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#controller-2" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#在nacos中添加配置信息" class="sidebar-link">在Nacos中添加配置信息</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#nacos中的匹配规则" class="sidebar-link">Nacos中的匹配规则</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#在nacos进行添加配置" class="sidebar-link">在nacos进行添加配置</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#测试-2" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#分类配置" class="sidebar-link">分类配置</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#为什么这样设计" class="sidebar-link">为什么这样设计？</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#三种方案加载配置" class="sidebar-link">三种方案加载配置</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#dataid方案" class="sidebar-link">DataId方案</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#group方案" class="sidebar-link">Group方案</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#namespace方案" class="sidebar-link">Namespace方案</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/my-notes/SpringCloud/Nacos/#nacos集群和持久化配置-重要" class="sidebar-link">Nacos集群和持久化配置(重要)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#将单体nacos数据库迁移到mysql" class="sidebar-link">将单体Nacos数据库迁移到MySQL</a></li><li class="sidebar-sub-header level3"><a href="/my-notes/SpringCloud/Nacos/#linux版nacos-mysql生产环境配置" class="sidebar-link">Linux版Nacos+MySQL生产环境配置</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#linux安装步骤" class="sidebar-link">Linux安装步骤</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#集群配置步骤-重点" class="sidebar-link">集群配置步骤(重点)</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#mysql" class="sidebar-link">MySQL</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#cluster-conf" class="sidebar-link">cluster.conf</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#startup-sh脚本" class="sidebar-link">startup.sh脚本</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#nginx配置" class="sidebar-link">nginx配置</a></li><li class="sidebar-sub-header level4"><a href="/my-notes/SpringCloud/Nacos/#测试-3" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#测试注册功能" class="sidebar-link">测试注册功能</a></li><li class="sidebar-sub-header level5"><a href="/my-notes/SpringCloud/Nacos/#总结" class="sidebar-link">总结</a></li></ul></li></ul></li><li><a href="/my-notes/SpringCloud/Sentinel/" class="sidebar-link">Sentinel</a></li><li><a href="/my-notes/SpringCloud/Seata/" class="sidebar-link">Seata</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/my-notes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/my-notes/categories/?category=%E6%A1%86%E6%9E%B6" title="分类" data-v-06225672>框架</a></li><li data-v-06225672><a href="/my-notes/categories/?category=SpringCloud" title="分类" data-v-06225672>SpringCloud</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.zaiolos.top/" target="_blank" title="作者" class="beLink" data-v-06225672>zdk</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-11-15</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Nacos<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><strong>Table of Contents</strong> <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener noreferrer">DocToc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></p> <ul><li><a href="#nacos">Nacos</a> <ul><li><a href="#nacos%E7%AE%80%E4%BB%8B">Nacos简介</a> <ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%ABnacos">为什么叫Nacos</a></li> <li><a href="#%E6%98%AF%E4%BB%80%E4%B9%88">是什么</a></li> <li><a href="#%E8%83%BD%E5%B9%B2%E5%98%9B">能干嘛</a></li></ul></li> <li><a href="#%E5%AE%89%E8%A3%85%E5%B9%B6%E8%BF%90%E8%A1%8Cnacos">安装并运行Nacos</a></li> <li><a href="#nacos%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%BC%94%E7%A4%BA">Nacos作为服务注册中心演示</a> <ul><li><a href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85">服务提供者</a> <ul><li><a href="#pom">pom</a></li> <li><a href="#yaml">yaml</a></li> <li><a href="#%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB">主启动类</a></li> <li><a href="#controller">Controller</a></li></ul></li> <li><a href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85">服务消费者</a> <ul><li><a href="#pom-1">pom</a></li> <li><a href="#yaml-1">yaml</a></li> <li><a href="#%E4%B8%9A%E5%8A%A1%E7%B1%BB">业务类</a></li></ul></li> <li><a href="#%E6%B5%8B%E8%AF%95">测试</a></li> <li><a href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AF%B9%E6%AF%94">注册中心对比</a></li> <li><a href="#apcp%E5%88%87%E6%8D%A2">AP、CP切换</a></li></ul></li> <li><a href="#nacos%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E6%BC%94%E7%A4%BA">Nacos作为服务配置中心演示</a> <ul><li><a href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">基础配置</a> <ul><li><a href="#pom-2">pom</a></li> <li><a href="#yaml-2">yaml</a></li> <li><a href="#%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB-1">主启动类</a></li> <li><a href="#controller-1">Controller</a></li> <li><a href="#%E5%9C%A8nacos%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF">在Nacos中添加配置信息</a> <ul><li><a href="#nacos%E4%B8%AD%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99">Nacos中的匹配规则</a></li> <li><a href="#%E5%9C%A8nacos%E8%BF%9B%E8%A1%8C%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE">在nacos进行添加配置</a></li> <li><a href="#%E6%B5%8B%E8%AF%95-1">测试</a></li></ul></li></ul></li> <li><a href="#%E5%88%86%E7%B1%BB%E9%85%8D%E7%BD%AE">分类配置</a> <ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E6%A0%B7%E8%AE%BE%E8%AE%A1">为什么这样设计？</a></li> <li><a href="#%E4%B8%89%E7%A7%8D%E6%96%B9%E6%A1%88%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE">三种方案加载配置</a> <ul><li><a href="#dataid%E6%96%B9%E6%A1%88">DataId方案</a></li> <li><a href="#group%E6%96%B9%E6%A1%88">Group方案</a></li> <li><a href="#namespace%E6%96%B9%E6%A1%88">Namespace方案</a></li></ul></li></ul></li></ul></li> <li><a href="#nacos%E9%9B%86%E7%BE%A4%E5%92%8C%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE%E9%87%8D%E8%A6%81">Nacos集群和持久化配置(重要)</a> <ul><li><a href="#%E5%B0%86%E5%8D%95%E4%BD%93nacos%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB%E5%88%B0mysql">将单体Nacos数据库迁移到MySQL</a></li> <li><a href="#linux%E7%89%88nacosmysql%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">Linux版Nacos+MySQL生产环境配置</a> <ul><li><a href="#linux%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4">Linux安装步骤</a></li> <li><a href="#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4%E9%87%8D%E7%82%B9">集群配置步骤(重点)</a> <ul><li><a href="#mysql">MySQL</a></li> <li><a href="#clusterconf">cluster.conf</a></li> <li><a href="#startupsh%E8%84%9A%E6%9C%AC">startup.sh脚本</a></li> <li><a href="#nginx%E9%85%8D%E7%BD%AE">nginx配置</a></li></ul></li> <li><a href="#%E6%B5%8B%E8%AF%95-2">测试</a> <ul><li><a href="#%E6%B5%8B%E8%AF%95%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD">测试注册功能</a></li> <li><a href="#%E6%80%BB%E7%BB%93">总结</a></li></ul></li></ul></li></ul></li></ul></li></ul> <hr> <h1 id="nacos"><a href="#nacos" class="header-anchor">#</a> Nacos</h1> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>首先需要引入spring-cloud-alibaba-dependencies依赖管理</p></blockquote> <span class="badge error" style="vertical-align:top;" data-v-d5affa18>Nacos 服务注册与配置中心</span> <h2 id="nacos简介"><a href="#nacos简介" class="header-anchor">#</a> Nacos简介</h2> <h3 id="为什么叫nacos"><a href="#为什么叫nacos" class="header-anchor">#</a> 为什么叫Nacos</h3> <blockquote><p>前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service</p></blockquote> <h3 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么</h3> <ul><li>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台</li> <li>Nacos：Dynamic Naming and Configuration Service，即注册中心与配置中心的组合</li></ul> <h3 id="能干嘛"><a href="#能干嘛" class="header-anchor">#</a> 能干嘛</h3> <ul><li>替代Eureka作为注册中心</li> <li>替代Config作为配置中心</li></ul> <p><img src="https://images.zaiolos.top/images/202211151718636.png" alt="image-20221115171832488"></p> <h2 id="安装并运行nacos"><a href="#安装并运行nacos" class="header-anchor">#</a> 安装并运行Nacos</h2> <ul><li>从GitHub下载nacos-server-2.1.2.zip，(.tar.gz是Linux的)</li> <li>压解安装包，直接运行bin目录下的startup.cmd</li> <li>命令运行成功后直接访问：http://localhost:8848/nacos</li></ul> <p>这里要注意，运行时需要增加命令参数<code>-m standalone</code>，否则运行失败</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>startup.cmd <span class="token parameter variable">-m</span> standalone <span class="token comment"># 单机模式启动 因为默认是集群模式</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://images.zaiolos.top/images/202211151735954.png" alt="image-20221115173526865"></p> <h2 id="nacos作为服务注册中心演示"><a href="#nacos作为服务注册中心演示" class="header-anchor">#</a> Nacos作为服务注册中心演示</h2> <h3 id="服务提供者"><a href="#服务提供者" class="header-anchor">#</a> 服务提供者</h3> <blockquote><p>新建cloudalibaba-provider-payment9001模块</p></blockquote> <h4 id="pom"><a href="#pom" class="header-anchor">#</a> pom</h4> <blockquote><p>前面的父pom中要加cloud alibaba的父依赖，这里子pom相较以前，删除eureka的依赖，增加nacos的依赖</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--        通用的依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.zdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- nacos依赖 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="yaml"><a href="#yaml" class="header-anchor">#</a> yaml</h4> <blockquote><p>yaml主要就是配置nacos注册中心地址和actuator监控管理</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>
  
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
          
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span>         
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="主启动类"><a href="#主启动类" class="header-anchor">#</a> 主启动类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9001</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PaymentMain9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="controller"><a href="#controller" class="header-anchor">#</a> Controller</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;nacos registry, serverPort：&quot;</span><span class="token operator">+</span>serverPort<span class="token operator">+</span><span class="token string">&quot;\t id：&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>最后启动此9001服务，可以在nacos控制台中查看到服务注册情况</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211151750578.png" alt="image-20221115175037508"></p> <blockquote><p>最后，为了演示后面的nacos负载均衡功能，参照9001再建一个9002模块，步骤不再赘述，启动后可以发现nacos控制台<code>nacos-payment-provider</code>服务实例数量已变为2</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211151758907.png" alt="image-20221115175848839"></p> <h3 id="服务消费者"><a href="#服务消费者" class="header-anchor">#</a> 服务消费者</h3> <blockquote><p>新建消费者模块cloudalibaba-consumer-nacos-order83</p></blockquote> <h4 id="pom-2"><a href="#pom-2" class="header-anchor">#</a> pom</h4> <blockquote><p>将provider的pom复制过来，新增<code>spring-cloud-starter-loadbanlacer</code>的依赖</p> <p>这里要注意，我是用的2021.0.4.0版本cloud alibaba的nacos-discovery包中，已经去除掉了loadbanlacer的依赖，所以不能再直接进行rest+服务名的调用，且不支持了负载均衡，所以这里要测试的话还需要再将loadbanlacer的包进行引入，<strong>并且记得注入RestTemplate时加上<code>@LoadBalanced</code>注解</strong></p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- nacos依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- loadbalancer依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="yaml-2"><a href="#yaml-2" class="header-anchor">#</a> yaml</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>

<span class="token comment"># 用来在代码中获取provider服务地址</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>主启动类不多赘述</p></blockquote> <p>因为这里使用到了ribbon，所以需要注入一个RestTemplate的Bean</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">//必须加这个注解 才能使用服务名走注册中心进行rest调用</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="业务类"><a href="#业务类" class="header-anchor">#</a> 业务类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${service-url.nacos-user-service}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serviceUrl<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/consumer/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serviceUrl<span class="token operator">+</span><span class="token string">&quot;/payemnt/nacos/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>最后启动此消费者，nacos控制台出现它的信息即可</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211151832464.png" alt="image-20221115183213390"></p> <h3 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h3> <blockquote><p>三个服务均启动好，访问http://localhost:83/consumer/payment/nacos/1</p> <p>我们可以发现对于两个provider，是轮询访问</p></blockquote> <blockquote><p>这里其实就是引入一个负载均衡来测试注册中心，2021.1版本的nacos本身已不带有负载均衡</p></blockquote> <h3 id="注册中心对比"><a href="#注册中心对比" class="header-anchor">#</a> 注册中心对比</h3> <blockquote><p>nacos支持CP、AP模型的切换</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211151857285.png" alt="image-20221115185730171"></p> <p>nacos与其他注册中心特性对比</p> <table><thead><tr><th></th> <th>Nacos</th> <th>Eureka</th> <th>Consul</th> <th>CoreDNS</th> <th>Zookeeper</th></tr></thead> <tbody><tr><td>一致性协议</td> <td>CP、AP均可</td> <td>AP</td> <td>CP</td> <td>/</td> <td>CP</td></tr> <tr><td>健康检查</td> <td>TCP/HTTP/MYSQL/Client Beat</td> <td>Client Beat</td> <td>TCP/HTTP/gRPC/Cmd</td> <td>/</td> <td>Client Beat</td></tr> <tr><td>负载均衡</td> <td>权重/DSL/metadata/CMDB</td> <td>Ribbon</td> <td>Fabio</td> <td>RR</td> <td>/</td></tr> <tr><td>雪崩保护</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>自动注销实例</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td> <td>支持</td></tr> <tr><td>访问协议</td> <td>HTTP/DNS/UDP</td> <td>HTTP</td> <td>HTTP/DNS</td> <td>DNS</td> <td>TCP</td></tr> <tr><td>监听支持</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>支持</td></tr> <tr><td>多数据中心</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>跨注册中心</td> <td>支持</td> <td>不支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>Spring Cloud集成</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>Dubbo集成</td> <td>支持</td> <td>不支持</td> <td>不支持</td> <td>不支持</td> <td>支持</td></tr> <tr><td>K8S集成</td> <td>支持</td> <td>不支持</td> <td>支持</td> <td>支持</td> <td>不支持</td></tr></tbody></table> <h3 id="ap、cp切换"><a href="#ap、cp切换" class="header-anchor">#</a> AP、CP切换</h3> <p><strong>C是所有节点在同一时间看到的数据是一致的;而A的定义是所有的请求都会收到响应。</strong></p> <div class="custom-block tip"><p class="custom-block-title">何时选择使用何种模式？</p> <p>一般来说，</p> <br> <p>如果不需要存储服务级别的信息且服务实例是通过racos-client注册，并能够保持心跳上报，那么就可以选择AP模式。当前主流的服务如Spring Cloud和Dubbo 服务，都适用于AP模式，AP模式为了服务的可能性而减弱了一致性，因此AP模式下只支持注册临时实例。</p> <br> <p>如果需要在服务级别编辑或者存储配置信息，那么CP是必须，K8S服务和DNS服务则适用于CP模式。</p> <br> <p>CP模式下则支持注册持久化实例，此时则是以Raft协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。</p></div> <p>可以通过下面的命令修改模式</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">'$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="nacos作为服务配置中心演示"><a href="#nacos作为服务配置中心演示" class="header-anchor">#</a> Nacos作为服务配置中心演示</h2> <h3 id="基础配置"><a href="#基础配置" class="header-anchor">#</a> 基础配置</h3> <p>新建<code>cloudalibaba-config-nacos-client3377</code>模块</p> <h4 id="pom-3"><a href="#pom-3" class="header-anchor">#</a> pom</h4> <blockquote><p>依赖相较于前面的服务注册模块，除了保留discovery外，还要新增一个config依赖</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- nacos config依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="yaml-3"><a href="#yaml-3" class="header-anchor">#</a> yaml</h4> <blockquote><p>这里需要两个配置文件，一个是原来的<code>application.yaml</code>，另一个是<code>bootstrap.yaml</code>。</p> <p>Nacos同SpringCloud-Config一样，在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动。
SpringBoot中配置文件的加载是存在优先级顺序的，<strong>bootstrap优先级高于application</strong></p></blockquote> <p>application.yaml</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 表示开发环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>bootstrap.yaml</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment"># 指定在configServer上找yaml格式的文件</span>

<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="主启动类-2"><a href="#主启动类-2" class="header-anchor">#</a> 主启动类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientMain3377</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosConfigClientMain3377</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="controller-2"><a href="#controller-2" class="header-anchor">#</a> Controller</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">//支持nacos的动态刷新</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${config.info}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> configInfo<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/config/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="在nacos中添加配置信息"><a href="#在nacos中添加配置信息" class="header-anchor">#</a> 在Nacos中添加配置信息</h4> <h5 id="nacos中的匹配规则"><a href="#nacos中的匹配规则" class="header-anchor">#</a> Nacos中的匹配规则</h5> <ul><li>Nacos中的DataId的组成格式以及与SpringBoot配置文件中的匹配规则</li></ul> <p>说明：之所以需要配置<code>spring.application.name</code>，是因为它是构成Nacos管理配置<code>dataId</code>字段的一部分。</p> <p>在Nacos Spring Cloud中，<code>dataId</code>的完整格式如下</p> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>#<span class="token punctuation">{</span>prefix<span class="token punctuation">}</span>-<span class="token equation string">${spring.profile.active}.$</span><span class="token punctuation">{</span>file-extension<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>prefix</code>默认为<code>spring.application.name</code>的值，也可以通过配置项<code>spring.cloud.nacos.config.prefix</code>来配置</li> <li><code>spring.profile.active</code>即为当前环境对应的profile，详情参考Spring Boot文档。<strong>注意，当<code>spring.profile.active</code>为空时，对应的连接符-也将不存在，dataId的拼接格式变为<code>#{prefix}.${file-extension}</code></strong></li> <li><code>file-extension</code>为配置内容的数据格式，可以通过配置项<code>spring.cloud.nacos.config.file-extension</code>来配置，目前只支持<code>properties</code>和<code>yaml</code>类型</li> <li>通过Spring Cloud原生注解<code>@RrefreshScope</code>实现配置自动更新</li></ul> <p><strong>所以最后的公式：</strong></p> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code><span class="token equation string">${spring.application.name}-$</span><span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.$<span class="token punctuation">{</span>spring.cloud.nacos.config.file-extension<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="在nacos进行添加配置"><a href="#在nacos进行添加配置" class="header-anchor">#</a> 在nacos进行添加配置</h5> <p><img src="https://images.zaiolos.top/images/202211161702662.png" alt="image-20221116170241590"></p> <p><img src="https://images.zaiolos.top/images/202211161703004.png" alt="image-20221116170335913"></p> <h5 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h5> <p>添加配置后，启动3377项目会发现启动报错，这篇文章指出了原因：</p> <p>https://blog.csdn.net/wyz0923/article/details/118303072，即cloud2020版本后，已不会再自动先加载<code>bootstrap.yaml</code>文件了，所以我们需要和在Spring Cloud Config中一样，手动添加上bootstrap的依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>调用接口获取配置文件测试正常</p> <p><img src="https://images.zaiolos.top/images/202211161720645.png" alt="image-20221116172040578"></p> <p><strong>在nacos控制台进行配置修改，然后再次获取，发现已立刻刷新</strong></p> <p><img src="https://images.zaiolos.top/images/202211161722281.png" alt="image-20221116172254186"></p> <h3 id="分类配置"><a href="#分类配置" class="header-anchor">#</a> 分类配置</h3> <blockquote><p>为了解决大型微服务项目中存在多个子项目，且每个子项目又有开发、测试、预发布、正式环境等环境，所需要的配置文件难以管理的问题，Nacos的配置中心采用<strong>Namespace+Group+DataId</strong>的设计</p></blockquote> <h4 id="为什么这样设计"><a href="#为什么这样设计" class="header-anchor">#</a> 为什么这样设计？</h4> <blockquote><p>此设计类似于java中的概念，即package名和类名</p> <p>最外层的namespace是可以用于区分部署环境的，Group和DataId逻辑上区分两个目标对象</p></blockquote> <p>三者情况：</p> <p><img src="https://images.zaiolos.top/images/202211161732978.png" alt="image-20221116173241902"></p> <p><strong>默认情况下：</strong></p> <p><code>Namespace=public，Group=DEFAULT_GROUP，默认Cluster是DEFAULT</code></p> <blockquote><p>Nacos默认的命名空间是public，Namespace主要用来实现隔离。
比方说我们现在有三个环境:开发、测试、生产环境，我们就可以创建三个Namespace，不同的Namespace之间是隔离的。</p> <br> <p>Group默认是DEFAULT_GROUP，Group可以把不同的微服务划分到同一个分组里面去</p> <br> <p>Service就是微服务;一个Service可以包含多个Cluster (集群)，Nacos默认Cluster是DEFAULT，Cluster是对指定微服务的一个虚拟划分。比方说为了容灾，将Service微服务分别部署在了杭州机房和广州机房，
这时就可以给杭州机房的Service微服务起一个集群名称(HZ) ，
给广州机房的Service微服务起一个集群名称(GZ)，还可以尽量让同一个机房的微服务互相调用，以提升性能。</p> <br> <p>最后是Instance，就是微服务的实例。</p></blockquote> <h4 id="三种方案加载配置"><a href="#三种方案加载配置" class="header-anchor">#</a> 三种方案加载配置</h4> <h5 id="dataid方案"><a href="#dataid方案" class="header-anchor">#</a> DataId方案</h5> <ul><li>指定spring.profile.active和配置文件的DataID来使不同环境下读取不同的配置</li> <li>默认空间+默认分组+新建dev和test啷个DataID</li> <li>通过spring.profile.active设为dev或test实现多环境下配置文件的读取</li></ul> <p>由于先前已经新增了dev的配置文件，现在新增一个test即可</p> <p><img src="https://images.zaiolos.top/images/202211161743873.png" alt="image-20221116174327799"></p> <p>修改spring.profiles.active为test，访问配置测试接口：成功获取到</p> <p><img src="https://images.zaiolos.top/images/202211161747227.png" alt="image-20221116174712161"></p> <h5 id="group方案"><a href="#group方案" class="header-anchor">#</a> Group方案</h5> <p>新建两个配置，配置的DataId都是<code>nacos-config-client-info.yaml</code>，但是Group不相同，一个是<code>DEV_GROUP</code>，一个是<code>TEST_GROUP</code>，内容为：<strong>config:info:nacos-config-client-info.yaml,TEST(DEV)_GROUP</strong></p> <p><img src="https://images.zaiolos.top/images/202211161754892.png" alt="image-20221116175458797"></p> <blockquote><p>然后是对bootstrap.yaml进行配置，在spring.cloud.nacos.config下增加group属性，值即为新建的配置的group，然后application.yaml的spring.profiles.active改为info</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211161756276.png" alt="image-20221116175631203"></p> <p><strong>在不同group下进行进行测试：</strong></p> <p><img src="https://images.zaiolos.top/images/202211161759700.png" alt="image-20221116175953637"></p> <h5 id="namespace方案"><a href="#namespace方案" class="header-anchor">#</a> Namespace方案</h5> <p>首先，新建命名空间</p> <p><img src="https://images.zaiolos.top/images/202211161808381.png" alt="image-20221116180812294"></p> <blockquote><p>低版本的nacos中，命名空间id是不能自定义的，目前我使用的版本是可以自定义的，但我们还是先用它的自动生成即可</p></blockquote> <p>创建完命名空间后，回到配置列表，可以发现，可以选择我们刚才创建命名空间了</p> <p><img src="https://images.zaiolos.top/images/202211161809579.png" alt="image-20221116180953484"></p> <p>切换以后会发现没有配置</p> <p><img src="https://images.zaiolos.top/images/202211161810749.png" alt="image-20221116181013663"></p> <blockquote><p>这个时候就可以创建配置了，在哪个空间下创建配置，这个配置就是属于这个命名空间的，与其他命名空间是隔离的，这里我们两个环境都创建一个配置</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211161813996.png" alt="image-20221116181351892"></p> <p>如何使其能够被访问到也和group的配置差不多：</p> <blockquote><p>对bootstrap.yaml进行配置，在spring.cloud.nacos.config下增加namespace属性，<strong>值为上面的命名空间ID</strong>，这样再结合上面的group配置、spring.profiles.active配置，即可访问配置文件，就不再进行测试了</p></blockquote> <h2 id="nacos集群和持久化配置-重要"><a href="#nacos集群和持久化配置-重要" class="header-anchor">#</a> Nacos集群和持久化配置(重要)</h2> <blockquote><p>默认Nacos使用嵌入式数据库实现数据的存储。所以，如果启动多个默认配置下的Nacos节点，数据存储是存在一致性问题的。为了解决这个问题，Nacos采用了<strong>集中式存储的方式来支持集群化部署，目前只支持MySQL的存储</strong>。</p></blockquote> <h3 id="将单体nacos数据库迁移到mysql"><a href="#将单体nacos数据库迁移到mysql" class="header-anchor">#</a> 将单体Nacos数据库迁移到MySQL</h3> <p>步骤：</p> <ol><li><p>首先先在MySQL中创建名为<code>nacos_config</code>的数据库</p></li> <li><p>然后导入nacos/conf/mysql-schema.sql文件</p></li> <li><p>然后找到application.properties文件，在最后增加以下内容</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span>
<span class="token key attr-name">db.num</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/nacos_config?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span>
<span class="token key attr-name">db.user.0</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">db.password.0</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>然后重新运行nacos，可以发现我们之前新建的配置全部消失了，说明切换成功</p></li></ol> <blockquote><p>可以进行测试，现在新增一条配置，看看MySQL中的数据情况</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211181456066.png" alt="image-20221118145643954"></p> <h3 id="linux版nacos-mysql生产环境配置"><a href="#linux版nacos-mysql生产环境配置" class="header-anchor">#</a> Linux版Nacos+MySQL生产环境配置</h3> <blockquote><p>预计需要：一个nginx+3个nacos注册中心(因为要3个或以上nacos节点才能构成集群)+1一个MySQL</p></blockquote> <p>Linux版nacos server的包(<code>tar.gz</code>后缀)的下载赘述，下面直接到集群配置步骤</p> <h4 id="linux安装步骤"><a href="#linux安装步骤" class="header-anchor">#</a> Linux安装步骤</h4> <ul><li><p>首先将安装包上传到Linux服务器，我这里是<code>/usr/local/software/nacos/applicaion</code>，目录</p></li> <li><p>运行命令解压</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> nacos-server-2.1.2.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p><img src="https://images.zaiolos.top/images/202211181505498.png" alt="image-20221118150537412"></p> <p>同级目录下就会出现一个名为nacos的文件夹，里面的内容和我们在win里面测试时的一样</p> <h4 id="集群配置步骤-重点"><a href="#集群配置步骤-重点" class="header-anchor">#</a> 集群配置步骤(重点)</h4> <h5 id="mysql"><a href="#mysql" class="header-anchor">#</a> MySQL</h5> <blockquote><p>首先是MySQL的准备，由于我虚拟机上的MySQL还是5.1的版本，这里就直接使用本机上的MySQL，步骤和上面一样，改一下<code>application.properties</code></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span>
<span class="token key attr-name">db.num</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token comment"># 这里注意ip改一下就行</span>
<span class="token key attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.0.110:3306/nacos_config?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span>
<span class="token key attr-name">db.user.0</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">db.password.0</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></blockquote> <p>这里启动nacos还遇到问题，即<code>No Datasource set</code>，原因是我这里是虚拟机连接本机的MySQL，而本机MySQL没有设置远程连接的权限，所以需要设置一下，设置好以后重新连接一下即可</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code># 以下命令适用于MySQL8.0+
USE mysql;  #一定要使用mysql表，因为授权只能在这个表里授权。
select host,user from user; #查看当前用户的权限表
update user set host='%' where user='root'; #修改权限
flush privileges; # 刷新权限

# 如果是8.0以下，使用以下语句
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;

All : 表示所有操作，比如select,update,insert等操作
*.* ：表示所有库的所有表（test.*则表示test库的所有表）。
root ：表示授权的用户名。
% ：表示可以从任意地方登录，如改成192.168.0.999，则表示只能从ip地址为192.168.0.999的机器登录
123456 ：表示授权的用户名的密码。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="cluster-conf"><a href="#cluster-conf" class="header-anchor">#</a> cluster.conf</h5> <blockquote><p>这里要增加nacos的集群配置文件 <code>cluster.conf</code></p></blockquote> <p><img src="https://images.zaiolos.top/images/202211181543533.png" alt="image-20221118154341456"></p> <blockquote><p>可以看到conf文件夹里有一个cluster.conf.example文件，我们将它copy一份，名为cluster.conf</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">cp</span> cluster.conf.example cluster.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <p>编辑<code>cluster.conf</code>的内容：</p> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>192.168.0.112:3333
192.168.0.112:4444
192.168.0.112:5555
# ip是虚拟机的ip  后面的是nacos实例的端口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>注意：这个ip不能是127.0.0.1，必须是Linux命令<code>hostname -I</code>能够识别的ip,执行这个命令后出现的第一个ip即是要填的ip</p></blockquote> <p>到这里cluster.conf已完成</p> <h5 id="startup-sh脚本"><a href="#startup-sh脚本" class="header-anchor">#</a> startup.sh脚本</h5> <blockquote><p>这一步需要编辑nacos的启动脚本<code>startup.sh</code>，使它能够接受不同的启动端口</p></blockquote> <blockquote><p>集群启动，我们希望可以类似其它软件的shell命令，传递不同的端口号启动不同的nacos实例。
命令: bash startup.sh -p 3333表示启动端口号为3333的nacos服务器实例，和上一步的cluster.conf配置的一致。</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211181611644.png" alt="在这里插入图片描述"></p> <p><img src="https://images.zaiolos.top/images/202211181611082.png" alt="在这里插入图片描述"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># Copyright 1999-2018 Alibaba Group Holding Ltd.</span>
<span class="token comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="token comment"># you may not use this file except in compliance with the License.</span>
<span class="token comment"># You may obtain a copy of the License at</span>

<span class="token comment">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token assign-left variable">cygwin</span><span class="token operator">=</span>false
<span class="token assign-left variable">darwin</span><span class="token operator">=</span>false
<span class="token assign-left variable">os400</span><span class="token operator">=</span>false
<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>&quot;</span> <span class="token keyword">in</span>
CYGWIN*<span class="token punctuation">)</span> <span class="token assign-left variable">cygwin</span><span class="token operator">=</span>true<span class="token punctuation">;</span><span class="token punctuation">;</span>
Darwin*<span class="token punctuation">)</span> <span class="token assign-left variable">darwin</span><span class="token operator">=</span>true<span class="token punctuation">;</span><span class="token punctuation">;</span>
OS400*<span class="token punctuation">)</span> <span class="token assign-left variable">os400</span><span class="token operator">=</span>true<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
<span class="token function-name function">error_exit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;ERROR: <span class="token variable">$1</span> !!&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>/bin/java&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/jdk/java
<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>/bin/java&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/java
<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>/bin/java&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/taobao/java
<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>/bin/java&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">unset</span> JAVA_HOME

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token keyword">if</span> <span class="token variable">$darwin</span><span class="token punctuation">;</span> <span class="token keyword">then</span>

    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-x</span> <span class="token string">'/usr/libexec/java_home'</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>/usr/libexec/java_home<span class="token variable">`</span></span>

    <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK/Home&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token string">&quot;/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK/Home&quot;</span>
    <span class="token keyword">fi</span>
  <span class="token keyword">else</span>
    <span class="token assign-left variable">JAVA_PATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> <span class="token punctuation">$(</span>readlink <span class="token parameter variable">-f</span> <span class="token punctuation">$(</span>which javac<span class="token punctuation">))</span><span class="token variable">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;x<span class="token variable">$JAVA_PATH</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;x&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> $JAVA_PATH <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token variable">`</span></span>
    <span class="token keyword">fi</span>
  <span class="token keyword">fi</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        error_exit <span class="token string">&quot;Please set the JAVA_HOME variable in your environment, We need java(x64)! jdk8 or later is better!&quot;</span>
  <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable">SERVER</span><span class="token operator">=</span><span class="token string">&quot;nacos-server&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token string">&quot;cluster&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FUNCTION_MODE</span><span class="token operator">=</span><span class="token string">&quot;all&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MEMBER_LIST</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">EMBEDDED_STORAGE</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">&quot;:m:f:s:c:p:o:&quot;</span> opt
<span class="token keyword">do</span>
    <span class="token keyword">case</span> <span class="token variable">$opt</span> <span class="token keyword">in</span>
        m<span class="token punctuation">)</span>
            <span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        f<span class="token punctuation">)</span>
            <span class="token assign-left variable">FUNCTION_MODE</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        s<span class="token punctuation">)</span>
            <span class="token assign-left variable">SERVER</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        c<span class="token punctuation">)</span>
            <span class="token assign-left variable">MEMBER_LIST</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        p<span class="token punctuation">)</span>
            <span class="token assign-left variable">EMBEDDED_STORAGE</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        o<span class="token punctuation">)</span>  
			<span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable">$OPTARG</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
		?<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Unknown parameter&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">export</span> JAVA_HOME
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$JAVA_HOME</span>/bin/java&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> <span class="token punctuation">$(</span>dirname $0<span class="token punctuation">)</span>/<span class="token punctuation">..</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CUSTOM_SEARCH_LOCATIONS</span><span class="token operator">=</span>file:<span class="token variable">${BASE_DIR}</span>/conf/

<span class="token comment">#===========================================================================================</span>
<span class="token comment"># JVM Configuration</span>
<span class="token comment">#===========================================================================================</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${MODE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;standalone&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Xms512m -Xmx512m -Xmn256m&quot;</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dnacos.standalone=true&quot;</span>
<span class="token keyword">else</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${EMBEDDED_STORAGE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;embedded&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -DembeddedStorage=true&quot;</span>
    <span class="token keyword">fi</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="token variable">${BASE_DIR}</span>/logs/java_heapdump.hprof&quot;</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -XX:-UseLargePages&quot;</span>

<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${FUNCTION_MODE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;config&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dnacos.functionMode=config&quot;</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${FUNCTION_MODE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;naming&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dnacos.functionMode=naming&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dnacos.member.list=<span class="token variable">${MEMBER_LIST}</span>&quot;</span>

<span class="token assign-left variable">JAVA_MAJOR_VERSION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$JAVA <span class="token parameter variable">-version</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-n</span> <span class="token string">'s/.* version &quot;([0-9]*).*$/\1/p'</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$JAVA_MAJOR_VERSION</span>&quot;</span> <span class="token parameter variable">-ge</span> <span class="token string">&quot;9&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Xlog:gc*:file=<span class="token variable">${BASE_DIR}</span>/logs/nacos_gc.log:time,tags:filecount=10,filesize=102400&quot;</span>
<span class="token keyword">else</span>
  <span class="token assign-left variable">JAVA_OPT_EXT_FIX</span><span class="token operator">=</span><span class="token string">&quot;-Djava.ext.dirs=<span class="token variable">${JAVA_HOME}</span>/jre/lib/ext:<span class="token variable">${JAVA_HOME}</span>/lib/ext&quot;</span>
  <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Xloggc:<span class="token variable">${BASE_DIR}</span>/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dloader.path=<span class="token variable">${BASE_DIR}</span>/plugins,<span class="token variable">${BASE_DIR}</span>/plugins/health,<span class="token variable">${BASE_DIR}</span>/plugins/cmdb,<span class="token variable">${BASE_DIR}</span>/plugins/selector&quot;</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dnacos.home=<span class="token variable">${BASE_DIR}</span>&quot;</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -jar <span class="token variable">${BASE_DIR}</span>/target/<span class="token variable">${SERVER}</span>.jar&quot;</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> <span class="token variable">${JAVA_OPT_EXT}</span>&quot;</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> --spring.config.additional-location=<span class="token variable">${CUSTOM_SEARCH_LOCATIONS}</span>&quot;</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> --logging.config=<span class="token variable">${BASE_DIR}</span>/conf/nacos-logback.xml&quot;</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> --server.max-http-header-size=524288&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token variable">${BASE_DIR}</span>/logs&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">mkdir</span> <span class="token variable">${BASE_DIR}</span>/logs
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$JAVA</span> <span class="token variable">$JAVA_OPT_EXT_FIX</span> <span class="token variable">${JAVA_OPT}</span>&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${MODE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;standalone&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;nacos is starting with standalone&quot;</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;nacos is starting with cluster&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># check the start.out log output file</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;<span class="token variable">${BASE_DIR}</span>/logs/start.out&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">touch</span> <span class="token string">&quot;<span class="token variable">${BASE_DIR}</span>/logs/start.out&quot;</span>
<span class="token keyword">fi</span>
<span class="token comment"># start</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$JAVA</span> <span class="token variable">$JAVA_OPT_EXT_FIX</span> <span class="token variable">${JAVA_OPT}</span>&quot;</span> <span class="token operator">&gt;</span> <span class="token variable">${BASE_DIR}</span>/logs/start.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$JAVA_OPT_EXT_FIX</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">nohup</span> <span class="token string">&quot;<span class="token variable">$JAVA</span>&quot;</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token variable">${PORT}</span>  <span class="token variable">${JAVA_OPT}</span> nacos.nacos <span class="token operator">&gt;&gt;</span> <span class="token variable">${BASE_DIR}</span>/logs/start.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
<span class="token keyword">else</span>
  <span class="token function">nohup</span> <span class="token string">&quot;<span class="token variable">$JAVA</span>&quot;</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token variable">${PORT}</span>  <span class="token string">&quot;<span class="token variable">$JAVA_OPT_EXT_FIX</span>&quot;</span> <span class="token variable">${JAVA_OPT}</span> nacos.nacos <span class="token operator">&gt;&gt;</span> <span class="token variable">${BASE_DIR}</span>/logs/start.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;nacos is starting，you can check the <span class="token variable">${BASE_DIR}</span>/logs/start.out&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br></div></div><blockquote><p>这里经过尝试 无论怎么都只能启动一个端口的实例，所以这里直接再拷贝两个nacos，分别启动startup.sh来启动集群</p></blockquote> <p><img src="https://images.zaiolos.top/images/202211181653441.png" alt="image-20221118165325245"></p> <p>这是<code>startcluster.sh</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token function">bash</span> /usr/local/software/nacos/application/nacos/bin/startup.sh <span class="token parameter variable">-o</span> <span class="token number">3333</span>
<span class="token function">bash</span> /usr/local/software/nacos/application/nacos4444/bin/startup.sh <span class="token parameter variable">-o</span> <span class="token number">4444</span>
<span class="token function">bash</span> /usr/local/software/nacos/application/nacos5555/bin/startup.sh <span class="token parameter variable">-o</span> <span class="token number">5555</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>这里还是需要将startup.sh修改为能够指定端口启动后，再copy出来</p></blockquote> <p>这是<code>shutdowncluster.sh</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token function">bash</span> /usr/local/software/nacos/application/nacos/bin/shutdown.sh
<span class="token function">bash</span> /usr/local/software/nacos/application/nacos4444/bin/shutdown.sh
<span class="token function">bash</span> /usr/local/software/nacos/application/nacos5555/bin/shutdown.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>执行startcluster.sh后，进入任意一个节点的console可以看到集群节点情况</p> <p>也可以使用<code>ps -ef|grep nacos|grep -v grep | wc -l</code>命令获取nacos的数量来查看</p> <p><img src="https://images.zaiolos.top/images/202211181709858.png" alt="image-20221118170934651"></p> <h5 id="nginx配置"><a href="#nginx配置" class="header-anchor">#</a> nginx配置</h5> <blockquote><p>编辑nginx的配置，由它作为负载均衡器</p></blockquote> <ul><li><p>下载nginx</p></li> <li><p>压解<code>tar -zxvf xxx.tar.gzr</code></p></li> <li><p>安装gcc环境<code>yum install gcc-c++</code></p></li> <li><p>安装pcre pcre-devel <code>yum install pcre pcre-devel</code></p></li> <li><p>安装zlib <code>yum install zlib zlib-devel</code></p></li> <li><p>安装openssl <code>yum install -y openssl openssl-devel</code></p></li> <li><p>使用默认配置，在nginx根目录下执行3个命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./configure
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>查找nginx安装目录 <code>whereis nginx</code>- /usr/local/nginx</p> <p><img src="https://images.zaiolos.top/images/202211181745129.png" alt="image-20221118174540927"></p></li></ul> <p>现在来修改nginx配置文件：</p> <p><img src="https://images.zaiolos.top/images/202211181749541.png" alt="image-20221118174940321"></p> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>	upstream cluster<span class="token punctuation">{</span>
        server 127.0.0.1:3333;
        server 127.0.0.1:4444;
        server 127.0.0.1:5555;
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{</span>
        listen       1111;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / <span class="token punctuation">{</span>
            #root   html;
            #index  index.html index.htm;
            proxy_pass http://cluster;
        <span class="token punctuation">}</span>

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html <span class="token punctuation">{</span>
            root   html;
        <span class="token punctuation">}</span>

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ <span class="token function selector">\.</span>php<span class="token equation string">$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ <span class="token equation-command regex">\.</span>php$</span> <span class="token punctuation">{</span>
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #<span class="token punctuation">}</span>

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /<span class="token function selector">\.</span>ht <span class="token punctuation">{</span>
        #    deny  all;
        #<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><blockquote><p>主要是添加upstream，其中包含三个nacos实例的ip:端口；</p> <p>然后是修改server监听的端口为1111，且修改location</p> <p>location / {
proxy_pass http://cluster;
}</p></blockquote> <p>最后启动nginx：</p> <ul><li>进入/usr/local/nginx/sbin目录，运行命令<code>./nginx -c /usr/local/nginx/conf/nginx.conf</code></li></ul> <h4 id="测试-3"><a href="#测试-3" class="header-anchor">#</a> 测试</h4> <blockquote><p>到这里，3个nacos实例和nginx均已启动，我们通过nginx(1111端口)来访问nacos进行测试</p></blockquote> <p>访问：<code>http://192.168.0.112:1111/nacos</code>，发现是可以进入到的</p> <p><img src="https://images.zaiolos.top/images/202211181758652.png" alt="image-20221118175837414"></p> <p>然后新增一个配置进行测试</p> <p><img src="https://images.zaiolos.top/images/202211181801396.png" alt="image-20221118180158243"></p> <h5 id="测试注册功能"><a href="#测试注册功能" class="header-anchor">#</a> 测试注册功能</h5> <blockquote><p>将9002payment服务注册进nacos集群进行测试：<code>server-addr: 192.168.0.112:1111</code> # nginx暴露</p></blockquote> <p>启动9002，查看控制台</p> <p><img src="https://images.zaiolos.top/images/202211181806009.png" alt="image-20221118180610732"></p> <h5 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h5> <p><img src="https://images.zaiolos.top/images/202211181807903.png" alt="image-20221118180701779"></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hnistzdk/my-notes/edit/master/docs/04.框架/22.SpringCloud/12.Nacos.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/my-notes/tags/?tag=Nacos" title="标签">#Nacos</a><a href="/my-notes/tags/?tag=SpringCloud%20Alibaba" title="标签">#SpringCloud Alibaba</a></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2022/11/18, 10:11:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/my-notes/SpringCloud/Sleuth/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Sleuth</div></a> <a href="/my-notes/SpringCloud/Sentinel/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Sentinel</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/my-notes/SpringCloud/Sleuth/" class="prev">Sleuth</a></span> <span class="next"><a href="/my-notes/SpringCloud/Sentinel/">Sentinel</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:369365576@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/hnistzdk" title="GitHub" target="_blank" class="iconfont icon-gitee"></a><a href="http://music.163.com/playlist?id=936642760&amp;userid=604011130" title="普通歌单" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>zdk | notes <br><a href=http://beian.miit.gov.cn/>湘ICP备2022001117号-1</a><br><img src=/img/ghs.png /><a href=http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51142102511562>川公网安备 51142102511562号</a><br><a href=https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referra><img src=/img/upyun.png align=absmiddle width=70px height=30px /></a> <span> 提供加速服务 </span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div id="goTop" class="hide-cat" data-v-bf92849a></div><div></div><div></div></div></div>
    <script src="/my-notes/assets/js/app.7f931ee0.js" defer></script><script src="/my-notes/assets/js/2.e52a17f8.js" defer></script><script src="/my-notes/assets/js/139.068ed7d7.js" defer></script><script src="/my-notes/assets/js/8.c2fa6f68.js" defer></script><script src="/my-notes/assets/js/6.bcc16901.js" defer></script>
  </body>
</html>
